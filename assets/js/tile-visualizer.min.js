(()=>{class m{constructor(){this.canvas=document.getElementById("tile-canvas"),this.ctx=this.canvas.getContext("2d"),this.roomWidth=8,this.roomLength=10,this.tileWidth=12,this.tileHeight=12,this.groutWidth=.125,this.groutColor="#CCCCCC",this.tileColor="#F5F5DC",this.pattern="straight",this.zoom=1,this.panX=0,this.panY=0,this.tilePrice=5,this.init()}init(){this.attachEventListeners(),this.render(),this.updateCalculations()}attachEventListeners(){document.getElementById("room-width").addEventListener("input",t=>{this.roomWidth=parseFloat(t.target.value)||8,this.updateCalculations(),this.render()}),document.getElementById("room-length").addEventListener("input",t=>{this.roomLength=parseFloat(t.target.value)||10,this.updateCalculations(),this.render()}),document.querySelectorAll(".tile-size-btn").forEach(t=>{t.addEventListener("click",e=>{document.querySelectorAll(".tile-size-btn").forEach(s=>s.classList.remove("active")),e.target.classList.add("active"),this.tileWidth=parseInt(e.target.dataset.width),this.tileHeight=parseInt(e.target.dataset.height),this.updateCalculations(),this.render()})}),document.getElementById("apply-custom").addEventListener("click",()=>{const t=parseFloat(document.getElementById("custom-width").value),e=parseFloat(document.getElementById("custom-height").value);t&&e&&t>0&&e>0&&(document.querySelectorAll(".tile-size-btn").forEach(s=>s.classList.remove("active")),this.tileWidth=t,this.tileHeight=e,this.updateCalculations(),this.render())}),document.querySelectorAll(".pattern-btn").forEach(t=>{t.addEventListener("click",e=>{document.querySelectorAll(".pattern-btn").forEach(s=>s.classList.remove("active")),e.currentTarget.classList.add("active"),this.pattern=e.currentTarget.dataset.pattern,this.updatePatternInfo(),this.render()})}),document.getElementById("grout-width").addEventListener("input",t=>{this.groutWidth=parseFloat(t.target.value),this.updateGroutWidthDisplay(),this.updateCalculations(),this.render()}),document.querySelectorAll(".grout-color-btn").forEach(t=>{t.addEventListener("click",e=>{document.querySelectorAll(".grout-color-btn").forEach(s=>s.classList.remove("active")),e.target.classList.add("active"),this.groutColor=e.target.dataset.color,document.getElementById("custom-grout-color").value=this.groutColor,this.render()})}),document.getElementById("custom-grout-color").addEventListener("input",t=>{document.querySelectorAll(".grout-color-btn").forEach(e=>e.classList.remove("active")),this.groutColor=t.target.value,this.render()}),document.querySelectorAll(".tile-color-btn").forEach(t=>{t.addEventListener("click",e=>{document.querySelectorAll(".tile-color-btn").forEach(s=>s.classList.remove("active")),e.target.classList.add("active"),this.tileColor=e.target.dataset.color,document.getElementById("custom-tile-color").value=this.tileColor,this.render()})}),document.getElementById("custom-tile-color").addEventListener("input",t=>{document.querySelectorAll(".tile-color-btn").forEach(e=>e.classList.remove("active")),this.tileColor=t.target.value,this.render()}),document.getElementById("tile-price").addEventListener("input",t=>{this.tilePrice=parseFloat(t.target.value)||5,this.updateCalculations()}),document.getElementById("zoom-in").addEventListener("click",()=>this.zoomIn()),document.getElementById("zoom-out").addEventListener("click",()=>this.zoomOut()),document.getElementById("zoom-fit").addEventListener("click",()=>this.zoomFit()),document.getElementById("save-design").addEventListener("click",()=>this.saveDesign()),document.getElementById("load-design").addEventListener("click",()=>this.loadDesign()),document.getElementById("export-image").addEventListener("click",()=>this.exportImage()),document.getElementById("reset-design").addEventListener("click",()=>this.resetDesign()),this.updateGroutWidthDisplay()}updateGroutWidthDisplay(){const e={.0625:'1/16"',.125:'1/8"',.1875:'3/16"',.25:'1/4"',.3125:'5/16"',.375:'3/8"',.4375:'7/16"',.5:'1/2"'}[this.groutWidth]||`${this.groutWidth}"`;document.querySelector(".grout-width-display").textContent=e}render(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.panX,this.panY),this.ctx.scale(this.zoom,this.zoom);const t=this.canvas.width-100,e=this.canvas.height-100,s=t/this.roomWidth,o=e/this.roomLength,i=Math.min(s,o),a=this.roomWidth*i,n=this.roomLength*i,r=(this.canvas.width-a)/2,l=(this.canvas.height-n)/2;this.ctx.translate(r,l),this.ctx.strokeStyle="#333333",this.ctx.lineWidth=2,this.ctx.strokeRect(0,0,a,n),this.drawTiles(a,n,i),this.drawDimensions(a,n,i,r,l),this.ctx.restore()}drawTiles(t,e,s){const o=this.tileWidth/12*s,i=this.tileHeight/12*s,a=this.groutWidth/12*s;switch(this.pattern){case"straight":this.drawStraightPattern(t,e,o,i,a);break;case"brick":this.drawBrickPattern(t,e,o,i,a);break;case"herringbone":this.drawHerringbonePattern(t,e,o,i,a);break;case"diagonal":this.drawDiagonalPattern(t,e,o,i,a);break;case"basketweave":this.drawBasketweavePattern(t,e,o,i,a);break;case"vertical":this.drawVerticalPattern(t,e,o,i,a);break}}drawStraightPattern(t,e,s,o,i){for(let a=0;a<e;a+=o+i)for(let n=0;n<t;n+=s+i)this.drawTile(n,a,s,o,i)}drawBrickPattern(t,e,s,o,i){let a=0;for(let n=0;n<e;n+=o+i){const r=a%2*(s/2);for(let l=-r;l<t;l+=s+i)l+s>0&&this.drawTile(l,n,s,o,i);a++}}drawHerringbonePattern(t,e,s,o,i){const a=s+i,n=o+i;for(let r=0;r<e;r+=n*2)for(let l=0;l<t;l+=a*2)this.drawTile(l,r,s,o,i),this.ctx.save(),this.ctx.translate(l+s+i,r),this.ctx.rotate(Math.PI/2),this.drawTile(0,0,s,o,i),this.ctx.restore()}drawDiagonalPattern(t,e,s,o,i){this.ctx.save(),this.ctx.translate(t/2,e/2),this.ctx.rotate(Math.PI/4),this.ctx.translate(-t/2,-e/2);const a=Math.sqrt(t*t+e*e);for(let n=-a/2;n<a;n+=o+i)for(let r=-a/2;r<a;r+=s+i)this.drawTile(r,n,s,o,i);this.ctx.restore()}drawBasketweavePattern(t,e,s,o,i){const a=Math.max(s,o)+i;for(let n=0;n<e;n+=a*2)for(let r=0;r<t;r+=a*2)this.drawTile(r,n,s,o,i),this.drawTile(r,n+o+i,s,o,i),this.ctx.save(),this.ctx.translate(r+s+i,n),this.ctx.rotate(Math.PI/2),this.drawTile(0,0,s,o,i),this.drawTile(0,o+i,s,o,i),this.ctx.restore()}drawVerticalPattern(t,e,s,o,i){for(let a=0;a<t;a+=o+i)for(let n=0;n<e;n+=s+i)this.ctx.save(),this.ctx.translate(a,n),this.ctx.rotate(Math.PI/2),this.drawTile(0,-o,s,o,i),this.ctx.restore()}drawTile(t,e,s,o,i){this.ctx.fillStyle=this.groutColor,this.ctx.fillRect(t,e,s+i,o+i);const a=this.getTileColorVariation();this.ctx.fillStyle=a,this.ctx.fillRect(t+i/2,e+i/2,s,o),this.ctx.strokeStyle="rgba(0,0,0,0.1)",this.ctx.lineWidth=1,this.ctx.strokeRect(t+i/2,e+i/2,s,o)}getTileColorVariation(){const t=this.hexToRgb(this.tileColor),e=Math.random()*10-5,s=Math.max(0,Math.min(255,t.r+e)),o=Math.max(0,Math.min(255,t.g+e)),i=Math.max(0,Math.min(255,t.b+e));return`rgb(${s}, ${o}, ${i})`}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}drawDimensions(t,e,s,o,i){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="#333333",this.ctx.font="bold 14px Arial",this.ctx.textAlign="center";const a=`${this.roomWidth}' wide`;this.ctx.fillText(a,o+t/2,i-15),this.ctx.save(),this.ctx.translate(o-15,i+e/2),this.ctx.rotate(-Math.PI/2);const n=`${this.roomLength}' long`;this.ctx.fillText(n,0,0),this.ctx.restore(),this.ctx.restore()}updateCalculations(){const t=this.roomWidth*this.roomLength;document.getElementById("total-area").textContent=t.toFixed(1);const s=this.tileWidth*this.tileHeight/144,o=Math.ceil(t/s);document.getElementById("tiles-needed").textContent=o;const i=o*s/t*100;document.getElementById("coverage-percent").textContent=i.toFixed(1)+"%";const a=Math.ceil(o*1.1);document.getElementById("tiles-with-waste").textContent=a;const n=Math.ceil(a*s/10);document.getElementById("boxes-needed").textContent=n;const r=t.toFixed(1);document.getElementById("grout-coverage").textContent=r+" sq ft";const l=Math.ceil(t*1.5);document.getElementById("thinset-needed").textContent=l+" lbs";const c=(t*1.1*this.tilePrice).toFixed(2);document.getElementById("tile-cost").textContent="$"+c;const h=(Math.ceil(t/150)*25).toFixed(2);document.getElementById("grout-cost").textContent="$"+h;const d=(Math.ceil(l/50)*30).toFixed(2);document.getElementById("thinset-cost").textContent="$"+d;const u=(parseFloat(c)+parseFloat(h)+parseFloat(d)).toFixed(2);document.getElementById("materials-total").textContent="$"+u}updatePatternInfo(){const t={straight:"<p><strong>Straight Pattern:</strong> Classic grid layout. Easiest to install, minimal waste (5-10%). Works well with any tile size. Best for rectangular tiles.</p>",brick:"<p><strong>Brick/Offset Pattern:</strong> Each row offset by half tile width. Creates visual interest. Moderate waste (10-15%). Popular for subway tile.</p>",herringbone:"<p><strong>Herringbone Pattern:</strong> Tiles laid in zigzag pattern at 45\xB0 or 90\xB0. Adds visual complexity. Higher waste (15-20%). Requires precision cutting.</p>",diagonal:"<p><strong>Diagonal Pattern:</strong> Tiles rotated 45\xB0 to room walls. Makes small spaces feel larger. Higher waste (15-20%) due to perimeter cuts.</p>",basketweave:"<p><strong>Basketweave Pattern:</strong> Pairs of tiles alternating horizontal/vertical. Traditional look. Moderate waste (10-15%). Works best with square tiles.</p>",vertical:"<p><strong>Vertical Pattern:</strong> Tiles installed vertically (especially for rectangular). Makes ceilings appear higher. Similar waste to straight pattern.</p>"};document.getElementById("pattern-info").innerHTML=t[this.pattern]||t.straight}zoomIn(){this.zoom=Math.min(this.zoom*1.2,3),this.render()}zoomOut(){this.zoom=Math.max(this.zoom/1.2,.5),this.render()}zoomFit(){this.zoom=1,this.panX=0,this.panY=0,this.render()}saveDesign(){const t={roomWidth:this.roomWidth,roomLength:this.roomLength,tileWidth:this.tileWidth,tileHeight:this.tileHeight,groutWidth:this.groutWidth,groutColor:this.groutColor,tileColor:this.tileColor,pattern:this.pattern,tilePrice:this.tilePrice,timestamp:new Date().toISOString()};localStorage.setItem("tileDesign",JSON.stringify(t)),this.showNotification("\u2705 Design saved successfully!")}loadDesign(){const t=localStorage.getItem("tileDesign");if(!t){this.showNotification("\u26A0\uFE0F No saved design found");return}try{const e=JSON.parse(t);this.roomWidth=e.roomWidth,this.roomLength=e.roomLength,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.groutWidth=e.groutWidth,this.groutColor=e.groutColor,this.tileColor=e.tileColor,this.pattern=e.pattern,this.tilePrice=e.tilePrice||5,document.getElementById("room-width").value=this.roomWidth,document.getElementById("room-length").value=this.roomLength,document.getElementById("grout-width").value=this.groutWidth,document.getElementById("custom-grout-color").value=this.groutColor,document.getElementById("custom-tile-color").value=this.tileColor,document.getElementById("tile-price").value=this.tilePrice,document.querySelectorAll(".pattern-btn").forEach(s=>{s.classList.toggle("active",s.dataset.pattern===this.pattern)}),this.updateGroutWidthDisplay(),this.updatePatternInfo(),this.updateCalculations(),this.render(),this.showNotification("\u2705 Design loaded successfully!")}catch(e){this.showNotification("\u274C Error loading design")}}exportImage(){const t=document.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height;const e=t.getContext("2d");e.fillStyle="#FFFFFF",e.fillRect(0,0,t.width,t.height),e.drawImage(this.canvas,0,0),e.fillStyle="rgba(0, 0, 0, 0.5)",e.font="14px Arial",e.textAlign="right",e.fillText("Created with Tillerstead Visualizer",t.width-10,t.height-10),t.toBlob(s=>{const o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=`tile-design-${Date.now()}.png`,i.click(),URL.revokeObjectURL(o),this.showNotification("\u2705 Image exported!")})}resetDesign(){confirm("Reset all settings to default?")&&(this.roomWidth=8,this.roomLength=10,this.tileWidth=12,this.tileHeight=12,this.groutWidth=.125,this.groutColor="#CCCCCC",this.tileColor="#F5F5DC",this.pattern="straight",this.zoom=1,this.panX=0,this.panY=0,this.tilePrice=5,document.getElementById("room-width").value=this.roomWidth,document.getElementById("room-length").value=this.roomLength,document.getElementById("grout-width").value=this.groutWidth,document.getElementById("tile-price").value=this.tilePrice,document.getElementById("custom-width").value="",document.getElementById("custom-height").value="",document.querySelectorAll(".tile-size-btn")[0].classList.add("active"),document.querySelectorAll(".pattern-btn")[0].classList.add("active"),document.querySelectorAll(".grout-color-btn")[0].classList.add("active"),document.querySelectorAll(".tile-color-btn")[0].classList.add("active"),this.updateGroutWidthDisplay(),this.updatePatternInfo(),this.updateCalculations(),this.render(),this.showNotification("\u{1F504} Reset complete"))}showNotification(t){const e=document.createElement("div");e.className="visualizer-notification",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.classList.add("fade-out"),setTimeout(()=>e.remove(),300)},3e3)}}document.addEventListener("DOMContentLoaded",()=>{const g=new m;console.log("Tile Visualizer initialized")});})();
