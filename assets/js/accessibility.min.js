(()=>{(function(){"use strict";const g={storageKey:"tillerstead-a11y-prefs",announceDelay:100,focusTrapSelectors:'a[href], button:not([disabled]), textarea, input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])',skipLinkTarget:"#main-content"};function q(t,e){let n;return function(...r){const o=()=>{clearTimeout(n),t(...r)};clearTimeout(n),n=setTimeout(o,e)}}function b(t=document){return Array.from(t.querySelectorAll(g.focusTrapSelectors)).filter(e=>{const n=window.getComputedStyle(e);return n.display!=="none"&&n.visibility!=="hidden"&&e.offsetParent!==null})}function F(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}function W(){return window.matchMedia("(forced-colors: active)").matches||window.matchMedia("(prefers-contrast: more)").matches}function y(){const t=document.getElementById("a11y-announcer");if(t)return t;const e=document.createElement("div");return e.id="a11y-announcer",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e),e}function w(){const t=document.getElementById("a11y-announcer-assertive");if(t)return t;const e=document.createElement("div");return e.id="a11y-announcer-assertive",e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e),e}function a(t,e={}){const n=e.assertive?w():y();n.textContent="",setTimeout(()=>{n.textContent=t},g.announceDelay),e.clearAfter!==!1&&setTimeout(()=>{n.textContent=""},e.clearAfter||5e3)}window.a11yAnnounce=a;class R{constructor(e){this.element=e,this.firstFocusable=null,this.lastFocusable=null,this.previouslyFocused=null,this.handleKeydown=this.handleKeydown.bind(this)}activate(){this.previouslyFocused=document.activeElement;const e=b(this.element);if(e.length===0)return;this.firstFocusable=e[0],this.lastFocusable=e[e.length-1],this.element.addEventListener("keydown",this.handleKeydown),this.element.setAttribute("data-focus-trap","true"),(this.element.querySelector("[autofocus]")||this.firstFocusable).focus(),a("Dialog opened. Press Escape to close.")}deactivate(){this.element.removeEventListener("keydown",this.handleKeydown),this.element.removeAttribute("data-focus-trap"),this.previouslyFocused&&this.previouslyFocused.focus&&this.previouslyFocused.focus()}handleKeydown(e){if(e.key!=="Tab")return;const n=b(this.element);this.firstFocusable=n[0],this.lastFocusable=n[n.length-1],e.shiftKey?document.activeElement===this.firstFocusable&&(e.preventDefault(),this.lastFocusable.focus()):document.activeElement===this.lastFocusable&&(e.preventDefault(),this.firstFocusable.focus())}}window.FocusTrap=R;function v(t,e){t&&(t.setAttribute("tabindex","-1"),t.focus(),e&&a(e),t.addEventListener("blur",function n(){t.removeAttribute("tabindex"),t.removeEventListener("blur",n)}))}window.moveFocusTo=v;function A(){document.querySelectorAll('[role="menu"], [role="menubar"]').forEach(e=>{const n=e.querySelectorAll('[role="menuitem"]');n.forEach((s,r)=>{s.addEventListener("keydown",o=>{let i;switch(o.key){case"ArrowDown":case"ArrowRight":o.preventDefault(),i=(r+1)%n.length,n[i].focus();break;case"ArrowUp":case"ArrowLeft":o.preventDefault(),i=(r-1+n.length)%n.length,n[i].focus();break;case"Home":o.preventDefault(),n[0].focus();break;case"End":o.preventDefault(),n[n.length-1].focus();break;case"Escape":const c=e.closest("[aria-haspopup]")||document.querySelector(`[aria-controls="${e.id}"]`);c&&(c.focus(),c.getAttribute("aria-expanded")==="true"&&c.click());break}})})})}function E(){document.querySelectorAll('[role="tablist"]').forEach(e=>{const n=e.querySelectorAll('[role="tab"]');n.forEach((s,r)=>{s.addEventListener("keydown",o=>{let i;const c=e.getAttribute("aria-orientation")==="vertical",l=c?"ArrowDown":"ArrowRight",d=c?"ArrowUp":"ArrowLeft";switch(o.key){case l:o.preventDefault(),i=(r+1)%n.length,n[i].focus(),n[i].click();break;case d:o.preventDefault(),i=(r-1+n.length)%n.length,n[i].focus(),n[i].click();break;case"Home":o.preventDefault(),n[0].focus(),n[0].click();break;case"End":o.preventDefault(),n[n.length-1].focus(),n[n.length-1].click();break}})})})}function P(){document.addEventListener("keydown",t=>{if(t.key!=="Escape")return;const e=document.querySelector('[role="dialog"][aria-modal="true"]:not([hidden])');if(e){const s=e.querySelector('[data-close], .modal-close, [aria-label*="close" i]');if(s){s.click();return}}document.querySelectorAll('[aria-expanded="true"]').forEach(s=>{s.setAttribute("aria-expanded","false");const r=document.getElementById(s.getAttribute("aria-controls"));r&&(r.hidden=!0)})})}function I(){document.querySelectorAll('.skip-link, [href^="#main"], [href="#main-content"]').forEach(e=>{e.addEventListener("click",n=>{const s=e.getAttribute("href").substring(1),r=document.getElementById(s);r&&(n.preventDefault(),v(r,`Skipped to ${r.getAttribute("aria-label")||"main content"}`),F()?r.scrollIntoView({block:"start"}):r.scrollIntoView({behavior:"smooth",block:"start"}))})})}function m(){try{const t=localStorage.getItem(g.storageKey);return t?JSON.parse(t):{}}catch(t){return{}}}function f(t){try{localStorage.setItem(g.storageKey,JSON.stringify(t))}catch(e){console.warn("Could not save accessibility preferences")}}function $(){const t={};return window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(t.reducedMotion=!0,document.documentElement.classList.add("reduce-motion"),console.log("[A11Y] Detected: prefers-reduced-motion")),window.matchMedia("(forced-colors: active)").matches&&(t.highContrast=!0,t.forcedColors=!0,document.documentElement.setAttribute("data-high-contrast","true"),document.documentElement.setAttribute("data-forced-colors","true"),console.log("[A11Y] Detected: forced-colors (Windows High Contrast)")),window.matchMedia("(prefers-contrast: more)").matches&&(t.highContrast=!0,document.documentElement.setAttribute("data-high-contrast","true"),console.log("[A11Y] Detected: prefers-contrast: more")),window.matchMedia("(prefers-contrast: less)").matches&&(t.lowContrast=!0,document.documentElement.setAttribute("data-low-contrast","true"),console.log("[A11Y] Detected: prefers-contrast: less")),window.matchMedia("(prefers-color-scheme: dark)").matches?(t.darkMode=!0,document.documentElement.setAttribute("data-color-scheme","dark"),console.log("[A11Y] Detected: prefers-color-scheme: dark")):window.matchMedia("(prefers-color-scheme: light)").matches&&(t.lightMode=!0,document.documentElement.setAttribute("data-color-scheme","light")),window.matchMedia("(inverted-colors: inverted)").matches&&(t.invertedColors=!0,document.documentElement.setAttribute("data-inverted-colors","true"),console.log("[A11Y] Detected: inverted-colors")),window.matchMedia("(prefers-reduced-transparency: reduce)").matches&&(t.reducedTransparency=!0,document.documentElement.setAttribute("data-reduced-transparency","true"),console.log("[A11Y] Detected: prefers-reduced-transparency")),window.matchMedia("(pointer: coarse)").matches&&(t.touchDevice=!0,document.documentElement.setAttribute("data-pointer","coarse"),document.documentElement.classList.add("touch-friendly"),console.log("[A11Y] Detected: coarse pointer (touch device)")),window.matchMedia("(hover: none)").matches&&(t.noHover=!0,document.documentElement.setAttribute("data-hover","none"),console.log("[A11Y] Detected: no hover capability")),t}function N(){window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",o=>{o.matches?(document.documentElement.classList.add("reduce-motion"),a("Reduced motion enabled")):(document.documentElement.classList.remove("reduce-motion"),a("Reduced motion disabled"))}),window.matchMedia("(prefers-contrast: more)").addEventListener("change",o=>{o.matches?(document.documentElement.setAttribute("data-high-contrast","true"),a("High contrast mode enabled")):window.matchMedia("(forced-colors: active)").matches||document.documentElement.removeAttribute("data-high-contrast")}),window.matchMedia("(forced-colors: active)").addEventListener("change",o=>{o.matches?(document.documentElement.setAttribute("data-high-contrast","true"),document.documentElement.setAttribute("data-forced-colors","true"),a("Windows High Contrast Mode detected")):(document.documentElement.removeAttribute("data-forced-colors"),m().highContrast||document.documentElement.removeAttribute("data-high-contrast"))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>{document.documentElement.setAttribute("data-color-scheme",o.matches?"dark":"light")}),window.matchMedia("(pointer: coarse)").addEventListener("change",o=>{o.matches?(document.documentElement.setAttribute("data-pointer","coarse"),document.documentElement.classList.add("touch-friendly")):(document.documentElement.setAttribute("data-pointer","fine"),document.documentElement.classList.remove("touch-friendly"))})}function V(){const t=$(),e=m();e.highContrast===!0?document.documentElement.setAttribute("data-high-contrast","true"):e.highContrast===!1&&!t.highContrast&&!t.forcedColors&&document.documentElement.removeAttribute("data-high-contrast"),e.textSize&&document.documentElement.setAttribute("data-text-size",e.textSize),e.reducedMotion===!0&&document.documentElement.classList.add("reduce-motion"),e.largerCursor&&document.documentElement.setAttribute("data-larger-cursor","true"),e.focusHighlight&&document.documentElement.setAttribute("data-focus-highlight","true"),N()}function H(){const e=!(document.documentElement.getAttribute("data-high-contrast")==="true");document.documentElement.setAttribute("data-high-contrast",e);const n=m();return n.highContrast=e,f(n),a(e?"High contrast mode enabled":"High contrast mode disabled"),e}function x(){const t=["normal","large","larger"],e=document.documentElement.getAttribute("data-text-size")||"normal",s=(t.indexOf(e)+1)%t.length,r=t[s];document.documentElement.setAttribute("data-text-size",r);const o=m();return o.textSize=r,f(o),a(`Text size: ${r}`),r}function J(){const e=!(document.documentElement.getAttribute("data-font")==="dyslexia");e?document.documentElement.setAttribute("data-font","dyslexia"):document.documentElement.removeAttribute("data-font");const n=m();return n.dyslexiaFont=e,f(n),a(e?"Dyslexia-friendly font enabled":"Standard font restored"),e}function U(){const e=!(document.documentElement.getAttribute("data-reading-guide")==="true");document.documentElement.setAttribute("data-reading-guide",e);const n=m();return n.readingGuide=e,f(n),a(e?"Reading guide enabled":"Reading guide disabled"),e}const u={synth:window.speechSynthesis,utterance:null,isReading:!1,isPaused:!1,currentElement:null,rate:1,pitch:1,voice:null,getVoices(){return this.synth?this.synth.getVoices():[]},setVoice(t){const e=this.getVoices();this.voice=e.find(s=>s.name===t)||e.find(s=>s.lang.startsWith("en"))||e[0];const n=m();n.ttsVoice=t,f(n)},setRate(t){this.rate=Math.max(.5,Math.min(2,t));const e=m();e.ttsRate=this.rate,f(e)},speak(t,e={}){return this.synth?(this.stop(),this.utterance=new SpeechSynthesisUtterance(t),this.utterance.rate=e.rate||this.rate,this.utterance.pitch=e.pitch||this.pitch,this.utterance.voice=this.voice,this.utterance.onstart=()=>{this.isReading=!0,document.documentElement.setAttribute("data-tts-active","true"),this.currentElement&&this.currentElement.classList.add("tts-reading")},this.utterance.onend=()=>{this.isReading=!1,this.isPaused=!1,document.documentElement.removeAttribute("data-tts-active"),this.currentElement&&(this.currentElement.classList.remove("tts-reading"),this.currentElement=null)},this.utterance.onerror=n=>{console.warn("[A11Y] TTS Error:",n.error),this.isReading=!1},this.synth.speak(this.utterance),!0):(console.warn("[A11Y] Speech synthesis not supported"),!1)},readElement(t){if(!t)return;this.currentElement=t;const e=t.textContent||t.innerText;e.trim()&&this.speak(e.trim())},readPage(){const t=document.querySelector('main, [role="main"], #main-content');t&&(this.readElement(t),a("Reading page content"))},readSelection(){const e=window.getSelection().toString().trim();e?(this.speak(e),a("Reading selected text")):a("No text selected")},pause(){this.synth&&this.isReading&&(this.synth.pause(),this.isPaused=!0,a("Reading paused"))},resume(){this.synth&&this.isPaused&&(this.synth.resume(),this.isPaused=!1,a("Reading resumed"))},stop(){this.synth&&(this.synth.cancel(),this.isReading=!1,this.isPaused=!1,document.documentElement.removeAttribute("data-tts-active"),this.currentElement&&(this.currentElement.classList.remove("tts-reading"),this.currentElement=null))},toggle(){this.isReading&&!this.isPaused?this.pause():this.isPaused?this.resume():this.readPage()},init(){if(!this.synth)return;const t=m();t.ttsRate&&(this.rate=t.ttsRate),t.ttsPitch&&(this.pitch=t.ttsPitch),this.synth.onvoiceschanged!==void 0&&(this.synth.onvoiceschanged=()=>{const e=this.getVoices();t.ttsVoice?this.setVoice(t.ttsVoice):e.length>0&&(this.voice=e.find(n=>n.lang.startsWith("en"))||e[0])}),console.log("[A11Y] Text-to-Speech initialized")}};window.a11yTTS=u,window.a11yReadPage=()=>u.readPage(),window.a11yReadSelection=()=>u.readSelection(),window.a11yStopReading=()=>u.stop(),window.a11yPauseReading=()=>u.pause(),window.a11yResumeReading=()=>u.resume();function S(){return u.toggle(),u.isReading}window.a11yToggleTextToSpeech=S;const C={flash(t="#ffff00",e=200){const n=document.createElement("div");n.className="a11y-visual-alert",n.style.cssText=`
        position: fixed;
        inset: 0;
        background: ${t};
        opacity: 0.5;
        z-index: 100000;
        pointer-events: none;
        animation: a11y-flash ${e}ms ease-out;
      `,document.body.appendChild(n),setTimeout(()=>n.remove(),e)},notify(t,e={}){const n=document.createElement("div");n.className="a11y-visual-notification",n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive");const s=document.createElement("span");s.className="notification-icon",s.setAttribute("aria-hidden","true"),s.textContent=e.icon||"\u2139\uFE0F";const r=document.createElement("span");r.className="notification-message",r.textContent=t,n.appendChild(s),n.appendChild(r),n.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 24px;
        background: ${e.background||"#1a2a3a"};
        color: ${e.color||"#ffffff"};
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 100000;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 16px;
        max-width: 400px;
        animation: a11y-slide-in 0.3s ease-out;
      `,document.body.appendChild(n),setTimeout(()=>{n.style.animation="a11y-slide-out 0.3s ease-in forwards",setTimeout(()=>n.remove(),300)},e.duration||5e3)},convertAudioToVisual(){const t=window.alert;window.alert=e=>{this.notify(e,{icon:"\u26A0\uFE0F"}),t(e)}}};window.a11yVisualAlerts=C;function z(){document.querySelectorAll("video").forEach(e=>{var s;if(!e.querySelector('track[kind="captions"], track[kind="subtitles"]')){(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&console.warn("[A11Y] Video without captions:",e.src||((s=e.querySelector("source"))==null?void 0:s.src));const r=e.parentElement;if(r&&!r.querySelector(".no-captions-warning")){const o=document.createElement("div");o.className="no-captions-warning",o.setAttribute("role","note");const i=document.createElement("span");i.setAttribute("aria-hidden","true"),i.textContent="\u{1F507}";const c=document.createElement("span");c.textContent="Captions not available for this video",o.appendChild(i),o.appendChild(document.createTextNode(" ")),o.appendChild(c),r.appendChild(o)}}})}function K(){const t=document.documentElement.hasAttribute("data-custom-cursor");t?(document.documentElement.removeAttribute("data-custom-cursor"),window.TillersteadCursor&&window.TillersteadCursor.disable()):(document.documentElement.setAttribute("data-custom-cursor","true"),window.TillersteadCursor&&window.TillersteadCursor.enable());const e=document.getElementById("a11y-cursor");e&&e.setAttribute("aria-pressed",(!t).toString());const n=JSON.parse(localStorage.getItem("tillerstead-a11y-prefs")||"{}");n.customCursor=!t,localStorage.setItem("tillerstead-a11y-prefs",JSON.stringify(n))}window.a11yToggleHighContrast=H,window.a11yToggleTextSize=x,window.a11yToggleCustomCursor=K;function Y(){if(!(new URLSearchParams(window.location.search).has("a11y-tools")||m().showToolbar))return;const n=document.createElement("div");n.className="a11y-toolbar",n.setAttribute("role","toolbar"),n.setAttribute("aria-label","Accessibility options");const s=[{icon:"A+",label:"Increase text size",action:x,pref:"textSize"}],r=m();s.forEach(({icon:o,label:i,action:c,pref:l})=>{const d=document.createElement("button");d.type="button",d.textContent=o,d.setAttribute("aria-label",i),d.setAttribute("title",i),r[l]&&d.setAttribute("aria-pressed","true"),d.addEventListener("click",()=>{const h=c();d.setAttribute("aria-pressed",h?"true":"false")}),n.appendChild(d)}),document.body.appendChild(n)}function k(){document.querySelectorAll("form").forEach(e=>{e.setAttribute("novalidate",""),e.querySelectorAll('[required], [aria-required="true"]').forEach(s=>{s.setAttribute("aria-required","true");const r=e.querySelector(`label[for="${s.id}"]`);if(r&&!r.querySelector(".required-indicator")){const o=document.createElement("span");o.className="required-indicator",o.setAttribute("aria-hidden","true"),o.textContent=" *",r.appendChild(o)}}),e.addEventListener("submit",s=>{const r=e.querySelectorAll(":invalid");if(r.length>0){s.preventDefault();let o=document.getElementById(`${e.id}-errors`);o||(o=document.createElement("div"),o.id=`${e.id}-errors`,o.className="error-summary",o.setAttribute("role","alert"),o.setAttribute("tabindex","-1"),e.insertBefore(o,e.firstChild));const i=document.createElement("ul");r.forEach(l=>{var M,D;l.setAttribute("aria-invalid","true");const d=`${l.id}-error`;let h=document.getElementById(d);h||(h=document.createElement("div"),h.id=d,h.className="field-error-message",h.setAttribute("role","alert"),l.parentNode.appendChild(h)),h.textContent=l.validationMessage,l.setAttribute("aria-describedby",d);const L=document.createElement("li"),p=document.createElement("a");p.href=`#${l.id}`,p.textContent=`${((D=(M=l.labels)==null?void 0:M[0])==null?void 0:D.textContent)||l.name}: ${l.validationMessage}`,L.appendChild(p),i.appendChild(L)});const c=document.createElement("h3");c.textContent="Please correct the following errors:",o.appendChild(c),o.appendChild(i),o.focus(),a(`Form has ${r.length} error${r.length>1?"s":""}. Please correct them.`,{assertive:!0})}}),e.addEventListener("input",s=>{const r=s.target;if(r.validity.valid&&r.getAttribute("aria-invalid")==="true"){r.setAttribute("aria-invalid","false"),r.classList.add("touched");const o=document.getElementById(`${r.id}-error`);o&&(o.textContent="")}})})}function B(){if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){const t=document.querySelectorAll("img:not([alt])");t.length>0&&(console.warn(`[A11Y] Found ${t.length} images without alt text:`),t.forEach(e=>{console.warn(`  - ${e.src}`)}))}}function Q(){document.querySelectorAll('a[href^="http"]:not([href*="tillerstead"])').forEach(e=>{if(e.setAttribute("rel","noopener noreferrer"),!e.querySelector(".sr-only")&&!e.getAttribute("aria-label")){const n=document.createElement("span");n.className="sr-only",n.textContent=" (opens in new window)",e.appendChild(n)}e.hasAttribute("target")||e.setAttribute("target","_blank")})}function O(){if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){const t=document.querySelectorAll("h1, h2, h3, h4, h5, h6");let e=0,n=[];const s=document.querySelectorAll("h1");s.length===0?n.push("No H1 heading found on page"):s.length>1&&n.push(`Multiple H1 headings found (${s.length})`),t.forEach((r,o)=>{const i=parseInt(r.tagName[1]);o>0&&i>e+1&&n.push(`Skipped heading level: H${e} to H${i} ("${r.textContent.substring(0,30)}...")`),e=i}),n.length>0&&(console.warn("[A11Y] Heading structure issues:"),n.forEach(r=>console.warn(`  - ${r}`)))}}function T(){V(),y(),w(),A(),E(),P(),I(),k(),Q(),u.init(),C.convertAudioToVisual(),z(),B(),O(),Y(),document.addEventListener("keydown",e=>{e.altKey&&e.key==="r"&&(e.preventDefault(),S()),e.altKey&&e.key==="s"&&(e.preventDefault(),u.stop()),e.altKey&&e.key==="p"&&(e.preventDefault(),u.isPaused?u.resume():u.pause())});const t=document.title||"Page";setTimeout(()=>{a(`${t} loaded`)},500),console.log("[A11Y] Accessibility features initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T):T(),new MutationObserver(q(()=>{A(),E(),k()},250)).observe(document.body,{childList:!0,subtree:!0})})();})();
