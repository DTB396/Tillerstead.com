(()=>{(function(){"use strict";const y=[26,61,46,201,162,39,33,37,41,108,117,125,248,249,250,255,255,255,206,212,218],o={primary:y.slice(0,3),gold:y.slice(3,6),text:y.slice(6,9),textMuted:y.slice(9,12),surface:y.slice(12,15),white:y.slice(15,18),border:y.slice(18,21)},d=Object.freeze({name:"TILLERSTEAD LLC",tagline:"Expert Tile Installation",license:"NJ HIC #13VH10808800",website:"tillerstead.com",phone:"(609) 862-8808",email:"info@tillerstead.com",appName:"TillerPro"});function T(){if(typeof window!="undefined"&&window.TillerLogo)try{const n=window.TillerLogo.instance.getLogo("pdf");if(n&&n.data)return{data:n.data,type:n.format||"PNG",fallback:n.fallback}}catch(n){console.warn("[TillerPDF] Logo system error:",n)}return{data:P,type:"PNG",fallback:S()}}function S(){return`[${d.appName}]`}const P="data:image/png;base64,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",b={tile:"Tile Quantity",mortar:"Mortar Coverage",grout:"Grout Calculator",leveling:"Self-Leveling Compound",slope:"Shower Slope",waterproof:"Waterproofing",labor:"Labor Estimate",crown:"Crown Molding",baseboard:"Baseboard & Chair Rail",quarter:"Quarter Round"};class m{constructor(){this.doc=null,this.pageWidth=0,this.pageHeight=0,this.margin=20,this.y=0,this._jsPDFConstructor=null}async init(){if(window._jsPDFReady)try{await window._jsPDFReady}catch(i){console.error("[TillerPro PDF] jsPDF load promise rejected:",i)}const e=window.jsPDF||window.jspdf;if(!e)throw new Error("jsPDF library not loaded. Please refresh the page.");const t=e.jsPDF||e;this._jsPDFConstructor=t,this.doc=new t({orientation:"portrait",unit:"mm",format:"letter"}),this.pageWidth=this.doc.internal.pageSize.getWidth(),this.pageHeight=this.doc.internal.pageSize.getHeight(),this.y=this.margin}addHeader(e="Project Estimate"){const t=this.doc,i=this.pageWidth-this.margin*2;t.setFillColor(...o.primary),t.rect(0,0,this.pageWidth,45,"F"),t.setFillColor(...o.gold),t.rect(0,45,this.pageWidth,2,"F");try{t.addImage(LOGO_BASE64,"PNG",this.margin,5,35,35)}catch(r){console.warn("Could not add logo to PDF:",r)}const a=this.margin+40;t.setTextColor(...o.white),t.setFont("helvetica","bold"),t.setFontSize(18),t.text(d.name,a,16),t.setFont("helvetica","normal"),t.setFontSize(12),t.text(e,a,26),t.setFontSize(9),t.setTextColor(200,200,200),t.text(d.license,a,36),t.setTextColor(...o.white),t.setFontSize(9);const s=this.pageWidth-this.margin;t.text(d.website,s,16,{align:"right"}),t.text(d.phone,s,23,{align:"right"}),t.text(d.email,s,30,{align:"right"}),this.y=55}addProjectInfo(e){const t=this.doc,i=this.pageWidth-this.margin*2;t.setFillColor(...o.surface),t.rect(this.margin,this.y,i,25,"F"),t.setTextColor(...o.text),t.setFont("helvetica","bold"),t.setFontSize(11),t.text("Project:",this.margin+5,this.y+8),t.setFont("helvetica","normal"),t.text(e.name||"Untitled Project",this.margin+28,this.y+8),t.setFontSize(9),t.setTextColor(...o.textMuted),t.text(`Date: ${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`,this.margin+5,this.y+16),e.clientName&&t.text(`Client: ${e.clientName}`,this.margin+5,this.y+22),this.y+=32}addSectionTitle(e){const t=this.doc;this.y>this.pageHeight-60&&this.addNewPage(),t.setFillColor(...o.primary),t.rect(this.margin,this.y,this.pageWidth-this.margin*2,8,"F"),t.setTextColor(...o.white),t.setFont("helvetica","bold"),t.setFontSize(10),t.text(e,this.margin+3,this.y+5.5),this.y+=12}addMaterialTable(e){const t=this.doc;if(!e||e.length===0){t.setTextColor(...o.textMuted),t.setFont("helvetica","italic"),t.setFontSize(9),t.text("No materials calculated",this.margin,this.y+5),this.y+=12;return}typeof t.autoTable=="function"?(t.autoTable({startY:this.y,head:[["Material","Specification","Quantity"]],body:e.map(i=>[i.name,i.spec||"\u2014",i.quantity]),margin:{left:this.margin,right:this.margin},headStyles:{fillColor:o.primary,textColor:o.white,fontStyle:"bold",fontSize:9},bodyStyles:{textColor:o.text,fontSize:9},alternateRowStyles:{fillColor:o.surface},columnStyles:{0:{cellWidth:50},1:{cellWidth:70},2:{cellWidth:40,halign:"right",fontStyle:"bold"}}}),this.y=t.lastAutoTable.finalY+8):this.addSimpleTable(e)}addSimpleTable(e){const t=this.doc,i=this.margin,a=[50,70,40],s=7;t.setFillColor(...o.primary),t.rect(i,this.y,a.reduce((r,l)=>r+l,0),s,"F"),t.setTextColor(...o.white),t.setFont("helvetica","bold"),t.setFontSize(9),t.text("Material",i+2,this.y+5),t.text("Specification",i+a[0]+2,this.y+5),t.text("Quantity",i+a[0]+a[1]+2,this.y+5),this.y+=s,t.setTextColor(...o.text),e.forEach((r,l)=>{l%2===0&&(t.setFillColor(...o.surface),t.rect(i,this.y,a.reduce((h,f)=>h+f,0),s,"F")),t.setFont("helvetica","normal"),t.text(r.name,i+2,this.y+5),t.text(r.spec||"\u2014",i+a[0]+2,this.y+5),t.setFont("helvetica","bold"),t.text(r.quantity,i+a[0]+a[1]+2,this.y+5),this.y+=s}),this.y+=5}addCalculationDetails(e,t,i){const a=this.doc;this.y>this.pageHeight-80&&this.addNewPage();const s=b[e]||e;a.setFillColor(...o.gold),a.rect(this.margin,this.y,3,6,"F"),a.setTextColor(...o.text),a.setFont("helvetica","bold"),a.setFontSize(10),a.text(s,this.margin+6,this.y+5),this.y+=10,a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...o.textMuted);const r=this.getInputLabels(e),l=[];Object.entries(t).forEach(([g,c])=>{if(c!=null&&c!==""){const u=r[g]||this.formatLabel(g);l.push(`${u}: ${this.formatValue(g,c)}`)}});const h=Math.ceil(l.length/2),f=l.slice(0,h),D=l.slice(h),x=5,w=this.y;if(f.forEach((g,c)=>{a.text(g,this.margin+5,this.y),this.y+=x}),this.y=w,D.forEach((g,c)=>{a.text(g,this.margin+90,this.y),this.y+=x}),this.y=w+Math.max(f.length,D.length)*x+3,i){a.setTextColor(...o.primary),a.setFont("helvetica","bold");const g=this.getResultLabels(e);Object.entries(i).forEach(([c,u])=>{if(u!=null&&c!=="note"){const p=g[c]||this.formatLabel(c);a.text(`\u2192 ${p}: ${u}`,this.margin+5,this.y),this.y+=5}}),i.note&&(a.setTextColor(...o.textMuted),a.setFont("helvetica","italic"),a.setFontSize(8),a.text(`Note: ${i.note}`,this.margin+5,this.y+2),this.y+=6)}this.y+=5}addFooter(e=1,t=1){const i=this.doc,a=this.pageHeight-20;i.setFillColor(...o.surface),i.rect(0,a-5,this.pageWidth,25,"F"),i.setFillColor(...o.gold),i.rect(0,a-5,this.pageWidth,1,"F"),i.setTextColor(...o.primary),i.setFont("helvetica","bold"),i.setFontSize(8),i.text("TCNA 2024 Compliant Calculations",this.margin,a+2),i.setTextColor(...o.textMuted),i.setFont("helvetica","normal"),i.setFontSize(7),i.text("Generated by TillerPro",this.margin,a+7),i.text(`${d.website} | ${d.phone}`,this.margin,a+11),i.text(`Page ${e} of ${t}`,this.pageWidth-this.margin,a+7,{align:"right"}),i.setFontSize(6),i.text(`Generated: ${new Date().toLocaleString()}`,this.pageWidth-this.margin,a+11,{align:"right"})}addDisclaimer(){const e=this.doc,t=this.pageHeight-45,i=this.pageWidth-this.margin*2;this.y>t-10&&this.addNewPage(),e.setDrawColor(...o.border),e.setFillColor(255,252,245),e.roundedRect(this.margin,t,i,20,2,2,"FD"),e.setTextColor(...o.textMuted),e.setFont("helvetica","italic"),e.setFontSize(7);const a=["DISCLAIMER: This estimate is for planning purposes only and does not constitute a binding quote.","Actual material quantities may vary based on site conditions, tile breakage, pattern complexity, and cutting waste.","Final pricing requires on-site measurement. Contact Tillerstead LLC for a professional consultation and formal quote."];let s=t+5;a.forEach(r=>{e.text(r,this.margin+3,s),s+=4}),e.setFont("helvetica","bold"),e.setFontSize(6),e.text("NJ Home Improvement Contractor Lic. #13VH10808800 | Consumer Affairs: 1-800-242-5846",this.pageWidth/2,t+18,{align:"center"})}addNewPage(){this.doc.addPage(),this.y=this.margin;const e=this.doc;e.setFillColor(...o.primary),e.rect(0,0,this.pageWidth,15,"F"),e.setTextColor(...o.white),e.setFont("helvetica","bold"),e.setFontSize(10),e.text(d.name,this.margin,10),e.setFont("helvetica","normal"),e.setFontSize(8),e.text("(continued)",this.pageWidth-this.margin,10,{align:"right"}),this.y=22}getInputLabels(e){return{tile:{area:"Total Area",tileSize:"Tile Size",layout:"Layout Pattern",waste:"Waste Factor",tilesPerBox:"Tiles/Box",sqftPerBox:"Sq.Ft./Box",atticStock:"Attic Stock"},mortar:{area:"Coverage Area",trowelSize:"Trowel Size",backButter:"Back Butter",substrate:"Substrate Type",bagSize:"Bag Size"},grout:{area:"Total Area",tileWidth:"Tile Width",tileHeight:"Tile Height",jointWidth:"Joint Width",jointDepth:"Joint Depth",groutType:"Grout Type"},leveling:{area:"Floor Area",avgDepth:"Average Depth",productType:"Product Type"},slope:{drainDistance:"Drain Distance",slopeRatio:"Slope Ratio"},waterproof:{area:"Total Area",coats:"Number of Coats",membraneType:"Membrane Type"},labor:{area:"Project Area",complexity:"Complexity",tileSize:"Tile Size",crew:"Crew Size"}}[e]||{}}getResultLabels(e){return{tile:{tilesNeeded:"Tiles Needed",boxesNeeded:"Boxes Required",totalSqFt:"Total Coverage"},mortar:{bagsNeeded:"Bags Required",coverage:"Coverage Rate"},grout:{bagsNeeded:"Bags Required",lbs:"Total Weight"},leveling:{bagsNeeded:"Bags Required",volume:"Total Volume"},slope:{height:"Height at Wall",mudDepth:"Mud Depth"},waterproof:{gallons:"Gallons Needed",buckets:"Buckets Required"},labor:{hours:"Estimated Hours",days:"Work Days"}}[e]||{}}formatLabel(e){return e.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim()}formatValue(e,t){return typeof t=="boolean"?t?"Yes":"No":e.toLowerCase().includes("area")&&typeof t=="number"?`${t} sq ft`:e.toLowerCase().includes("depth")&&typeof t=="number"?`${t}"`:String(t)}extractMaterials(e){const t=[];return e.calculations&&Object.entries(e.calculations).forEach(([i,a])=>{const s=a.results||{},r=a.inputs||{};switch(i){case"tile":s.boxesNeeded&&t.push({name:"Tile",spec:r.tileSize||"Custom",quantity:`${s.boxesNeeded} boxes`});break;case"mortar":s.bagsNeeded&&t.push({name:"Thin-Set Mortar",spec:r.mortarType||"Modified",quantity:`${s.bagsNeeded} bags`});break;case"grout":s.bagsNeeded&&t.push({name:"Grout",spec:r.groutType||"Sanded",quantity:`${s.bagsNeeded} bags`});break;case"leveling":s.bagsNeeded&&t.push({name:"Self-Leveling Compound",spec:r.productType||"Standard",quantity:`${s.bagsNeeded} bags`});break;case"waterproof":(s.gallons||s.buckets)&&t.push({name:"Waterproofing Membrane",spec:r.membraneType||"Liquid",quantity:s.buckets?`${s.buckets} buckets`:`${s.gallons} gal`});break}}),t}async generateProjectSummary(e){await this.init(),this.addHeader("Project Summary"),this.addProjectInfo(e);const t=this.extractMaterials(e);t.length>0&&(this.addSectionTitle("MATERIAL SUMMARY"),this.addMaterialTable(t)),e.calculations&&Object.keys(e.calculations).length>0&&(this.addSectionTitle("CALCULATION DETAILS"),Object.entries(e.calculations).forEach(([a,s])=>{this.addCalculationDetails(a,s.inputs||{},s.results||null)})),e.notes&&(this.addSectionTitle("PROJECT NOTES"),this.doc.setTextColor(...o.text),this.doc.setFont("helvetica","normal"),this.doc.setFontSize(9),this.doc.splitTextToSize(e.notes,this.pageWidth-this.margin*2-10).forEach(s=>{this.y>this.pageHeight-40&&this.addNewPage(),this.doc.text(s,this.margin+5,this.y),this.y+=5})),this.addDisclaimer();const i=this.doc.internal.getNumberOfPages();for(let a=1;a<=i;a++)this.doc.setPage(a),this.addFooter(a,i);return this.doc}async generateMaterialList(e){await this.init(),this.addHeader("Material List"),this.addProjectInfo(e);const t=this.extractMaterials(e);return this.addSectionTitle("MATERIALS REQUIRED"),this.addMaterialTable(t),this.y+=10,this.doc.setTextColor(...o.textMuted),this.doc.setFont("helvetica","italic"),this.doc.setFontSize(8),this.doc.text("Note: Quantities include calculated waste factors. Verify availability before purchase.",this.margin,this.y),this.addDisclaimer(),this.addFooter(1,1),this.doc}async generateQuickEstimate(e,t,i,a="Quick Estimate",s=[]){await this.init(),this.addHeader("Quick Estimate");const r=this.doc;r.setFillColor(...o.surface),r.rect(this.margin,this.y,this.pageWidth-this.margin*2,15,"F"),r.setTextColor(...o.text),r.setFont("helvetica","bold"),r.setFontSize(11),r.text(a,this.margin+5,this.y+6),r.setFont("helvetica","normal"),r.setFontSize(9),r.setTextColor(...o.textMuted),r.text(new Date().toLocaleDateString(),this.margin+5,this.y+12),this.y+=22;const l=b[e]||e;this.addSectionTitle(l.toUpperCase()),this.addCalculationDetails(e,t,i);const h=[];return e==="tile"&&i.boxesNeeded?h.push({name:"Tile",spec:t.tileSize||"Custom",quantity:`${i.boxesNeeded} boxes`}):e==="mortar"&&i.bagsNeeded?h.push({name:"Mortar",spec:t.mortarType||"Modified",quantity:`${i.bagsNeeded} bags`}):e==="grout"&&i.bagsNeeded&&h.push({name:"Grout",spec:t.groutType||"Sanded",quantity:`${i.bagsNeeded} bags`}),h.length>0&&(this.addSectionTitle("MATERIAL NEEDED"),this.addMaterialTable(h)),s&&s.length>0&&(this.addSectionTitle("SHOPPING LIST SUMMARY"),this.addShoppingListTable(s)),this.addDisclaimer(),this.addFooter(1,1),this.doc}addShoppingListTable(e){const t=this.doc;if(!e||e.length===0){t.setTextColor(...o.textMuted),t.setFont("helvetica","italic"),t.setFontSize(9),t.text("No items in shopping list",this.margin,this.y+5),this.y+=12;return}typeof t.autoTable=="function"?(t.autoTable({startY:this.y,head:[["Item","Quantity","Unit","Source"]],body:e.map(i=>[i.item,i.quantity,i.unit||"",this.formatCalcSource(i.source)]),margin:{left:this.margin,right:this.margin},headStyles:{fillColor:o.gold,textColor:[33,37,41],fontStyle:"bold",fontSize:9},bodyStyles:{textColor:o.text,fontSize:9},alternateRowStyles:{fillColor:o.surface},columnStyles:{0:{cellWidth:55},1:{cellWidth:25,halign:"right",fontStyle:"bold"},2:{cellWidth:35},3:{cellWidth:40,fontStyle:"italic"}}}),this.y=t.lastAutoTable.finalY+8):this.addSimpleShoppingTable(e)}addSimpleShoppingTable(e){const t=this.doc,i=this.margin,a=[55,25,35,40],s=7;t.setFillColor(...o.gold),t.rect(i,this.y,a.reduce((r,l)=>r+l,0),s,"F"),t.setTextColor(33,37,41),t.setFont("helvetica","bold"),t.setFontSize(9),t.text("Item",i+2,this.y+5),t.text("Qty",i+a[0]+2,this.y+5),t.text("Unit",i+a[0]+a[1]+2,this.y+5),t.text("Source",i+a[0]+a[1]+a[2]+2,this.y+5),this.y+=s,t.setTextColor(...o.text),e.forEach((r,l)=>{l%2===0&&(t.setFillColor(...o.surface),t.rect(i,this.y,a.reduce((h,f)=>h+f,0),s,"F")),t.setFont("helvetica","normal"),t.text(String(r.item||""),i+2,this.y+5),t.setFont("helvetica","bold"),t.text(String(r.quantity||""),i+a[0]+2,this.y+5),t.setFont("helvetica","normal"),t.text(String(r.unit||""),i+a[0]+a[1]+2,this.y+5),t.setFont("helvetica","italic"),t.text(this.formatCalcSource(r.source),i+a[0]+a[1]+a[2]+2,this.y+5),this.y+=s}),this.y+=5}formatCalcSource(e){return{tile:"Tile Calc",mortar:"Mortar Calc",grout:"Grout Calc",leveling:"Leveling Calc",waterproof:"Waterproof Calc",sealant:"Sealant Calc",sealer:"Sealer Calc"}[e]||e||""}save(e="tillerstead",t=""){const i=t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"").slice(0,30),a=new Date().toISOString().slice(0,10),s=i?`${e}-${i}-${a}.pdf`:`${e}-estimate-${a}.pdf`;return this.doc.save(s),s}getBlob(){return this.doc.output("blob")}getDataUri(){return this.doc.output("datauristring")}}window.TillerPDF={Generator:m,async downloadProjectSummary(n){try{const e=new m;return await e.generateProjectSummary(n),{success:!0,filename:e.save("tillerpro-project",n.name)}}catch(e){return console.error("[TillerPro PDF] Generation failed:",e),{success:!1,error:e.message}}},async downloadMaterialList(n){try{const e=new m;return await e.generateMaterialList(n),{success:!0,filename:e.save("tillerpro-materials",n.name)}}catch(e){return console.error("[TillerPro PDF] Generation failed:",e),{success:!1,error:e.message}}},async downloadQuickEstimate(n,e,t,i,a=[]){try{const s=new m;return await s.generateQuickEstimate(n,e,t,i,a),{success:!0,filename:s.save("tillerpro-estimate",i||n)}}catch(s){return console.error("[TillerPro PDF] Generation failed:",s),{success:!1,error:s.message}}},isAvailable(){return!!(window.jsPDF||window.jspdf)},async waitForLibrary(n=5e3){if(this.isAvailable())return!0;if(window._jsPDFReady)try{return await Promise.race([window._jsPDFReady,new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),n))]),this.isAvailable()}catch(e){return!1}return!1}}})();})();
