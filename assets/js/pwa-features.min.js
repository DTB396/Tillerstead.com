(()=>{class o{constructor(){this.deferredPrompt=null,this.init()}init(){this.initInstallPrompt(),this.initPushNotifications(),this.initBackgroundSync(),this.initServiceWorkerUpdates(),this.initAppBadge()}initInstallPrompt(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),this.deferredPrompt=t,this.showInstallPrompt()}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App installed successfully"),this.deferredPrompt=null,this.hideInstallPrompt(),window.haptics&&window.haptics.trigger("success"),typeof gtag!="undefined"&&gtag("event","pwa_install",{event_category:"engagement",event_label:"app_installed"})})}showInstallPrompt(){if(localStorage.getItem("tillerstead-install-dismissed")==="1")return;const t=parseInt(localStorage.getItem("tillerstead-visit-count")||"0")+1;if(localStorage.setItem("tillerstead-visit-count",t.toString()),t<2)return;const e=document.createElement("div");e.className="pwa-install-banner",e.innerHTML=`
      <div class="pwa-install-content">
        <div class="pwa-install-icon">\u{1F4F1}</div>
        <div class="pwa-install-text">
          <strong>Install Tillerstead App</strong>
          <p>Get quick access to tools and portfolio</p>
        </div>
        <button class="pwa-install-btn" aria-label="Install app">Install</button>
        <button class="pwa-install-close" aria-label="Dismiss install prompt">\u2715</button>
      </div>
    `,document.body.appendChild(e),setTimeout(()=>e.classList.add("show"),100),e.querySelector(".pwa-install-btn").addEventListener("click",async()=>{if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:i}=await this.deferredPrompt.userChoice;console.log(`[PWA] User ${i} the install prompt`),this.deferredPrompt=null,this.hideInstallPrompt()}),e.querySelector(".pwa-install-close").addEventListener("click",()=>{localStorage.setItem("tillerstead-install-dismissed","1"),this.hideInstallPrompt()})}hideInstallPrompt(){const t=document.querySelector(".pwa-install-banner");t&&(t.classList.remove("show"),setTimeout(()=>t.remove(),300))}initPushNotifications(){!("Notification"in window)||!("serviceWorker"in navigator)||Notification.permission==="granted"&&this.subscribeToPush()}async requestNotificationPermission(){return"Notification"in window&&await Notification.requestPermission()==="granted"?(console.log("[PWA] Notification permission granted"),await this.subscribeToPush(),!0):!1}async subscribeToPush(){try{const t=await navigator.serviceWorker.ready;if(await t.pushManager.getSubscription()){console.log("[PWA] Already subscribed to push");return}const i=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array("YOUR_VAPID_PUBLIC_KEY")});console.log("[PWA] Push subscription created:",i),await this.sendSubscriptionToServer(i)}catch(t){console.error("[PWA] Failed to subscribe to push:",t)}}async sendSubscriptionToServer(t){console.log("[PWA] Would send subscription to server:",t)}urlBase64ToUint8Array(t){const e="=".repeat((4-t.length%4)%4),i=(t+e).replace(/-/g,"+").replace(/_/g,"/"),s=window.atob(i),n=new Uint8Array(s.length);for(let a=0;a<s.length;++a)n[a]=s.charCodeAt(a);return n}initBackgroundSync(){if(!("serviceWorker"in navigator)||!("SyncManager"in window)){console.log("[PWA] Background sync not supported");return}document.addEventListener("submit",t=>{const e=t.target;e.matches("#contact-form, .contact-form")&&(navigator.onLine||(t.preventDefault(),this.queueFormSubmission(e)))})}async queueFormSubmission(t){const e=new FormData(t),i=Object.fromEntries(e.entries()),s=JSON.parse(localStorage.getItem("tillerstead-form-queue")||"[]");s.push({timestamp:Date.now(),data:i}),localStorage.setItem("tillerstead-form-queue",JSON.stringify(s));try{await(await navigator.serviceWorker.ready).sync.register("form-sync"),this.showOfflineMessage("Your message will be sent when you're back online"),window.haptics&&window.haptics.trigger("success")}catch(n){console.error("[PWA] Background sync registration failed:",n),this.showOfflineMessage("Please try again when you're back online")}}showOfflineMessage(t){const e=document.createElement("div");e.className="pwa-toast",e.textContent=t,e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),document.body.appendChild(e),setTimeout(()=>e.classList.add("show"),100),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)},4e3)}initServiceWorkerUpdates(){"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{this.showUpdateNotification()}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(t=>{t&&t.update()})},6e4))}showUpdateNotification(){const t=document.createElement("div");t.className="pwa-update-banner",t.innerHTML=`
      <div class="pwa-update-content">
        <span>\u{1F389} New version available!</span>
        <button class="pwa-update-btn">Refresh</button>
      </div>
    `,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),100),t.querySelector(".pwa-update-btn").addEventListener("click",()=>{window.location.reload()})}initAppBadge(){if(!("setAppBadge"in navigator)){console.log("[PWA] App Badge API not supported");return}this.updateAppBadge(0)}async updateAppBadge(t){"setAppBadge"in navigator&&(t>0?await navigator.setAppBadge(t):await navigator.clearAppBadge())}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.pwaFeatures=new o}):window.pwaFeatures=new o;var l=o;})();
