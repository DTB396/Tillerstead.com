(()=>{(()=>{"use strict";const o=new URLSearchParams(location.search).get("audit"),p=localStorage.getItem("ts:audit");if(!(o==="1"||p==="1"))return;function b(){return[...document.querySelectorAll("[data-contrast-fixed]")].map(t=>({tag:t.tagName.toLowerCase(),text:t.textContent.trim().slice(0,80),original:t.getAttribute("data-contrast-original"),background:t.getAttribute("data-contrast-bg"),applied:t.style.color||"",ratio:t.getAttribute("data-contrast-ratio"),tcnaCompliant:t.getAttribute("data-tcna-compliant")==="true"}))}function v(){var d,u,g,m;const t=document.title.trim(),e=((d=document.querySelector('meta[name="description"]'))==null?void 0:d.getAttribute("content"))||"",a=((u=document.querySelector('link[rel="canonical"]'))==null?void 0:u.getAttribute("href"))||"",h=((g=document.querySelector('meta[property="og:image"]'))==null?void 0:g.getAttribute("content"))||"",C=((m=document.querySelector('meta[property="og:image:alt"]'))==null?void 0:m.getAttribute("content"))||"",l=[...document.querySelectorAll("img")].map(s=>({src:s.getAttribute("src"),alt:s.getAttribute("alt")||""}));return{titleLength:t.length,title:t,descriptionLength:e.length,description:e.slice(0,200),canonicalPresent:!!a,canonical:a,ogImage:h,ogImageAlt:C,imgAlts:l,accessibility:l.every(s=>s.alt.length>0)}}function y(){const t=document.createElement("div");return t.className="ts-dev-overlay",t.setAttribute("role","region"),t.setAttribute("aria-label","Developer Audit Panel"),t.innerHTML=`
    <div class="ts-dev-overlay-head">
      <strong>Audit Panel</strong>
      <button type="button" data-close aria-label="Close audit panel" tabindex="0">\xD7</button>
    </div>
    <div class="ts-dev-section">
      <h4>Contrast Fixes <small data-contrast-count></small></h4>
      <div class="ts-dev-contrast-list" data-contrast-list></div>
      <button type="button" data-copy-contrast aria-label="Copy contrast JSON" tabindex="0">Copy JSON</button>
    </div>
    <div class="ts-dev-section">
      <h4>SEO & Accessibility Summary</h4>
      <pre class="ts-dev-seo" data-seo></pre>
    </div>
    <div class="ts-dev-foot">
      <label for="ts-dev-persist"><input id="ts-dev-persist" type="checkbox" data-persist ${o==="1"?"checked":""}/> Persist (localStorage)</label>
    </div>
   `,document.body.appendChild(t),t}function r(t){const e=b();return t.innerHTML=e.length?e.map(a=>`
    <div class="ts-dev-item">
      <code>${a.tag}</code>
      <span class="ts-dev-text">${a.text||"(empty)"}</span>
      <div class="ts-dev-meta">
       <span>orig: <b>${a.original}</b></span>
       <span>bg: <b>${a.background}</b></span>
       <span>new: <b>${a.applied}</b></span>
       <span>ratio: <b>${a.ratio}</b></span>
       <span class="ts-dev-tcna" title="TCNA/ADA Compliance">${a.tcnaCompliant?"TCNA/ADA":"\u2014"}</span>
      </div>
    </div>`).join(""):"<em>No auto-contrast adjustments detected.</em>",n.querySelector("[data-contrast-count]").textContent=`(${e.length})`,e}function A(t){const e=v();return t.textContent=JSON.stringify(e,null,2),e.accessibility||(t.setAttribute("aria-live","polite"),t.insertAdjacentHTML("beforebegin",'<div class="ts-dev-warn" role="alert">\u26A0\uFE0F Some images lack alt text (required by New Jersey HIC & ADA).</div>')),e}const n=y(),i=n.querySelector("[data-contrast-list]"),S=n.querySelector("[data-seo]");let c=r(i);A(S),n.addEventListener("click",t=>{if(t.target.matches("[data-close]"))n.remove();else if(t.target.matches("[data-copy-contrast]"))try{navigator.clipboard.writeText(JSON.stringify(c,null,2)),t.target.textContent="Copied!",setTimeout(()=>t.target.textContent="Copy JSON",1800)}catch(e){}else t.target.matches("[data-persist]")&&(t.target.checked?localStorage.setItem("ts:audit","1"):localStorage.removeItem("ts:audit"))}),setTimeout(()=>{c=r(i)},600)})();})();
