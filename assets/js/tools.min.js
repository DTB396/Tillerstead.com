(()=>{(function(){"use strict";const de=[{id:"mosaic-1x1",name:"1\xD71 Mosaic (12\xD712 sheet)",width:1,height:1,isMosaic:!0,sheetCoverage:1},{id:"mosaic-2x2",name:"2\xD72 Mosaic (12\xD712 sheet)",width:2,height:2,isMosaic:!0,sheetCoverage:1},{id:"3x6",name:"3\xD76 Subway",width:3,height:6},{id:"4x4",name:"4\xD74",width:4,height:4},{id:"4x12",name:"4\xD712",width:4,height:12},{id:"6x6",name:"6\xD76",width:6,height:6},{id:"6x24",name:"6\xD724 Plank",width:6,height:24,isPlank:!0,isLargeFormat:!0},{id:"8x48",name:"8\xD748 Plank",width:8,height:48,isPlank:!0,isLargeFormat:!0},{id:"12x12",name:"12\xD712",width:12,height:12},{id:"12x24",name:"12\xD724",width:12,height:24,isLargeFormat:!0},{id:"12x48",name:"12\xD748 Plank",width:12,height:48,isPlank:!0,isLargeFormat:!0},{id:"24x24",name:"24\xD724",width:24,height:24,isLargeFormat:!0},{id:"24x48",name:"24\xD748",width:24,height:48,isLargeFormat:!0},{id:"custom",name:"Custom Size",width:0,height:0,isCustom:!0}],ge=[{id:"straight",name:"Straight / Stacked",wasteFactor:.1,wasteRange:"10%"},{id:"subway-33",name:"1/3 Offset (Recommended for LFT)",wasteFactor:.12,wasteRange:"12%",lftSafe:!0},{id:"subway-50",name:"50% Offset (Brick)",wasteFactor:.15,wasteRange:"15%",lippageRisk:!0,lftWarning:"NOT recommended for LFT\u2014max 33% offset per TCNA"},{id:"brick",name:"Running Bond",wasteFactor:.12,wasteRange:"12%"},{id:"diagonal",name:"Diagonal",wasteFactor:.18,wasteRange:"15\u201320%"},{id:"herringbone",name:"Herringbone",wasteFactor:.25,wasteRange:"20\u201330%"},{id:"mosaic",name:"Mosaic Sheet",wasteFactor:.12,wasteRange:"10\u201315%"}],he=[{id:"1/16",name:'1/16" (minimum)',size:.0625,note:"Absolute minimum per ANSI"},{id:"1/8",name:'1/8" (rectified)',size:.125,note:"Standard for rectified tile"},{id:"3/16",name:'3/16" (calibrated)',size:.1875,note:"Standard for calibrated (non-rectified)"},{id:"1/4",name:'1/4" (rustic/handmade)',size:.25,note:"Handmade/high-variation tile"},{id:"custom",name:"Custom",size:0,isCustom:!0}],be=[{id:"3/16-v",name:'3/16" V-Notch',coverageMin:100,coverageMax:130,forTiles:"mosaic, small wall"},{id:"1/4-sq",name:'1/4" \xD7 1/4" Square',coverageMin:90,coverageMax:100,forTiles:"up to 8\xD78"},{id:"1/4x3/8-sq",name:'1/4" \xD7 3/8" Square',coverageMin:60,coverageMax:67,forTiles:"8\xD78 to 13\xD713"},{id:"1/2-sq",name:'1/2" \xD7 1/2" Square',coverageMin:42,coverageMax:47,forTiles:"not recommended for LFT",notForLFT:!0},{id:"3/4-u-45",name:'3/4" \xD7 9/16" U-Notch @ 45\xB0',coverageMin:34,coverageMax:38,forTiles:'LFT \u226515"',forLFT:!0},{id:"3/4-u-30",name:'3/4" \xD7 9/16" U-Notch @ 30\xB0',coverageMin:42,coverageMax:47,forTiles:'LFT \u226515" (best)',forLFT:!0,recommended:!0}],fa=1.86,Ce=.45,ve="tillerstead_tools_project",Z={interior:{standard:24,highTemp:20},exterior:{standard:12,highTemp:8}},Le={polished:{min:800,max:1e3,note:"Polished porcelain / dense stone"},semi_porcelain:{min:400,max:600,note:"Semi-porous porcelain/ceramic"},natural_stone:{min:200,max:400,note:"Honed/rough natural stone"},concrete:{min:150,max:250,note:"Broom finish or open concrete"}},ye={porous:{min:200,max:300},nonPorous:{min:300,max:400}};function I(a,e){const o=Math.pow(10,e);return Math.round(a*o)/o}function E(a,e){const o=parseFloat(a);return isNaN(o)||o<=0?{valid:!1,error:`${e} must be a positive number`}:{valid:!0,value:o}}function we(a,e){const o=parseFloat(a);return isNaN(o)||o<0?{valid:!1,error:`${e} must be zero or positive`}:{valid:!0,value:o}}function Ze({lengthFt:a,widthFt:e,exposure:o="interior",tempSwingF:t=30,isSunExposed:n=!1}){const s=[],l=[],c=E(a,"Length"),d=E(e,"Width"),r=we(t,"Temperature swing");if(c.valid||s.push(c.error),d.valid||s.push(d.error),r.valid||s.push(r.error),s.length>0)return{valid:!1,errors:s,spacingFt:0,jointsLong:0,jointsShort:0,totalJoints:0,assumptions:l};const u=o==="exterior"||n,m=r.value>=40?u?Z.exterior.highTemp:Z.interior.highTemp:u?Z.exterior.standard:Z.interior.standard,f=Math.max(0,k(c.value/m)-1),g=Math.max(0,k(d.value/m)-1),p=f+g;return l.push(`Exposure: ${u?"Exterior/Sun/Heated":"Interior (conditioned)"}`),l.push(`Temperature swing: ${r.value}\xB0F`),l.push(`Spacing target per EJ171: ${m} ft grid`),{valid:!0,errors:[],spacingFt:m,jointsLong:f,jointsShort:g,totalJoints:p,assumptions:l}}function Xe({spanFeet:a,joistSpacingInches:e,joistWidthInches:o,joistDepthInches:t,modulusPsi:n=16e5,liveLoadPsft:s=40,deadLoadPsft:l=10}){const c=[],d=[],r=E(a,"Span"),u=E(e,"Joist spacing"),m=E(o,"Joist width"),f=E(t,"Joist depth"),g=E(n,"Modulus");if(r.valid||c.push(r.error),u.valid||c.push(u.error),m.valid||c.push(m.error),f.valid||c.push(f.error),g.valid||c.push(g.error),c.length>0)return{valid:!1,errors:c,deflectionRatio:0,passesCeramic:!1,passesStone:!1,deltaInches:0,assumptions:d};const p=r.value*12,v=m.value*Math.pow(f.value,3)/12,y=s+l,$=5*(y*(u.value/12)/12)*Math.pow(p,4)/(384*g.value*v),j=p/$;return d.push(`Load: ${y} psf (live + dead)`),d.push(`Modulus: ${g.value.toLocaleString()} psi`),d.push(`Section I: ${I(v,2)} in^4`),{valid:!0,errors:[],deflectionRatio:I(j,0),passesCeramic:j>=360,passesStone:j>=720,deltaInches:I($,3),assumptions:d}}function et({areaSqFt:a,wattsPerSqFt:e=12,voltage:o=120,thermostatMaxAmps:t=15}){const n=[],s=[],l=E(a,"Area"),c=E(e,"Watts per sq ft"),d=E(o,"Voltage");if(l.valid||n.push(l.error),c.valid||n.push(c.error),d.valid||n.push(d.error),n.length>0)return{valid:!1,errors:n,totalWatts:0,amps:0,breakerAmps:0,circuits:0,needsRelay:!1,assumptions:s};const r=l.value*c.value,u=r/d.value,m=u*1.25,f=m<=15?15:m<=20?20:30,g=Math.max(1,k(m/f)),p=u>t;return s.push("Continuous load factor 125% applied per NEC"),s.push(`Thermostat relay limit ${t} A`),{valid:!0,errors:[],totalWatts:I(r,1),amps:I(u,2),breakerAmps:f,circuits:g,needsRelay:p,assumptions:s}}function tt({mverLbs:a,rhPercent:e,productLimitMver:o=5,productLimitRh:t=75}){const n=[],s=[],l=we(a,"MVER"),c=we(e,"RH");if(l.valid||n.push(l.error),c.valid||n.push(c.error),n.length>0)return{valid:!1,errors:n,mverPass:!1,rhPass:!1,requiresMitigation:!1,assumptions:s};const d=l.value<=o,r=c.value<=t,u=!(d&&r);return s.push(`Product limits: ${o} lbs MVER, ${t}% RH`),{valid:!0,errors:[],mverPass:d,rhPass:r,requiresMitigation:u,assumptions:s}}function at({bagWeightLbs:a=50,waterQuartsPerBagMin:e=5,waterQuartsPerBagMax:o=6,batchWeightLbs:t,potLifeMinutes:n=120,yieldCuFtPerBag:s=.45}){const l=[],c=[],d=E(a,"Bag weight"),r=E(e,"Water (min)"),u=E(o,"Water (max)"),m=E(s,"Yield");d.valid||l.push(d.error),r.valid||l.push(r.error),u.valid||l.push(u.error),m.valid||l.push(m.error);const f=t?E(t,"Batch weight"):null;if(f&&!f.valid&&l.push(f.error),l.length>0)return{valid:!1,errors:l,waterQuartsRange:[0,0],batchWeightLbs:0,potLifeMinutes:0,estimatedYieldCuFt:0,assumptions:c};const g=(f==null?void 0:f.value)||d.value,p=g/d.value,v=[I(r.value*p,2),I(u.value*p,2)];return c.push("Linear water scaling used for partial batches"),c.push("Yield is approximate; verify with product TDS"),{valid:!0,errors:[],waterQuartsRange:v,batchWeightLbs:g,potLifeMinutes:n,estimatedYieldCuFt:I(m.value*p,2),assumptions:c}}function ot({areaSqFt:a,surface:e="natural_stone",coats:o=2}){const t=[],n=[],s=E(a,"Area"),l=E(o,"Coats");s.valid||t.push(s.error),l.valid||t.push(l.error);const c=Le[e];if(c||t.push(`Unknown surface: ${e}`),t.length>0)return{valid:!1,errors:t,gallons:0,coverageUsedSqFtPerGal:0,assumptions:n};const d=I(s.value*l.value/c.min,2);return n.push(`Surface: ${c.note}`),n.push(`Using conservative coverage: ${c.min} sf/gal`),n.push(`${l.value} coat(s) applied`),{valid:!0,errors:[],gallons:d,coverageUsedSqFtPerGal:c.min,assumptions:n}}function nt({areaSqFt:a,runFeet:e,minThicknessInches:o=1.25,slopeInchesPerFoot:t=.25,bagYieldCuFt:n=.5}){const s=[],l=[],c=E(a,"Area");if(c.valid||s.push(c.error),s.length>0)return{valid:!1,errors:s,volumeCuFt:0,bags:0,assumptions:l};const d=e||Math.sqrt(c.value),r=o+t*d,u=(o+r)/2,m=u/12,f=c.value*m,g=k(f/n);return l.push(`Min thickness at drain: ${o}"`),l.push(`Slope: ${t}" per foot`),l.push(`Avg thickness: ${I(u,2)}"`),l.push(`Bag yield: ${n} cu ft per 50 lb bag`),{valid:!0,errors:[],volumeCuFt:I(f,2),bags:g,avgThicknessInches:I(u,2),assumptions:l}}function st({areaSqFt:a,porosity:e="porous",doublePrime:o=!1}){const t=[],n=[],s=E(a,"Area");s.valid||t.push(s.error);const l=e==="porous"?ye.porous:ye.nonPorous;if(t.length>0)return{valid:!1,errors:t,gallons:0,assumptions:n};const c=o?2:1,d=I(s.value*c/l.min,2);return n.push(`Surface porosity: ${e}`),n.push(`Using conservative coverage: ${l.min} sf/gal`),n.push(`${c} coat(s)`),{valid:!0,errors:[],gallons:d,coats:c,coverageUsed:l.min,assumptions:n}}function rt({linearFeet:a,beadDiameterInches:e=.25,tubeVolumeOz:o=10.1}){const t=[],n=[],s=E(a,"Linear feet"),l=E(e,"Bead diameter");if(s.valid||t.push(s.error),l.valid||t.push(l.error),t.length>0)return{valid:!1,errors:t,tubes:0,assumptions:n};const c=l.value/2,d=Math.PI*c*c,r=s.value*12,u=d*r,m=o*1.81,f=k(u/m);return n.push(`Bead diameter: ${l.value}"`),n.push(`Tube size: ${o} oz (~${I(m,1)} cu in)`),n.push(`Total volume needed: ${I(u,1)} cu in`),{valid:!0,errors:[],tubes:f,totalVolumeCuIn:I(u,1),assumptions:n}}function it(a){const e=[],o=[],t=[],n=[],{roomLengthFt:s,roomWidthFt:l,doorWidthIn:c=32,doorWall:d="primary",walkwayMinIn:r=30,includeTub:u=!0,tubLengthIn:m=60,tubWidthIn:f=30,tubFrontClearIn:g=30,includeShower:p=!1,showerWidthIn:v=36,showerDepthIn:y=36,showerFrontClearIn:x=30,includeToilet:S=!0,toiletSideClearIn:$=15,toiletDepthIn:j=28,toiletFrontClearIn:L=24,includeVanity:C=!0,vanityWidthIn:A=48,vanityDepthIn:q=22,vanityFrontClearIn:M=30}=a,F=E(s,"Room length"),_=E(l,"Room width"),U=E(c,"Door width"),P=E(r,"Walkway minimum");if([F,_,U,P].forEach(T=>{T.valid||e.push(T.error)}),e.length>0)return{valid:!1,errors:e,availableWallIn:0,requiredWallIn:0,fitsLinear:"No",walkwayWidthIn:0,walkwayPass:"No",maxDepthClearIn:0,assumptions:n,warnings:o,notes:t};if(!u&&!p&&!S&&!C)return{valid:!1,errors:["Select at least one fixture to place"],availableWallIn:0,requiredWallIn:0,fitsLinear:"No",walkwayWidthIn:0,walkwayPass:"No",maxDepthClearIn:0,assumptions:n,warnings:o,notes:t};const V=[];if(u&&(V.push({type:"tub",width:m,depth:f+g}),f<30&&o.push('Tub width under 30" may feel tight.'),t.push(`Tub front clearance: ${g}"`)),p&&(V.push({type:"shower",width:v,depth:y+x}),(v<30||y<30)&&o.push('Shower minimum is 30" x 30" per IPC; aim for 36" x 36".'),t.push(`Shower front clearance: ${x}"`)),S){const T=Math.max(30,$*2);V.push({type:"toilet",width:T,depth:j+L}),$<15&&o.push('Toilet side clearance below 15" violates IPC/IRC.'),L<21&&o.push('Toilet front clearance below 21" may violate code; 24"+ recommended.'),t.push(`Toilet zone width uses ${$}" side clearances (30" min). Front clearance: ${L}"`)}C&&(V.push({type:"vanity",width:A,depth:q+M}),t.push(`Vanity front clearance: ${M}"`));const ze=V.reduce((T,Y)=>T+Y.width,0),Ue=V.reduce((T,Y)=>Math.max(T,Y.depth),0),ca=F.value>=_.value?"length":"width",Ve=F.value*12,Ge=_.value*12,da=T=>d==="none"?0:d==="primary"?T===ca?U.value:0:d==="length"?T==="length"?U.value:0:d==="width"?T==="width"?U.value:0:U.value,Je=T=>{const Y=T==="length"?Ve:Ge,Be=T==="length"?Ge:Ve,pe=da(T),Ke=Math.max(0,Y-pe),Qe=Be-Ue,ua=Qe>=P.value,ma=ze<=Ke;return{fixtureWall:T,availableWallIn:Ke,requiredWallIn:ze,maxDepthClearIn:Ue,walkwayWidthIn:Qe,walkwayPassBool:ua,fitsLinearBool:ma,doorDeductIn:pe}},re=Je("length"),ie=Je("width"),Ye=T=>{const Y=(T.fitsLinearBool?2:0)+(T.walkwayPassBool?1:0),Be=T.walkwayWidthIn-P.value,pe=T.availableWallIn-T.requiredWallIn;return[Y,Be,pe]},le=Ye(re),ce=Ye(ie),N=le[0]!==ce[0]?le[0]>ce[0]?re:ie:le[1]!==ce[1]?le[1]>ce[1]?re:ie:le[2]>=ce[2]?re:ie,ke=N.fixtureWall==="length"?ie:re;return n.push("Layout wall tested: length + width (best chosen)"),n.push(`Selected fixture wall: ${N.fixtureWall}`),n.push(`Door wall setting: ${d}`),n.push(`Door width deducted on selected wall: ${I(N.doorDeductIn,1)}"`),n.push(`Walkway minimum target: ${P.value}"`),t.push(`Alternate (${ke.fixtureWall}) \u2014 Available wall: ${I(ke.availableWallIn,1)}", Clear path: ${I(ke.walkwayWidthIn,1)}"`),N.fitsLinearBool||o.push("Fixtures exceed available wall length\u2014consider switching walls or reducing widths."),N.walkwayPassBool||o.push(`Clear path under ${P.value}" \u2014 increase room width or reduce front clearances.`),{valid:!0,errors:[],layoutWall:N.fixtureWall,availableWallIn:I(N.availableWallIn,1),requiredWallIn:I(N.requiredWallIn,1),fitsLinear:N.fitsLinearBool?"Yes":"No",walkwayWidthIn:I(N.walkwayWidthIn,1),walkwayPass:N.walkwayPassBool?"Yes":"No",maxDepthClearIn:I(N.maxDepthClearIn,1),assumptions:n,warnings:o,notes:t}}typeof window!="undefined"&&(window.TillersteadFormulas={calculateMovementJoints:Ze,calculateDeflection:Xe,calculateHeatedFloorLoad:et,evaluateMoistureReadings:tt,calculateThinsetMix:at,estimateSealer:ot,calculateDeckMud:nt,estimatePrimer:st,estimateSealantTubes:rt,calculateBathLayout:it,MOVEMENT_JOINT_SPACING:Z,SEALER_COVERAGE:Le,PRIMER_COVERAGE:ye});const X={floor:{label:"Floor",calcMode:"dimensions",defaultHeight:null,icon:"\u25A2"},"full-walls":{label:"Full Walls",calcMode:"perimeter",defaultHeight:8,icon:"\u25A4"},"shower-walls":{label:"Shower Walls",calcMode:"manual",defaultArea:72,icon:"\u25A5"},"tub-surround":{label:"Tub Surround",calcMode:"manual",defaultArea:60,icon:"\u25A7"},backsplash:{label:"Backsplash",calcMode:"manual",defaultArea:6,icon:"\u25A8"}},D={ERROR:"error",WARNING:"warning"};let i={project:{name:"",clientName:"",address:"",county:"",phone:"",email:"",notes:""},rooms:[],defaults:{tilePreset:"",customTileWidth:0,customTileHeight:0,tileThickness:8,layout:"",wasteFactor:12,jointSize:"",extraAtticStock:!1},systems:{underlayment:"none",waterproofing:"none",edgeTrim:"none",movementJoints:!1,demoTile:!1,demoUnderlayment:!1,subfloorRepair:!1,disposal:!1},mode:"pro",trowelOverride:{selected:null,reason:""},assumptions:[],nudges:[],validationErrors:[],validationWarnings:[]},lt=0;function ct(){return"room_"+ ++lt+"_"+Date.now()}function W(a,e){const o=parseFloat(a)||0,t=parseFloat(e)||0;return o+t/12}function pa(a){const e=Math.floor(a),o=Math.round((a-e)*12);return o===12?`${e+1}' 0"`:`${e}' ${o}"`}function Ae(a,e){return a*e}function ga(a,e){return!Ee||typeof Ee[a]!="function"?null:Ee[a](e)}function k(a){return Math.ceil(a)}function b(a,e=0){return a.toLocaleString("en-US",{minimumFractionDigits:e,maximumFractionDigits:e})}function h(a){const e=document.createElement("div");return e.textContent=a,e.innerHTML}function R(a,e,o){if(a==="custom"){const t=parseFloat(e)||12,n=parseFloat(o)||12,s=Math.max(t,n);return{id:"custom",name:`${t}\xD7${n} Custom`,width:t,height:n,isCustom:!0,isLargeFormat:s>=15,isPlank:n>=24||t>=24}}return de.find(t=>t.id===a)||de[8]}function O(a){return ge.find(e=>e.id===a)||ge[0]}function G(a){return he.find(e=>e.id===a)||he[1]}function H(a){return be.find(e=>e.id===a)||be[1]}const Ee=window.TillersteadFormulas||window.TillersteadFormulasLibrary;function ue(a,e,o){if(!a||a<=0)return{tiles:0,boxes:0,areaWithWaste:0};const t=1+o/100,n=a*t;let s;if(e.isMosaic&&e.sheetCoverage)s=k(n/e.sheetCoverage);else{const l=e.width*e.height/144;s=k(n/l)}return{tiles:s,areaWithWaste:n}}function dt(a,e,o,t,n,s){let l;if(e&&e>0)l=k(a/e);else if(o&&o>0)l=k(n/o);else return{boxes:0,note:"Enter tiles per box or sq ft per box"};if(s){const c=Math.max(1,k(l*.05));l+=c}return{boxes:l,note:""}}function ee(a,e){const o=Math.min(a.width,a.height),t=Math.max(a.width,a.height),n=a.isLargeFormat||t>=15;let s={trowelId:"1/4-sq",backButter:!1,note:"",warning:""};if(a.isMosaic||o<=2?(s.trowelId="3/16-v",s.note='Small tile/mosaic: 3/16" V-notch is standard for thin mosaics.'):t<=8?(s.trowelId="1/4-sq",s.note='1/4" \xD7 1/4" square notch per CBP TDS: 90-100 sq ft/bag coverage.'):t<=13?(s.trowelId="1/4x3/8-sq",s.note='1/4" \xD7 3/8" square notch per CBP TDS: 60-67 sq ft/bag coverage.'):n?(s.trowelId="3/4-u-30",s.backButter=!0,s.note='Large-format tile: 3/4"\xD79/16" U-notch @ 30\xB0 recommended per CBP TDS-132. Back-butter required for 95% coverage.',s.warning='CBP does NOT recommend 1/2"\xD71/2" square notch for LFT\u2014spacing makes it difficult to achieve proper coverage.'):(s.trowelId="1/4x3/8-sq",s.backButter=!0,s.note='1/4" \xD7 3/8" square notch with back-buttering for this tile size.'),e==="needs-flattening"){const l=["3/16-v","1/4-sq","1/4x3/8-sq","3/4-u-30","3/4-u-45"],c=l.indexOf(s.trowelId);c>=0&&c<l.length-1&&(s.trowelId=l[c+1]),s.note+=" Substrate may need flattening\u2014larger notch helps but doesn't replace proper substrate prep."}return s}function te(a,e,o){const t=H(e);if(!t)return{min:0,max:0,note:"Select trowel size"};const n=k(a/t.coverageMax),s=k(a/t.coverageMin);let l=n,c=s;return o&&(l=k(n*1.2),c=k(s*1.3)),{min:l,max:c,coverage:`${t.coverageMin}\u2013${t.coverageMax} sq ft/bag`,note:o?"Includes ~25% extra for back-buttering":""}}function je(a){const e=Math.max(a.width,a.height);return a.isMosaic?{jointId:"1/8",note:'Mosaic tiles: 1/16"\u20131/8" joints are typical.'}:a.isLargeFormat||e>=24?{jointId:"1/8",note:'Large-format/rectified tile: 1/8" minimum joint is recommended.'}:{jointId:"1/8",note:'1/8" joint is a common starting point. Adjust based on tile variation and manufacturer guidance.'}}function ae(a,e,o,t,n,s,l){if(!a||!e||!o||!n||!t)return{quantity:0,unit:"lbs",note:"Enter all values to calculate"};const c=t/25.4,d=parseFloat(e),r=parseFloat(o),u=parseFloat(c),m=parseFloat(n),p=s==="epoxy"?2:1.86,v=(d+r)/(d*r)*u*m*p;let y=v*a;const x=l?" Mosaic tiles require more grout due to additional joints.":"";y*=1.1;const $=(d+r)/(d*r)*u*m*a*144/1728*1.1;return{quantity:k(y),unit:"lbs",volume:$.toFixed(3),lbsPerSqFt:v.toFixed(3),note:`Coverage: ~${v.toFixed(2)} lbs/sq ft.${x}`}}function Me(a,e,o){if(!a||!e)return{bags:0,volume:0,note:"Enter area and depth"};const t=a*(e/12),n=k(t/Ce);let s=n;if(o&&o>e){const l=a*(o/12);s=k(l/Ce)}return{bags:n,bagsMax:s,volume:t.toFixed(2),note:o?`Range: ${n}\u2013${s} bags depending on actual depth variation`:""}}function me(){const a=[],e=[],o=[];return(!i.project.name||!i.project.name.trim())&&(a.push({field:"project-name",selector:"#project-name",message:"Project name is required",section:"Project Information",type:D.ERROR}),o.push({label:"Project Name",selector:"#project-name",message:"Enter a project name"})),i.rooms.length===0&&(a.push({field:"add-room-btn",selector:"#add-room-btn",message:"Add at least one room",section:"Rooms",type:D.ERROR}),o.push({label:"Rooms",selector:"#add-room-btn",message:'Click "Add Room" to add your first room'})),i.rooms.forEach((t,n)=>{var c,d;const s=`[data-room-id="${t.id}"]`;if((!t.name||!t.name.trim())&&(a.push({field:`room-${t.id}-name`,selector:`${s} .room-name-input`,message:`Room ${n+1}: Name is required`,section:"Rooms",type:D.ERROR}),o.push({label:`Room ${n+1} Name`,selector:`${s} .room-name-input`,message:"Enter a room name"})),Object.values(t.surfaces||{}).some(r=>r.selected)||a.push({field:`room-${t.id}-surfaces`,selector:`${s} .surfaces-fieldset`,message:`${t.name||"Room "+(n+1)}: Select at least one surface to tile`,section:"Rooms",type:D.ERROR}),(d=(c=t.surfaces)==null?void 0:c.floor)!=null&&d.selected){const r=W(t.lengthFt,t.lengthIn),u=W(t.widthFt,t.widthIn);(r<=0||u<=0)&&(a.push({field:`room-${t.id}-dimensions`,selector:`${s} .room-length-ft`,message:`${t.name||"Room "+(n+1)}: Enter room dimensions for floor area`,section:"Rooms",type:D.ERROR}),o.push({label:`${t.name||"Room "+(n+1)} Dimensions`,selector:`${s} .room-length-ft`,message:"Enter length and width"}))}Object.entries(t.surfaces||{}).forEach(([r,u])=>{var m;u.selected&&u.areaMode==="manual"&&(!u.manualArea||u.manualArea<=0)&&a.push({field:`room-${t.id}-surface-${r}`,selector:`${s} [data-surface-id="${r}"] .surface-manual-area`,message:`${t.name||"Room "+(n+1)}: ${((m=X[r])==null?void 0:m.label)||r} manual area must be greater than 0`,section:"Rooms",type:D.ERROR})}),t.locked&&Object.values(t.surfaces||{}).reduce((u,m)=>u+(m.selected?m.area:0),0)===0&&e.push({field:`room-${t.id}-locked`,selector:s,message:`${t.name||"Room "+(n+1)}: Measurements locked but no area calculated`,section:"Rooms",type:D.WARNING})}),i.defaults.tilePreset||e.push({field:"default-tile-size",selector:"#default-tile-size",message:"Consider selecting a tile size for more accurate calculations",section:"Tile & Layout",type:D.WARNING}),i.defaults.layout||e.push({field:"default-layout",selector:"#default-layout",message:"Consider selecting a layout pattern for waste factor guidance",section:"Tile & Layout",type:D.WARNING}),i.validationErrors=a,i.validationWarnings=e,{errors:a,warnings:e,missingFields:o}}function Ie(a){const{errors:e,warnings:o,missingFields:t}=a,n=document.getElementById("needs-attention"),s=document.getElementById("needs-attention-list"),l=document.getElementById("needs-attention-badge");if(!n||!s)return;const c=e.length+o.length;if(l&&(l.textContent=c,l.hidden=c===0),document.querySelectorAll(".is-invalid, .is-warning").forEach(r=>{r.classList.remove("is-invalid","is-warning")}),c===0){n.hidden=!0,s.innerHTML="";return}e.forEach(r=>{if(r.selector){const u=document.querySelector(r.selector);u&&u.classList.add("is-invalid")}}),o.forEach(r=>{if(r.selector){const u=document.querySelector(r.selector);u&&u.classList.add("is-warning")}});let d="";e.length>0&&(d+=`<li class="needs-attention__header needs-attention__header--error" role="status" aria-live="assertive">
        <strong>\u26A0\uFE0F ${e.length} Required</strong>
      </li>`,e.forEach(r=>{d+=`
          <li class="needs-attention__item needs-attention__item--error">
            <span class="needs-attention__icon">\u274C</span>
            <span class="needs-attention__message">${h(r.message)}</span>
            ${r.selector?`<button type="button" class="needs-attention__jump btn btn--ghost btn--xs" 
              data-selector="${h(r.selector)}" aria-label="Go to ${h(r.message)}">
              Go \u2192
            </button>`:""}
          </li>
        `})),o.length>0&&(d+=`<li class="needs-attention__header needs-attention__header--warning" role="status" aria-live="polite">
        <strong>\u{1F4A1} ${o.length} Suggestions</strong>
      </li>`,o.forEach(r=>{d+=`
          <li class="needs-attention__item needs-attention__item--warning">
            <span class="needs-attention__icon">\u26A1</span>
            <span class="needs-attention__message">${h(r.message)}</span>
            ${r.selector?`<button type="button" class="needs-attention__jump btn btn--ghost btn--xs" 
              data-selector="${h(r.selector)}" aria-label="Go to ${h(r.message)}">
              Go \u2192
            </button>`:""}
          </li>
        `})),s.innerHTML=d,n.hidden=!1,s.addEventListener("click",ut)}function ut(a){const e=a.target.closest(".needs-attention__jump");if(!e)return;const o=e.dataset.selector;if(!o)return;const t=document.querySelector(o);if(!t)return;t.scrollIntoView({behavior:"smooth",block:"center"});const n=t.matches("input, select, textarea")?t:t.querySelector("input, select, textarea");n&&n.focus&&setTimeout(()=>n.focus(),300),t.classList.add("highlight-field"),setTimeout(()=>t.classList.remove("highlight-field"),2e3)}function mt(){const a=me();return Ie(a),a}function ft(a,e){const o=a.querySelector(".room-audit");if(!o||!e.auditTrail||e.auditTrail.length===0)return;const t=o.querySelector(".room-audit__list");t&&(t.innerHTML=e.auditTrail.map(n=>{const l=new Date(n.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});return`
        <li class="room-audit__entry">
          <span class="room-audit__time">${h(l)}</span>
          <span class="room-audit__action room-audit__action--${n.action}">${h(n.action)}</span>
          ${n.reason?`<span class="room-audit__reason">"${h(n.reason)}"</span>`:""}
          <span class="room-audit__dims">${b(n.dimensions.length,1)}\xD7${b(n.dimensions.width,1)} ft</span>
        </li>
      `}).join(""))}function pt(){const a=[],e=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),o=O(i.defaults.layout),t=Math.max(e.width,e.height);return o.id==="subway-50"&&t>=15&&a.push({type:"warning",message:'Consider 1/3 offset instead of 50% offset for tiles 15"+ to reduce lippage risk. Many installers prefer 1/3 offset for plank tiles.'}),o.id==="herringbone"&&e.width===e.height&&a.push({type:"info",message:"Herringbone pattern is typically used with rectangular tiles (planks). Square tiles would create a checkerboard effect."}),a}function K(){const a=document.getElementById("layout-nudge"),e=document.getElementById("layout-nudge-text"),o=pt();o.length>0?(e.textContent=o[0].message,a.hidden=!1,a.className=`nudge nudge--${o[0].type}`):a.hidden=!0}function xe(){const a=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),e=document.getElementById("joint-recommendation"),o=document.getElementById("joint-recommendation-text");if(a&&!a.isCustom){const t=je(a);o.textContent=t.note,e.hidden=!1}else e.hidden=!0}function gt(){document.querySelectorAll("#default-tile-size, #calc-tile-size, #mortar-tile-size").forEach(n=>{de.forEach(s=>{const l=document.createElement("option");l.value=s.id,l.textContent=s.name,n.appendChild(l)})}),document.querySelectorAll("#default-layout, #calc-layout").forEach(n=>{ge.forEach(s=>{const l=document.createElement("option");l.value=s.id,l.textContent=`${s.name} (${s.wasteRange} waste)`,n.appendChild(l)})}),document.querySelectorAll("#default-joint, #grout-joint-width").forEach(n=>{he.forEach(s=>{const l=document.createElement("option");l.value=s.id,l.textContent=s.name,n.appendChild(l)})}),document.querySelectorAll("#mortar-trowel").forEach(n=>{const s=document.createElement("option");s.value="auto",s.textContent="Auto-recommend...",n.appendChild(s),be.forEach(l=>{const c=document.createElement("option");c.value=l.id,c.textContent=`${l.name} (${l.coverageMin}\u2013${l.coverageMax} sq ft/bag)`,n.appendChild(c)})})}function Te(a){const t=document.getElementById("room-template").content.cloneNode(!0).querySelector(".room-card"),n=(a==null?void 0:a.id)||ct();return t.dataset.roomId=n,a&&(t.querySelector(".room-name-input").value=a.name||"",t.querySelector(".room-length-ft").value=a.lengthFt||"",t.querySelector(".room-length-in").value=a.lengthIn||"",t.querySelector(".room-width-ft").value=a.widthFt||"",t.querySelector(".room-width-in").value=a.widthIn||"",t.querySelector(".room-height-ft").value=a.heightFt||"",t.querySelector(".room-height-in").value=a.heightIn||"",a.surfaces&&Object.keys(a.surfaces).forEach(s=>{if(a.surfaces[s].selected){const l=t.querySelector(`[data-surface="${s}"]`);l&&(l.checked=!0)}}),a.locked&&(t.querySelector(".room-lock-checkbox").checked=!0)),document.getElementById("rooms-list").appendChild(t),a||(i.rooms.push({id:n,name:"",lengthFt:0,lengthIn:0,widthFt:0,widthIn:0,heightFt:0,heightIn:0,surfaces:{floor:{selected:!1,area:0},"full-walls":{selected:!1,area:0},"shower-walls":{selected:!1,area:0},"tub-surround":{selected:!1,area:0},backsplash:{selected:!1,area:0}},locked:!1,lockReason:""}),w()),Fe(n),t}function ht(a){const e=document.querySelector(`[data-room-id="${a}"]`);e&&(e.remove(),i.rooms=i.rooms.filter(o=>o.id!==a),z(),w())}function J(a,e,o){const t=i.rooms.find(n=>n.id===a);if(t){if(t.locked&&["lengthFt","lengthIn","widthFt","widthIn","heightFt","heightIn"].includes(e)){const s=document.querySelector(`[data-room-id="${a}"]`).querySelector(".room-lock-reason");s.hidden=!1,s.querySelector("input").focus();return}t[e]=o,Fe(a),z(),w()}}function bt(a,e,o){const t=i.rooms.find(u=>u.id===a);if(!t)return;t.surfaces||(t.surfaces={}),t.surfaces[e]||(t.surfaces[e]={selected:!1,area:0,areaMode:"auto",manualArea:0,useGlobalDefaults:!0,overrides:{},deductions:[],grossArea:0,netArea:0}),t.surfaces[e].selected=o;const n=W(t.lengthFt,t.lengthIn),s=W(t.widthFt,t.widthIn),l=W(t.heightFt,t.heightIn)||8,c=X[e];let d=0;c.calcMode==="dimensions"?d=Ae(n,s):c.calcMode==="perimeter"?d=(n*2+s*2)*l:c.calcMode==="manual"&&(d=c.defaultArea),t.surfaces[e].grossArea=d,t.surfaces[e].area=d;const r=document.querySelector(`[data-room-id="${a}"]`);r&&Se(r,t),z(),w()}function Se(a,e){const o=a.querySelector("[data-surface-details]");if(!o)return;const t=Object.entries(e.surfaces||{}).filter(([,s])=>s.selected);if(t.length===0){o.hidden=!0,o.innerHTML="";return}o.hidden=!1;let n='<div class="surface-details__grid">';t.forEach(([s,l])=>{var m;const c=X[s],d=l.areaMode==="manual",r=(l.deductions||[]).reduce((f,g)=>f+(g.area||0),0),u=(d?l.manualArea:l.grossArea)-r;n+=`
        <div class="surface-detail-card" data-surface-id="${s}">
          <div class="surface-detail-card__header">
            <span class="surface-detail-card__icon">${c.icon}</span>
            <span class="surface-detail-card__title">${c.label}</span>
          </div>
          <div class="surface-detail-card__body">
            <!-- Area Mode Toggle -->
            <div class="form-field">
              <label class="form-label form-label--sm">Area Mode</label>
              <select class="form-select form-select--sm surface-area-mode" data-surface="${s}">
                <option value="auto" ${d?"":"selected"}>Auto from room dims</option>
                <option value="manual" ${d?"selected":""}>Manual area override</option>
              </select>
            </div>
            
            <!-- Manual Area Input (shown when manual) -->
            <div class="form-field surface-manual-area-field" ${d?"":"hidden"}>
              <label class="form-label form-label--sm">Area (sq ft)</label>
              <input type="number" class="form-input form-input--sm surface-manual-area" 
                data-surface="${s}" value="${l.manualArea||""}" 
                placeholder="Enter area" min="0" step="0.1">
            </div>
            
            <!-- Gross Area Display -->
            <div class="surface-area-display">
              <span class="surface-area-label">Gross:</span>
              <span class="surface-area-value">${b(d?l.manualArea:l.grossArea,1)} sf</span>
            </div>
            
            <!-- Deductions -->
            <div class="surface-deductions">
              <div class="surface-deductions__header">
                <span class="form-label form-label--sm">Deductions</span>
                <button type="button" class="btn btn--ghost btn--xs add-deduction-btn" data-surface="${s}">
                  + Add
                </button>
              </div>
              <div class="surface-deductions__list" data-deductions="${s}">
                ${vt(l.deductions||[],s)}
              </div>
              ${r>0?`
              <div class="surface-deductions__total">
                Total deductions: <strong>${b(r,1)} sf</strong>
              </div>
              `:""}
            </div>
            
            <!-- Net Area -->
            <div class="surface-net-area">
              <span>Net Area:</span>
              <strong class="surface-net-value">${b(Math.max(0,u),1)} sf</strong>
            </div>
            
            <!-- Use Global Defaults Toggle -->
            <label class="form-checkbox form-checkbox--sm">
              <input type="checkbox" class="surface-use-defaults" data-surface="${s}"
                ${l.useGlobalDefaults!==!1?"checked":""}>
              <span>Use global tile defaults</span>
            </label>
            
            <!-- Per-Surface Overrides (shown when not using global) -->
            <div class="surface-overrides" ${l.useGlobalDefaults!==!1?"hidden":""}>
              <div class="form-grid form-grid--2col">
                <div class="form-field">
                  <label class="form-label form-label--sm">Tile Size Override</label>
                  <select class="form-select form-select--sm surface-tile-override" data-surface="${s}">
                    <option value="">Same as global</option>
                    ${de.map(f=>{var g;return`<option value="${f.id}" ${((g=l.overrides)==null?void 0:g.tilePreset)===f.id?"selected":""}>${f.name}</option>`}).join("")}
                  </select>
                </div>
                <div class="form-field">
                  <label class="form-label form-label--sm">Waste Override</label>
                  <div class="form-inline">
                    <input type="number" class="form-input form-input--sm surface-waste-override" 
                      data-surface="${s}" value="${((m=l.overrides)==null?void 0:m.waste)||""}" 
                      placeholder="\u2014" min="5" max="40">
                    <span class="form-inline__suffix">%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `}),n+="</div>",o.innerHTML=n,oe(e)}function vt(a,e){return!a||a.length===0?'<p class="surface-deductions__empty">No deductions</p>':a.map((o,t)=>`
      <div class="deduction-row" data-index="${t}">
        <input type="text" class="form-input form-input--sm deduction-label" 
          value="${h(o.label||"")}" placeholder="Label (door, window...)">
        <div class="form-inline">
          <input type="number" class="form-input form-input--sm deduction-width" 
            value="${o.width||""}" placeholder="W" min="0" step="0.5">
          <span class="form-inline__sep">\xD7</span>
          <input type="number" class="form-input form-input--sm deduction-height" 
            value="${o.height||""}" placeholder="H" min="0" step="0.5">
          <span class="form-inline__suffix">in</span>
        </div>
        <span class="deduction-area">${o.area?b(o.area,1)+" sf":"\u2014"}</span>
        <button type="button" class="btn btn--ghost btn--xs remove-deduction-btn" 
          data-surface="${e}" data-index="${t}" aria-label="Remove deduction">\xD7</button>
      </div>
    `).join("")}function oe(a){let e=0;return Object.entries(a.surfaces||{}).forEach(([o,t])=>{if(!t.selected)return;const s=t.areaMode==="manual"?t.manualArea||0:t.grossArea||0,l=(t.deductions||[]).reduce((d,r)=>d+(r.area||0),0),c=Math.max(0,s-l);t.netArea=c,t.area=c,e+=c}),e}function Fe(a){var c,d;const e=i.rooms.find(r=>r.id===a);if(!e)return;const o=document.querySelector(`[data-room-id="${a}"]`);if(!o)return;const t=W(e.lengthFt,e.lengthIn),n=W(e.widthFt,e.widthIn),s=Ae(t,n),l=o.querySelector(".room-area-value");l.textContent=`${b(s,1)} sq ft`,(d=(c=e.surfaces)==null?void 0:c.floor)!=null&&d.selected&&(e.surfaces.floor.area=s)}function z(){const a=document.getElementById("area-summary-grid"),e=document.getElementById("total-area");if(i.rooms.length===0){a.innerHTML='<p class="area-summary__empty">Add rooms and select surfaces to see area calculations.</p>',e.textContent="0";return}let o="",t=0;i.rooms.forEach(n=>{n.surfaces&&Object.keys(n.surfaces).forEach(s=>{const l=n.surfaces[s];if(l.selected&&l.area>0){t+=l.area;const c=s.replace("-"," ").replace(/\b\w/g,d=>d.toUpperCase());o+=`
            <div class="area-summary__row">
              <span class="area-summary__room">${h(n.name||"Unnamed Room")}</span>
              <span class="area-summary__surface">${c}</span>
              <span class="area-summary__area">${b(l.area,1)} sq ft</span>
            </div>
          `}})}),a.innerHTML=o||'<p class="area-summary__empty">Select surfaces in rooms to see area calculations.</p>',e.textContent=b(t,1),yt(t)}function yt(a){if(a<=0)return;["calc-area","mortar-area","grout-area","level-area","labor-area","wp-area","wp-floor-area","wp-wall-area"].forEach(o=>{const t=document.getElementById(o);if(t){const n=parseFloat(t.value)||0,s=Math.round(a*10)/10;(n===0||t.dataset.synced==="true")&&(t.value=s,t.dataset.synced="true",t.dispatchEvent(new Event("change",{bubbles:!0})))}})}function wt(a={}){const{includeScope:e=!0,includeMeasurements:o=!0,includeTile:t=!0,includeMortar:n=!0,includeAssumptions:s=!0,includeDisclaimers:l=!0}=a;let c="";const d=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});if(c+=`TILE PROJECT SPECIFICATION
`,c+=`${"=".repeat(50)}

`,i.project.name&&(c+=`Project: ${i.project.name}
`),i.project.clientName&&(c+=`Client: ${i.project.clientName}
`),i.project.address&&(c+=`Address: ${i.project.address}
`),i.project.county&&(c+=`Location: ${i.project.county}
`),c+=`Date: ${d}
`,c+=`Prepared by: Tillerstead LLC

`,e&&(c+=`SCOPE OF WORK
`,c+=`${"-".repeat(30)}
`,i.rooms.forEach(r=>{r.name&&(c+=`
${r.name}:
`,Object.keys(r.surfaces||{}).forEach(u=>{const m=r.surfaces[u];if(m.selected){const f=u.replace("-"," ").replace(/\b\w/g,g=>g.toUpperCase());c+=`  \u2022 ${f}: ${b(m.area,1)} sq ft
`}}))}),c+=`
`),o){c+=`MEASUREMENTS
`,c+=`${"-".repeat(30)}
`;let r=0;i.rooms.forEach(u=>{u.surfaces&&Object.values(u.surfaces).forEach(m=>{m.selected&&(r+=m.area)})}),c+=`Total tile area: ${b(r,1)} sq ft

`}if(t){c+=`TILE & LAYOUT
`,c+=`${"-".repeat(30)}
`;const r=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),u=O(i.defaults.layout);c+=`Tile size: ${r.name}
`,c+=`Layout: ${u.name}
`,c+=`Waste factor: ${i.defaults.wasteFactor}%
`;const m=G(i.defaults.jointSize);c+=`Grout joint: ${m.name}
`,i.defaults.extraAtticStock&&(c+=`Attic stock: Included (+5% or 1 box)
`),c+=`
`}if(e){c+=`SYSTEM SELECTIONS
`,c+=`${"-".repeat(30)}
`;const r=i.systems;r.underlayment!=="none"&&(c+=`Underlayment: ${{"cement-board":"Cement Board (CBU)",uncoupling:"Uncoupling Membrane","mud-bed":"Mud Bed","self-leveler":"Self-Leveling Compound"}[r.underlayment]||r.underlayment}
`),r.waterproofing!=="none"&&(c+=`Waterproofing: ${{liquid:"Liquid-Applied Membrane",sheet:"Sheet Membrane"}[r.waterproofing]||r.waterproofing}
`),r.edgeTrim!=="none"&&(c+=`Edge trim: ${r.edgeTrim}
`),r.movementJoints&&(c+=`Movement joints: Required (perimeter & field as needed)
`);const u=[];r.demoTile&&u.push("Remove existing tile"),r.demoUnderlayment&&u.push("Remove underlayment"),r.subfloorRepair&&u.push("Subfloor repair (as needed)"),r.disposal&&u.push("Debris disposal"),u.length>0&&(c+=`
Demo scope:
`,u.forEach(m=>{c+=`  \u2022 ${m}
`})),c+=`
`}return i.project.notes&&(c+=`NOTES
`,c+=`${"-".repeat(30)}
`,c+=`${i.project.notes}

`),s&&i.assumptions.length>0&&(c+=`ASSUMPTIONS
`,c+=`${"-".repeat(30)}
`,i.assumptions.forEach(r=>{c+=`\u2022 ${r}
`}),c+=`
`),l&&(c+=`IMPORTANT NOTES
`,c+=`${"-".repeat(30)}
`,c+=`\u2022 Material quantities are estimates. Verify with supplier and manufacturer specifications.
`,c+=`\u2022 Trowel notch recommendations are starting points. Confirm coverage in the field by lifting tiles during installation.
`,c+=`\u2022 Final grout joint size depends on tile variation and warpage. Verify with manufacturer guidance.
`,c+=`\u2022 Prices, if any, are estimates and subject to change upon final measurement.
`,c+=`\u2022 This specification does not constitute a contract or warranty.

`),c+=`${"=".repeat(50)}
`,c+=`Generated by Tillerstead Tools \u2022 tillerstead.com
`,c}function ha(a){const e=wt(a);return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tile Project Specification - ${h(i.project.name||"Untitled")}</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      color: #333;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: inherit;
    }
  </style>
</head>
<body>
  <pre>${h(e)}</pre>
</body>
</html>`}function Re(){var s,l;const a={includeScope:document.getElementById("output-scope").checked,includeMeasurements:document.getElementById("output-measurements").checked,includeTile:document.getElementById("output-tile").checked,includeMortar:document.getElementById("output-mortar").checked,includeAssumptions:document.getElementById("output-assumptions").checked,includeDisclaimers:document.getElementById("output-disclaimers").checked,includeAudit:((s=document.getElementById("output-audit"))==null?void 0:s.checked)||!1},e=me();if(e.errors.length>0){Ie(e);const c=document.getElementById("needs-attention");c&&c.scrollIntoView({behavior:"smooth",block:"center"});const d=((l=e.errors[0])==null?void 0:l.message)||"Missing required fields";B(`Cannot generate: ${d}`,"error");return}const o=Et(a),t=document.getElementById("output-preview"),n=document.getElementById("output-content");n.innerHTML=o,t.hidden=!1,t.scrollIntoView({behavior:"smooth",block:"start"})}function Et(a){var u,m;const e=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});let o=0,t=0,n=0;i.rooms.forEach(f=>{f.surfaces&&Object.values(f.surfaces).forEach(g=>{g.selected&&(o+=g.grossArea||g.area||0,t+=(g.deductions||[]).reduce((p,v)=>p+(v.area||0),0),n+=g.netArea||g.area||0)})});const s=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),l=O(i.defaults.layout),c=G(i.defaults.jointSize),d=i.defaults.wasteFactor||10;let r='<div class="output-packet">';return r+=`
      <div class="output-header">
        <h2 class="output-title">${h(i.project.name||"Tile Project")}</h2>
        ${i.project.client?`<p class="output-client">Prepared for: ${h(i.project.client)}</p>`:""}
        <p class="output-date">Generated: ${e}</p>
      </div>
    `,a.includeScope&&(r+=`
        <div class="output-section">
          <h3 class="output-section-title">\u{1F4CB} Scope Summary</h3>
          <div class="output-narrative">
            ${It()}
          </div>
        </div>
      `),a.includeMeasurements&&(r+=`
        <div class="output-section">
          <h3 class="output-section-title">\u{1F4D0} Measurements</h3>
          <table class="output-table measurements-table">
            <thead>
              <tr>
                <th>Room</th>
                <th>Surface</th>
                <th class="num">Gross (sf)</th>
                <th class="num">Deductions</th>
                <th class="num">Net Area</th>
              </tr>
            </thead>
            <tbody>
              ${xt()}
            </tbody>
            <tfoot>
              <tr class="totals-row">
                <td colspan="2"><strong>Project Total</strong></td>
                <td class="num"><strong>${b(o,1)}</strong></td>
                <td class="num"><strong>\u2212${b(t,1)}</strong></td>
                <td class="num"><strong>${b(n,1)} sf</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
      `),(a.includeTile||a.includeMortar)&&(r+=`
        <div class="output-section">
          <h3 class="output-section-title">\u{1F9F1} Material Takeoff</h3>
          <table class="output-table materials-table">
            <thead>
              <tr>
                <th>Material</th>
                <th class="num">Quantity</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              ${Pe()}
            </tbody>
          </table>
        </div>
      `),(u=i.trowelOverride)!=null&&u.selected&&((m=i.trowelOverride)!=null&&m.reason)&&(r+=`
        <div class="output-section output-note">
          <p><strong>\u26A0\uFE0F Trowel Override:</strong> Selected ${h(H(i.trowelOverride.selected).name)} instead of recommendation. 
          Reason: "${h(i.trowelOverride.reason)}"</p>
        </div>
      `),a.includeAudit&&Tt()&&(r+=`
        <div class="output-section">
          <h3 class="output-section-title">\u{1F4DD} Measurement Audit Trail</h3>
          <div class="output-audit">
            ${St()}
          </div>
        </div>
      `),a.includeAssumptions&&(r+=`
        <div class="output-section">
          <h3 class="output-section-title">\u{1F4CC} Assumptions & Exclusions</h3>
          <div class="output-two-col">
            <div class="output-col">
              <h4>Assumptions</h4>
              <ul>
                <li>Material quantities are estimates; order extra for cuts/waste</li>
                <li>Trowel size is a starting point; verify coverage per manufacturer</li>
                <li>Waste factor: ${d}% (adjust for complex layouts)</li>
                <li>Substrate is assumed level within tolerance</li>
                ${s.isLargeFormat?"<li>Large format tile requires minimum 95% coverage</li>":""}
                ${l.id.includes("herringbone")?"<li>Herringbone pattern requires additional cuts at edges</li>":""}
              </ul>
            </div>
            <div class="output-col">
              <h4>Exclusions</h4>
              <ul>
                <li>Labor and installation costs</li>
                <li>Permits and inspections</li>
                <li>Subfloor repairs or leveling</li>
                <li>Plumbing/electrical modifications</li>
                <li>Furniture removal/replacement</li>
                <li>Debris disposal (unless noted)</li>
              </ul>
            </div>
          </div>
        </div>
      `),a.includeDisclaimers&&(r+=`
        <div class="output-section output-disclaimers">
          <h3 class="output-section-title">\u2696\uFE0F Disclaimers</h3>
          <p class="disclaimer-text">
            <strong>For Estimation Purposes Only.</strong> This document provides preliminary estimates based on the information entered. 
            Actual material requirements may vary based on site conditions, tile selection, installation method, and other factors. 
            Tillerstead recommends professional measurement and consultation before purchasing materials.
          </p>
          <p class="disclaimer-text">
            Trowel recommendations are starting points based on tile size and substrate. Always verify with manufacturer specifications 
            and confirm minimum 80% coverage (95% for wet areas/large format) through field testing.
          </p>
          <p class="disclaimer-legal">
            Tillerstead LLC is a NJ Registered Home Improvement Contractor (#13VH13397100). This estimate does not constitute a contract or proposal.
          </p>
        </div>
      `),r+=`
      <div class="output-footer">
        <div class="output-footer__brand">
          <img src="/assets/img/logo/logo-wolf-crest-compact.webp" 
               alt="Tillerstead" 
               class="output-footer__logo"
               width="32" height="32">
          <div class="output-footer__text">
            <span class="output-footer__name">Powered by TillerPro\u2122</span>
            <span class="output-footer__tagline">Professional Tile Calculators by Tillerstead LLC</span>
          </div>
        </div>
        <div class="output-footer__info">
          <span>NJ HIC #13VH10808800</span>
          <span>\u2022</span>
          <a href="https://tillerstead.com/tools/" target="_blank">tillerstead.com/tools</a>
        </div>
      </div>
    `,r+="</div>",r}function It(){const a=i.rooms.filter(l=>l.name).length,e=[];let o=0;i.rooms.forEach(l=>{Object.entries(l.surfaces||{}).forEach(([c,d])=>{if(d.selected){const r=c.replace(/-/g," ");e.includes(r)||e.push(r),o+=d.netArea||d.area||0}})});const t=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),n=O(i.defaults.layout);let s=`<p>This project includes tile installation for <strong>${a} room${a!==1?"s":""}</strong> `;return s+=`covering approximately <strong>${b(o,0)} square feet</strong> of ${e.join(", ")} surfaces.</p>`,s+=`<p>Tile specification: <strong>${h(t.name)}</strong>`,n&&(s+=` in <strong>${h(n.name)}</strong> pattern`),s+=".</p>",i.systems.waterproofing!=="none"&&(s+=`<p>Waterproofing: ${i.systems.waterproofing==="liquid"?"Liquid membrane":"Sheet membrane"} system included.</p>`),s}function xt(){let a="";return i.rooms.filter(e=>e.name).forEach(e=>{const o=Object.entries(e.surfaces||{}).filter(([,t])=>t.selected);o.length!==0&&o.forEach(([t,n],s)=>{const l=X[t]||{label:t},c=n.grossArea||n.area||0,d=(n.deductions||[]).reduce((u,m)=>u+(m.area||0),0),r=n.netArea||c-d;a+=`
          <tr>
            ${s===0?`<td rowspan="${o.length}" class="room-name">${h(e.name)}${e.locked?" \u{1F512}":""}</td>`:""}
            <td>${h(l.label)}</td>
            <td class="num">${b(c,1)}</td>
            <td class="num">${d>0?"\u2212"+b(d,1):"\u2014"}</td>
            <td class="num">${b(r,1)}</td>
          </tr>
        `})}),a}function Tt(){return i.rooms.some(a=>a.auditTrail&&a.auditTrail.length>0)}function St(){let a='<ul class="audit-list">';return i.rooms.filter(e=>e.auditTrail&&e.auditTrail.length>0).forEach(e=>{a+=`<li class="audit-room"><strong>${h(e.name||"Unnamed Room")}</strong><ul>`,e.auditTrail.forEach(o=>{const n=new Date(o.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});a+=`<li>${h(n)}: ${h(o.action)}`,o.reason&&(a+=` \u2014 "${h(o.reason)}"`),a+=` (${b(o.dimensions.length,1)}\xD7${b(o.dimensions.width,1)} ft)</li>`}),a+="</ul></li>"}),a+="</ul>",a}async function $t(){const e=document.getElementById("output-content").textContent;try{await navigator.clipboard.writeText(e),B("Copied to clipboard!")}catch(o){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),B("Copied to clipboard!")}}function kt(){const a={includeScope:document.getElementById("output-scope").checked,includeMeasurements:document.getElementById("output-measurements").checked,includeTile:document.getElementById("output-tile").checked,includeMortar:document.getElementById("output-mortar").checked,includeAssumptions:document.getElementById("output-assumptions").checked,includeDisclaimers:document.getElementById("output-disclaimers").checked},e=qe(a),o=new Blob([e],{type:"application/msword"}),t=URL.createObjectURL(o),n=document.createElement("a"),s=`${(i.project.name||"tile-project").replace(/[^a-z0-9]/gi,"-")}-specification.doc`;n.href=t,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),B("Word document downloaded! Open in Microsoft Word or Google Docs.")}function qe(a){const e=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),o=i.project.name||"Tile Project Specification";let t=0,n=0,s=0;i.rooms.forEach(m=>{m.surfaces&&Object.values(m.surfaces).forEach(f=>{f.selected&&(t+=f.grossArea||f.area||0,n+=(f.deductions||[]).reduce((g,p)=>g+(p.area||0),0),s+=f.netArea||f.area||0)})});const l=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),c=O(i.defaults.layout),d=G(i.defaults.jointSize),r=i.defaults.wasteFactor||10,u=s*(1+r/100);return`<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
      xmlns:w="urn:schemas-microsoft-com:office:word"
      xmlns="http://www.w3.org/TR/REC-html40">
<head>
  <meta charset="UTF-8">
  <meta name="Generator" content="TillerPro\u2122 by Tillerstead LLC">
  <!--[if gte mso 9]>
  <xml>
    <w:WordDocument>
      <w:View>Print</w:View>
      <w:Zoom>100</w:Zoom>
      <w:DoNotOptimizeForBrowser/>
    </w:WordDocument>
  </xml>
  <![endif]-->
  <title>${h(o)}</title>
  <style>
    /* Page Setup */
    @page {
      size: 8.5in 11in;
      margin: 0.75in 0.75in 1in 0.75in;
      mso-header-margin: 0.5in;
      mso-footer-margin: 0.5in;
    }
    @page Section1 {
      mso-header: h1;
      mso-footer: f1;
    }
    div.Section1 { page: Section1; }

    /* Base Typography */
    body {
      font-family: 'Calibri', 'Segoe UI', Arial, sans-serif;
      font-size: 11pt;
      line-height: 1.5;
      color: #1a1a1a;
      background: #fff;
    }

    /* Header Styling */
    .doc-header {
      border-bottom: 3px solid #0d4b3b;
      padding-bottom: 16pt;
      margin-bottom: 20pt;
    }
    .doc-header table {
      width: 100%;
      border-collapse: collapse;
    }
    .doc-header td {
      vertical-align: top;
      padding: 0;
    }
    .brand-cell {
      width: 60%;
    }
    .brand-name {
      font-size: 24pt;
      font-weight: bold;
      color: #0d4b3b;
      margin: 0;
      letter-spacing: -0.5pt;
    }
    .brand-tagline {
      font-size: 9pt;
      color: #666;
      margin: 4pt 0 0 0;
    }
    .project-info-cell {
      width: 40%;
      text-align: right;
    }
    .project-title {
      font-size: 14pt;
      font-weight: bold;
      color: #1a1a1a;
      margin: 0;
    }
    .project-meta {
      font-size: 9pt;
      color: #666;
      margin: 4pt 0 0 0;
    }

    /* Section Headers */
    .section-title {
      font-size: 13pt;
      font-weight: bold;
      color: #0d4b3b;
      border-bottom: 1.5pt solid #d4a84b;
      padding-bottom: 4pt;
      margin: 20pt 0 12pt 0;
    }

    /* Tables */
    table.data-table {
      width: 100%;
      border-collapse: collapse;
      margin: 12pt 0 16pt 0;
      font-size: 10pt;
    }
    table.data-table th {
      background: #0d4b3b;
      color: #fff;
      font-weight: 600;
      padding: 8pt 10pt;
      text-align: left;
      border: 1pt solid #0d4b3b;
    }
    table.data-table th.num {
      text-align: right;
    }
    table.data-table td {
      padding: 6pt 10pt;
      border: 0.5pt solid #ccc;
      vertical-align: top;
    }
    table.data-table td.num {
      text-align: right;
      font-family: 'Consolas', 'Courier New', monospace;
    }
    table.data-table tr.totals-row td {
      background: #f5f5f5;
      font-weight: bold;
      border-top: 2pt solid #0d4b3b;
    }
    table.data-table tr.alt-row td {
      background: #fafafa;
    }
    .room-name {
      font-weight: 600;
      color: #0d4b3b;
    }
    .material-detail {
      font-size: 9pt;
      color: #666;
      display: block;
    }
    .material-note {
      font-size: 9pt;
      color: #888;
      font-style: italic;
    }

    /* Summary Box */
    .summary-box {
      background: #f8f9fa;
      border: 1pt solid #d4a84b;
      border-left: 4pt solid #d4a84b;
      padding: 12pt 16pt;
      margin: 16pt 0;
    }
    .summary-box p {
      margin: 4pt 0;
    }
    .summary-highlight {
      font-size: 18pt;
      font-weight: bold;
      color: #0d4b3b;
    }

    /* Assumptions/Exclusions Columns */
    .two-col-table {
      width: 100%;
      border-collapse: collapse;
    }
    .two-col-table td {
      width: 50%;
      vertical-align: top;
      padding: 0 12pt 0 0;
    }
    .two-col-table td:last-child {
      padding: 0 0 0 12pt;
    }
    .two-col-table h4 {
      font-size: 11pt;
      font-weight: 600;
      color: #0d4b3b;
      margin: 0 0 8pt 0;
    }
    .two-col-table ul {
      margin: 0;
      padding-left: 18pt;
    }
    .two-col-table li {
      margin: 4pt 0;
      font-size: 10pt;
    }

    /* Disclaimers */
    .disclaimers {
      background: #fffef0;
      border: 0.5pt solid #d4a84b;
      padding: 12pt 16pt;
      margin: 20pt 0;
      font-size: 9pt;
    }
    .disclaimers p {
      margin: 6pt 0;
    }
    .disclaimers strong {
      color: #0d4b3b;
    }

    /* Footer */
    .doc-footer {
      border-top: 2pt solid #0d4b3b;
      padding-top: 12pt;
      margin-top: 24pt;
    }
    .doc-footer table {
      width: 100%;
      border-collapse: collapse;
    }
    .doc-footer td {
      vertical-align: middle;
      padding: 0;
    }
    .footer-brand {
      font-size: 10pt;
      color: #0d4b3b;
      font-weight: 600;
    }
    .footer-info {
      font-size: 8pt;
      color: #666;
      text-align: right;
    }

    /* Print Styles */
    @media print {
      .page-break { page-break-before: always; }
    }
  </style>
</head>
<body>
<div class="Section1">

  <!-- Document Header -->
  <div class="doc-header">
    <table>
      <tr>
        <td class="brand-cell">
          <p class="brand-name">\u{1F6E1}\uFE0F TILLERSTEAD</p>
          <p class="brand-tagline">TCNA-Compliant Tile & Stone Installation \u2022 South Jersey</p>
        </td>
        <td class="project-info-cell">
          <p class="project-title">${h(o)}</p>
          <p class="project-meta">
            ${i.project.client?`Prepared for: ${h(i.project.client)}<br>`:""}
            ${i.project.address?`${h(i.project.address)}<br>`:""}
            Generated: ${e}
          </p>
        </td>
      </tr>
    </table>
  </div>

  <!-- Project Summary Box -->
  <div class="summary-box">
    <p><strong>Project Overview:</strong> ${i.rooms.filter(m=>m.name).length} room${i.rooms.filter(m=>m.name).length!==1?"s":""} \u2022 ${h(l.name)} tile \u2022 ${h((c==null?void 0:c.name)||"Standard")} pattern</p>
    <p><span class="summary-highlight">${b(s,0)} SF</span> total tile area (${b(u,0)} SF with ${r}% waste)</p>
  </div>

${a.includeScope?Bt():""}
${a.includeMeasurements?Ct(t,n,s):""}
${a.includeTile||a.includeMortar?Lt(s,l,d,r):""}
${a.includeAssumptions?At(r,l,c):""}
${a.includeDisclaimers?jt():""}

  <!-- Document Footer -->
  <div class="doc-footer">
    <table>
      <tr>
        <td class="footer-brand">
          \u2692\uFE0F Generated by TillerPro\u2122 | Professional Tile Calculators
        </td>
        <td class="footer-info">
          Tillerstead LLC \u2022 NJ HIC #13VH10808800 \u2022 tillerstead.com/tools
        </td>
      </tr>
    </table>
  </div>

</div>
</body>
</html>`}function Bt(){const a=i.rooms.filter(l=>l.name).length,e=[];let o=0;i.rooms.forEach(l=>{Object.entries(l.surfaces||{}).forEach(([c,d])=>{if(d.selected){const r=c.replace(/-/g," ");e.includes(r)||e.push(r),o+=d.netArea||d.area||0}})});const t=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),n=O(i.defaults.layout);let s='<h2 class="section-title">\u{1F4CB} Scope of Work</h2>';return s+="<p>This specification covers tile installation for ",s+=`<strong>${a} room${a!==1?"s":""}</strong>, `,s+=`including ${e.join(", ")} surfaces, totaling approximately `,s+=`<strong>${b(o,0)} square feet</strong> of tile coverage.</p>`,s+=`<p><strong>Tile Selection:</strong> ${h(t.name)}`,t.isLargeFormat&&(s+=" (Large Format \u2014 requires 95% minimum coverage)"),s+="</p>",n&&(s+=`<p><strong>Pattern:</strong> ${h(n.name)}`,n.lippageRisk&&(s+=" \u26A0\uFE0F <em>Lippage risk \u2014 requires flatness verification</em>"),s+="</p>"),i.systems.waterproofing!=="none"&&(s+=`<p><strong>Waterproofing:</strong> ${i.systems.waterproofing==="liquid"?"Liquid membrane system (RedGard, Hydroban, or equivalent)":"Sheet membrane system (Kerdi, NobleSeal, or equivalent)"}</p>`),i.systems.heating==="electric"&&(s+="<p><strong>Floor Heating:</strong> Electric radiant heat system included</p>"),s}function Ct(a,e,o){let t='<h2 class="section-title">\u{1F4D0} Measurements Detail</h2>';t+='<table class="data-table">',t+='<thead><tr><th>Room</th><th>Surface</th><th class="num">Gross (SF)</th><th class="num">Deductions</th><th class="num">Net Area</th></tr></thead>',t+="<tbody>";let n=0;return i.rooms.filter(s=>s.name).forEach(s=>{const l=Object.entries(s.surfaces||{}).filter(([,c])=>c.selected);l.length!==0&&l.forEach(([c,d],r)=>{const u=X[c]||{label:c},m=d.grossArea||d.area||0,f=(d.deductions||[]).reduce((p,v)=>p+(v.area||0),0),g=d.netArea||m-f;t+=`<tr class="${n%2===1?"alt-row":""}">`,r===0&&(t+=`<td rowspan="${l.length}" class="room-name">${h(s.name)}${s.locked?" \u{1F512}":""}</td>`),t+=`<td>${h(u.label)}</td>`,t+=`<td class="num">${b(m,1)}</td>`,t+=`<td class="num">${f>0?"\u2212"+b(f,1):"\u2014"}</td>`,t+=`<td class="num">${b(g,1)}</td>`,t+="</tr>",n++})}),t+="</tbody>",t+='<tfoot><tr class="totals-row">',t+='<td colspan="2"><strong>PROJECT TOTAL</strong></td>',t+=`<td class="num"><strong>${b(a,1)}</strong></td>`,t+=`<td class="num"><strong>\u2212${b(e,1)}</strong></td>`,t+=`<td class="num"><strong>${b(o,1)} SF</strong></td>`,t+="</tr></tfoot>",t+="</table>",t}function Lt(a,e,o,t){const n=a*(1+t/100),s=ue(a,e,t),l=ee(e,"smooth"),c=te(a,l.trowelId,l.backButter),d=ae(a,e.width,e.height,8,parseFloat(o.size)||.125,"cement",e.isMosaic);let r='<h2 class="section-title">\u{1F9F1} Material Takeoff</h2>';if(r+='<table class="data-table">',r+='<thead><tr><th>Material</th><th class="num">Quantity</th><th>Specification</th><th>Notes</th></tr></thead>',r+="<tbody>",r+="<tr>",r+="<td><strong>Tile</strong></td>",r+=`<td class="num">${b(n,0)} SF</td>`,r+=`<td>${h(e.name)}</td>`,r+=`<td class="material-note">Includes ${t}% waste factor</td>`,r+="</tr>",r+='<tr class="alt-row">',r+="<td><strong>Thinset Mortar</strong></td>",r+=`<td class="num">${c.min}\u2013${c.max} bags</td>`,r+=`<td>50 lb bags<br><span class="material-detail">${h(H(l.trowelId).name)} trowel</span></td>`,r+=`<td class="material-note">${l.backButter?"Back-butter required":"Standard application"}</td>`,r+="</tr>",r+="<tr>",r+="<td><strong>Grout</strong></td>",r+=`<td class="num">~${d.quantity} lbs</td>`,r+=`<td>${h(o.name)} joints<br><span class="material-detail">Sanded cement grout</span></td>`,r+='<td class="material-note">Actual may vary by joint consistency</td>',r+="</tr>",i.systems.underlayment==="cement-board"){const u=Math.ceil(a/15);r+='<tr class="alt-row">',r+="<td><strong>Cement Board</strong></td>",r+=`<td class="num">${u} sheets</td>`,r+='<td>3\xD75 ft \xD7 1/2" thick</td>',r+='<td class="material-note">+ CBU screws & alkali-resistant tape</td>',r+="</tr>"}if(i.systems.waterproofing==="liquid"){const u=Math.ceil(a/50);r+="<tr>",r+="<td><strong>Waterproofing</strong></td>",r+=`<td class="num">~${u} gal</td>`,r+='<td>Liquid membrane<br><span class="material-detail">RedGard, Hydroban, or equiv.</span></td>',r+='<td class="material-note">2 coats required + corners/curbs</td>',r+="</tr>"}else i.systems.waterproofing==="sheet"&&(r+="<tr>",r+="<td><strong>Waterproofing</strong></td>",r+=`<td class="num">${b(n*1.1,0)} SF</td>`,r+='<td>Sheet membrane<br><span class="material-detail">Kerdi, NobleSeal, or equiv.</span></td>',r+='<td class="material-note">Include seam tape, corners, curbs</td>',r+="</tr>");return i.systems.underlayment==="uncoupling"&&(r+='<tr class="alt-row">',r+="<td><strong>Uncoupling Membrane</strong></td>",r+=`<td class="num">${b(n,0)} SF</td>`,r+="<td>DITRA or equivalent</td>",r+='<td class="material-note">Use unmodified thinset!</td>',r+="</tr>"),r+="</tbody></table>",r}function At(a,e,o){let t='<h2 class="section-title">\u{1F4CC} Assumptions & Exclusions</h2>';return t+='<table class="two-col-table"><tr><td>',t+="<h4>\u2713 Assumptions</h4><ul>",t+="<li>Quantities are estimates; order extra for cuts and waste</li>",t+="<li>Trowel size is a starting point \u2014 verify coverage per manufacturer</li>",t+=`<li>Waste factor: ${a}% (adjust for complex layouts)</li>`,t+='<li>Substrate assumed level within TCNA tolerance (1/4" in 10 ft)</li>',e.isLargeFormat&&(t+="<li>Large format tile requires minimum 95% mortar coverage</li>"),o&&o.id.includes("herringbone")&&(t+="<li>Herringbone pattern requires additional perimeter cuts</li>"),t+="</ul></td><td>",t+="<h4>\u2717 Exclusions (unless noted)</h4><ul>",t+="<li>Labor and installation costs</li>",t+="<li>Permits and inspections</li>",t+="<li>Subfloor repairs or leveling compound</li>",t+="<li>Plumbing/electrical modifications</li>",t+="<li>Furniture removal/replacement</li>",t+="<li>Debris hauling and disposal</li>",t+="</ul></td></tr></table>",t}function jt(){let a='<h2 class="section-title">\u2696\uFE0F Important Notices</h2>';return a+='<div class="disclaimers">',a+="<p><strong>FOR ESTIMATION PURPOSES ONLY.</strong> This document provides preliminary estimates based on the information entered. Actual material requirements may vary based on site conditions, final tile selection, installation method, and other project-specific factors. Tillerstead recommends professional on-site measurement and consultation before purchasing materials.</p>",a+="<p><strong>TROWEL & COVERAGE:</strong> Trowel recommendations are starting points based on tile size and substrate type. Always verify with tile and mortar manufacturer specifications. Confirm minimum 80% coverage (95% for wet areas and large format tile) through field testing.</p>",a+="<p><strong>WARRANTY:</strong> Material estimates do not constitute a contract, proposal, or warranty. All installations should follow TCNA Handbook guidelines and manufacturer specifications.</p>",a+='<p style="margin-top: 12pt; border-top: 0.5pt solid #d4a84b; padding-top: 8pt; font-size: 8pt;"><strong>Tillerstead LLC</strong> \u2022 NJ Registered Home Improvement Contractor #13VH10808800 \u2022 (609) 862-8808 \u2022 info@tillerstead.com</p>',a+="</div>",a}function Mt(){const a=document.createElement("a"),e=`${(i.project.name||"tile-project").replace(/[^a-z0-9]/gi,"-")}-spec.txt`;typeof window!="undefined"&&(window.__tillersteadLastDownload={kind:"txt",filename:e,at:Date.now()});try{document.documentElement.dataset.tillersteadLastDownload=e}catch(l){}let o="";const t=document.getElementById("output-content");t&&typeof t.textContent=="string"&&(o=t.textContent.trim()),o||(o=qt());const n=new Blob([o],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(n);a.href=s,a.download=e,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{try{a.parentNode&&a.parentNode.removeChild(a)}finally{URL.revokeObjectURL(s)}},6e4),B("Text file downloaded!")}function Ft(){const a=JSON.stringify(i,null,2),e=new Blob([a],{type:"application/json;charset=utf-8"}),o=URL.createObjectURL(e),t=document.createElement("a"),n=`${(i.project.name||"tile-project").replace(/[^a-z0-9]/gi,"-")}-export.json`;t.href=o,t.download=n,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{try{t.parentNode&&t.parentNode.removeChild(t)}finally{URL.revokeObjectURL(o)}},6e4)}function Rt(){const a={includeScope:document.getElementById("output-scope").checked,includeMeasurements:document.getElementById("output-measurements").checked,includeTile:document.getElementById("output-tile").checked,includeMortar:document.getElementById("output-mortar").checked,includeAssumptions:document.getElementById("output-assumptions").checked,includeDisclaimers:document.getElementById("output-disclaimers").checked},e=qe(a),o=window.open("","_blank","width=800,height=900");if(!o){B("Pop-up blocked! Allow pop-ups to print.");return}o.document.write(e),o.document.close(),o.onload=function(){setTimeout(()=>{o.focus(),o.print()},250)},B("Print dialog opening...")}function qt(){const a=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});let e="";const o="\u2550".repeat(60),t="\u2500".repeat(60);e+=o+`
`,e+=`  TILLERSTEAD TILE PROJECT SPECIFICATION
`,e+=o+`

`,e+=`Project: ${i.project.name||"Untitled Project"}
`,i.project.address&&(e+=`Address: ${i.project.address}
`),i.project.contact&&(e+=`Contact: ${i.project.contact}
`),e+=`Date: ${a}
`,e+=`
`+t+`

`;let n=0;i.rooms.forEach(c=>{c.surfaces&&Object.values(c.surfaces).forEach(d=>{d.selected&&(n+=d.area)})});const s=(i.defaults.wasteFactor||12)/100,l=n*(1+s);if(document.getElementById("output-measurements").checked&&(e+=`\u{1F4D0} MEASUREMENTS
`,e+=t+`

`,i.rooms.filter(c=>c.name).forEach(c=>{const d=Object.entries(c.surfaces||{}).filter(([,u])=>u.selected);if(d.length===0)return;e+=`${c.name}:
`,d.forEach(([u,m])=>{const f=u.replace(/-/g," ").replace(/\b\w/g,g=>g.toUpperCase());e+=`  \u2022 ${f}: ${b(m.area,1)} sf
`});const r=d.reduce((u,[,m])=>u+m.area,0);e+=`  Subtotal: ${b(r,1)} sf

`}),e+=`TOTAL TILE AREA: ${b(n,1)} sf
`,e+=`With ${i.defaults.wasteFactor||12}% waste: ${b(l,1)} sf
`,e+=`
`+t+`

`),document.getElementById("output-tile").checked){const c=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),d=O(i.defaults.layout);e+=`\u{1F532} TILE SPECIFICATION
`,e+=t+`

`,e+=`Tile Size: ${c.name}
`,e+=`Layout Pattern: ${d.name}
`,e+=`Waste Factor: ${i.defaults.wasteFactor||12}%
`;const r=144/(c.width*c.height),u=Math.ceil(l*r);if(e+=`
Tiles Required: ~${u} tiles
`,i.defaults.tilesPerBox){const m=Math.ceil(u/i.defaults.tilesPerBox);e+=`Boxes Needed: ${m} boxes (${i.defaults.tilesPerBox} tiles/box)
`}e+=`
`+t+`

`}if(document.getElementById("output-mortar").checked){const c=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),d=recommendTrowel(c.width,c.height),r=te(l,d.trowelId),u=ae(l,c.width,c.height,G(i.defaults.jointSize).size);if(e+=`\u{1F9F1} MATERIALS ESTIMATE
`,e+=t+`

`,e+=`Thinset Mortar: ${r.min}\u2013${r.max} bags (50 lb)
`,e+=`Recommended Trowel: ${H(d.trowelId).name}
`,e+=`Grout: ~${u.quantity} lbs
`,i.systems.waterproofing==="liquid"){const m=Math.ceil(n/50);e+=`Waterproofing Membrane: ~${m} gallons
`}e+=`
`+t+`

`}return document.getElementById("output-assumptions").checked&&(e+=`\u{1F4CB} ASSUMPTIONS & NOTES
`,e+=t+`

`,e+=`\u2022 Substrate assumed level and sound
`,e+=`\u2022 Coverage rates based on TCNA guidelines
`,e+=`\u2022 Mortar coverage varies with trowel technique
`,e+=`\u2022 Waste factor accounts for cuts and breakage
`,i.project.notes&&(e+=`
Project Notes:
${i.project.notes}
`),e+=`
`+t+`

`),document.getElementById("output-disclaimers").checked&&(e+=`\u26A0\uFE0F  DISCLAIMER
`,e+=t+`

`,e+=`This estimate is for planning purposes only. Actual material
`,e+=`quantities may vary based on site conditions, tile size
`,e+=`variations, and installation methods. Always verify with
`,e+=`manufacturer specifications before purchasing.

`),e+=o+`
`,e+=`Generated by Tillerstead Tools | ${a}
`,e+=`tillerstead.com/tools/
`,e+=`NJ HIC #13VH10808800
`,e+=o+`
`,e}function Pt(){let a="";return i.rooms.filter(e=>e.name).forEach(e=>{const o=Object.entries(e.surfaces||{}).filter(([,n])=>n.selected).map(([n,s])=>({name:n.replace(/-/g," ").replace(/\b\w/g,l=>l.toUpperCase()),area:s.area}));if(o.length===0)return;const t=o.reduce((n,s)=>n+s.area,0);a+='<tr class="room-header"><td colspan="2"><strong>'+h(e.name)+"</strong></td></tr>",o.forEach(n=>{a+='<tr><td class="indent">'+h(n.name)+"</td>",a+='<td class="num">'+b(n.area,1)+" sf</td></tr>"}),a+='<tr class="room-subtotal"><td class="indent">Subtotal</td>',a+='<td class="num">'+b(t,1)+" sf</td></tr>"}),a}function Pe(){let a=0;i.rooms.forEach(u=>{u.surfaces&&Object.values(u.surfaces).forEach(m=>{m.selected&&(a+=m.area)})});const e=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),o=G(i.defaults.jointSize),t=i.defaults.wasteFactor||10,n=a*(1+t/100),s=ue(a,e,t),l=ee(e,"smooth"),c=te(a,l.trowelId,l.backButter),d=ae(a,e.width,e.height,8,parseFloat(o.size)||.125,"cement",e.isMosaic);let r="";if(r+='<tr class="material-row">',r+='<td><strong>Tile</strong><br><span class="material-detail">'+h(e.name)+"</span></td>",r+='<td class="num">'+b(n,0)+" sf</td>",r+='<td class="material-note">Includes '+t+"% waste"+(i.defaults.extraAtticStock?" + attic stock":"")+"</td>",r+="</tr>",r+='<tr class="material-row">',r+='<td><strong>Thinset Mortar</strong><br><span class="material-detail">50 lb bags, '+h(H(l.trowelId).name)+" trowel</span></td>",r+='<td class="num">'+c.min+"\u2013"+c.max+" bags</td>",r+='<td class="material-note">'+(l.backButter?"Back-buttering recommended":"Standard coverage")+"</td>",r+="</tr>",r+='<tr class="material-row">',r+='<td><strong>Grout</strong><br><span class="material-detail">'+h(o.name)+" joints</span></td>",r+='<td class="num">~'+d.quantity+" lbs</td>",r+='<td class="material-note">'+(e.isMosaic?"Mosaic = more grout":"Standard joint volume")+"</td>",r+="</tr>",i.systems.underlayment==="cement-board"){const u=Math.ceil(a/15);r+='<tr class="material-row">',r+='<td><strong>Cement Board</strong><br><span class="material-detail">3\xD75 ft sheets (1/2")</span></td>',r+='<td class="num">'+u+" sheets</td>",r+='<td class="material-note">CBU screws & mesh tape needed</td>',r+="</tr>"}if(i.systems.waterproofing==="liquid"){const u=Math.ceil(a/50);r+='<tr class="material-row">',r+='<td><strong>Waterproofing</strong><br><span class="material-detail">Liquid membrane (2 coats)</span></td>',r+='<td class="num">~'+u+" gal</td>",r+='<td class="material-note">Plus corners, curbs, fabric</td>',r+="</tr>"}else i.systems.waterproofing==="sheet"&&(r+='<tr class="material-row">',r+='<td><strong>Waterproofing</strong><br><span class="material-detail">Sheet membrane</span></td>',r+='<td class="num">'+b(n*1.1,0)+" sf</td>",r+='<td class="material-note">Includes corners & seams</td>',r+="</tr>");return i.systems.underlayment==="uncoupling"&&(r+='<tr class="material-row">',r+='<td><strong>Uncoupling Membrane</strong><br><span class="material-detail">DITRA or equivalent</span></td>',r+='<td class="num">'+b(n,0)+" sf</td>",r+='<td class="material-note">Unmodified thinset required</td>',r+="</tr>"),r}function Nt(){const a=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});let e=0;i.rooms.forEach(u=>{u.surfaces&&Object.values(u.surfaces).forEach(m=>{m.selected&&(e+=m.area)})});const o=R(i.defaults.tilePreset,i.defaults.customTileWidth,i.defaults.customTileHeight),t=O(i.defaults.layout),n=G(i.defaults.jointSize),s=[];i.systems.waterproofing!=="none"&&s.push({title:"Waterproofing Systems",url:"/build/waterproofing-systems/",summary:"How your shower is protected from water damage"}),e>0&&s.push({title:"Tile Installation Standards",url:"/build/tile-installation-standards/",summary:"TCNA & ANSI standards for durable installations"}),i.systems.underlayment!=="none"&&i.systems.underlayment!=="cement-board"&&s.push({title:"Shower Pans & Slopes",url:"/build/shower-pans-slopes-drains/",summary:"Why proper slope and drainage matter"}),s.push({title:"NJ Codes & Permits",url:"/build/nj-codes-permits/",summary:"New Jersey building requirements"});const l=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Build Guide - ${h(i.project.name||"Your Project")} | Tillerstead</title>
  <style>
    /* =============================================
       TILLERSTEAD THEME - Print-Friendly Light Mode
       Colors: Gold accents, Emerald highlights, Stone neutrals
       ============================================= */
    
    @page {
      size: letter;
      margin: 0.6in 0.75in;
    }
    
    :root {
      /* Tillerstead Brand - Light/Print Variant */
      --ts-gold: #9a7a1a;
      --ts-gold-light: #c9a227;
      --ts-gold-bg: #faf6e8;
      --ts-emerald: #059669;
      --ts-emerald-light: #10b981;
      --ts-emerald-bg: #ecfdf5;
      --ts-stone: #1a1c1a;
      --ts-stone-light: #374151;
      --ts-stone-muted: #6b7280;
      --ts-bg: #ffffff;
      --ts-bg-alt: #f9fafb;
      --ts-border: #e5e7eb;
      --ts-border-light: #f3f4f6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
      font-size: 10pt;
      line-height: 1.5;
      color: var(--ts-stone);
      background: var(--ts-bg);
    }
    
    /* Page breaks */
    .page {
      page-break-after: always;
      min-height: 9in;
    }
    .page:last-child {
      page-break-after: avoid;
    }
    .no-break {
      page-break-inside: avoid;
    }
    
    /* ===== HEADER ===== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 12px;
      margin-bottom: 20px;
      border-bottom: 3px solid var(--ts-gold);
    }
    .header-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: contain;
    }
    .header-logo-fallback {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--ts-emerald) 0%, var(--ts-emerald-light) 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 20px;
      font-family: Georgia, serif;
    }
    .header-text {
      line-height: 1.2;
    }
    .header-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--ts-stone);
      letter-spacing: -0.02em;
    }
    .header-subtitle {
      font-size: 9px;
      color: var(--ts-stone-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .header-info {
      text-align: right;
      font-size: 9px;
      color: var(--ts-stone-muted);
    }
    .header-info strong {
      color: var(--ts-emerald);
      font-size: 10px;
    }
    
    /* ===== COVER PAGE ===== */
    .cover {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 8in;
      text-align: center;
      padding: 1in;
    }
    .cover-logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: contain;
      margin-bottom: 32px;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    .cover-logo-fallback {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--ts-emerald) 0%, var(--ts-emerald-light) 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 40px;
      font-family: Georgia, serif;
      margin-bottom: 32px;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    .cover h1 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--ts-stone-muted);
      margin-bottom: 8px;
    }
    .cover-project {
      font-size: 28px;
      font-weight: 700;
      color: var(--ts-stone);
      margin-bottom: 32px;
      line-height: 1.2;
    }
    .cover-client {
      font-size: 12px;
      color: var(--ts-stone-light);
      margin-bottom: 48px;
      line-height: 1.8;
    }
    .cover-meta {
      font-size: 10px;
      color: var(--ts-stone-muted);
      line-height: 1.6;
    }
    .cover-meta strong {
      color: var(--ts-gold);
    }
    
    /* ===== SECTION HEADERS ===== */
    h2 {
      font-size: 13px;
      font-weight: 700;
      color: var(--ts-emerald);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding-bottom: 6px;
      margin: 24px 0 12px;
      border-bottom: 2px solid var(--ts-gold);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    h2 .icon {
      font-size: 14px;
    }
    h3 {
      font-size: 11px;
      font-weight: 600;
      color: var(--ts-stone);
      margin: 16px 0 8px;
    }
    
    /* ===== TABLES ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 9.5pt;
    }
    th {
      background: var(--ts-stone);
      color: white;
      font-weight: 600;
      text-align: left;
      padding: 8px 12px;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    td {
      padding: 8px 12px;
      border-bottom: 1px solid var(--ts-border);
      vertical-align: top;
    }
    tr:nth-child(even) td {
      background: var(--ts-bg-alt);
    }
    
    /* Special table rows */
    .room-header td {
      background: var(--ts-gold-bg) !important;
      border-bottom: 2px solid var(--ts-gold);
      padding-top: 12px;
    }
    .room-subtotal td {
      font-weight: 600;
      color: var(--ts-emerald);
      border-bottom: 2px solid var(--ts-emerald-bg);
    }
    .total-row td {
      background: var(--ts-emerald-bg) !important;
      font-weight: 700;
      color: var(--ts-emerald);
      font-size: 11px;
      border-top: 2px solid var(--ts-emerald);
    }
    .indent {
      padding-left: 24px;
    }
    .num {
      text-align: right;
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }
    
    /* Materials table */
    .materials-table th:first-child { width: 45%; }
    .materials-table th:nth-child(2) { width: 20%; text-align: right; }
    .materials-table th:nth-child(3) { width: 35%; }
    .material-row td {
      padding: 10px 12px;
    }
    .material-detail {
      font-size: 8.5pt;
      color: var(--ts-stone-muted);
    }
    .material-note {
      font-size: 8.5pt;
      color: var(--ts-stone-muted);
      font-style: italic;
    }
    
    /* Spec table */
    .spec-table { margin: 8px 0; }
    .spec-table td:first-child {
      width: 40%;
      color: var(--ts-stone-muted);
      font-weight: 500;
    }
    .spec-table td:last-child {
      font-weight: 600;
    }
    
    /* ===== CARDS ===== */
    .card {
      border-radius: 8px;
      padding: 14px 16px;
      margin: 12px 0;
      page-break-inside: avoid;
    }
    .card-info {
      background: var(--ts-emerald-bg);
      border: 1px solid #a7f3d0;
      border-left: 4px solid var(--ts-emerald);
    }
    .card-warning {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-left: 4px solid #f59e0b;
    }
    .card-gold {
      background: var(--ts-gold-bg);
      border: 1px solid #e8d48a;
      border-left: 4px solid var(--ts-gold);
    }
    .card h4 {
      font-size: 10px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .card-info h4 { color: var(--ts-emerald); }
    .card-warning h4 { color: #b45309; }
    .card-gold h4 { color: var(--ts-gold); }
    .card p, .card li {
      font-size: 9pt;
      color: var(--ts-stone-light);
      margin: 0;
    }
    
    /* ===== GRID LAYOUTS ===== */
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .guide-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 12px 0;
    }
    .guide-card {
      background: var(--ts-bg-alt);
      border: 1px solid var(--ts-border);
      border-radius: 6px;
      padding: 12px;
    }
    .guide-card h4 {
      font-size: 10px;
      font-weight: 700;
      color: var(--ts-emerald);
      margin-bottom: 4px;
    }
    .guide-card p {
      font-size: 8.5pt;
      color: var(--ts-stone-muted);
      margin-bottom: 6px;
    }
    .guide-card .url {
      font-size: 8pt;
      color: var(--ts-gold);
      font-weight: 500;
    }
    
    /* ===== CHECKLIST ===== */
    .checklist {
      list-style: none;
      padding: 0;
      margin: 12px 0;
    }
    .checklist li {
      padding: 8px 0 8px 28px;
      position: relative;
      border-bottom: 1px solid var(--ts-border-light);
      font-size: 9.5pt;
    }
    .checklist li::before {
      content: "\u2610";
      position: absolute;
      left: 4px;
      color: var(--ts-emerald);
      font-size: 14px;
    }
    
    /* ===== FOOTER ===== */
    .footer {
      margin-top: auto;
      padding-top: 16px;
      border-top: 1px solid var(--ts-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 8pt;
      color: var(--ts-stone-muted);
    }
    .footer-brand {
      font-weight: 600;
      color: var(--ts-gold);
    }
    
    /* ===== UTILITIES ===== */
    .text-gold { color: var(--ts-gold); }
    .text-emerald { color: var(--ts-emerald); }
    .text-muted { color: var(--ts-stone-muted); }
    .text-center { text-align: center; }
    .mt-0 { margin-top: 0; }
    .mb-0 { margin-bottom: 0; }
    
    /* ===== PRINT ===== */
    @media print {
      body {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }
      .page {
        margin: 0;
        padding: 0;
      }
    }
  </style>
</head>
<body>

<!-- ==================== COVER PAGE ==================== -->
<div class="page cover">
  <img src="https://tillerstead.com/assets/img/logo/logo-wolf-crest.webp" 
       alt="Tillerstead Wolf Crest" 
       class="cover-logo"
       onerror="this.outerHTML='<div class=\\'cover-logo-fallback\\'>T</div>'">
  <h1>Tile Project Build Guide</h1>
  <div class="cover-project">${h(i.project.name||"Your Tile Project")}</div>
  <div class="cover-client">
    ${i.project.clientName?`<strong>${h(i.project.clientName)}</strong><br>`:""}
    ${i.project.address?`${h(i.project.address)}<br>`:""}
    ${i.project.county?`${h(i.project.county)}`:""}
  </div>
  <div class="cover-meta">
    Prepared <strong>${a}</strong><br>
    by Tillerstead LLC<br>
    NJ HIC #13VH10808800
  </div>
</div>

<!-- ==================== PROJECT SPECIFICATIONS ==================== -->
<div class="page">
  <div class="header">
    <div class="header-brand">
      <img src="https://tillerstead.com/assets/img/logo/logo-wolf-crest-compact.webp" 
           alt="Tillerstead" 
           class="header-logo"
           onerror="this.outerHTML='<div class=\\'header-logo-fallback\\'>T</div>'">
      <div class="header-text">
        <div class="header-title">Tillerstead</div>
        <div class="header-subtitle">Professional Tile Installation</div>
      </div>
    </div>
    <div class="header-info">
      <strong>Licensed & Insured</strong><br>
      NJ HIC #13VH10808800 \u2022 (609) 862-8808
    </div>
  </div>

  <h2><span class="icon">\u{1F4CB}</span> Project Specifications</h2>
  
  <table class="spec-table">
    ${i.project.name?`<tr><td>Project</td><td>${h(i.project.name)}</td></tr>`:""}
    ${i.project.clientName?`<tr><td>Client</td><td>${h(i.project.clientName)}</td></tr>`:""}
    ${i.project.address?`<tr><td>Address</td><td>${h(i.project.address)}</td></tr>`:""}
    <tr><td>Date Prepared</td><td>${a}</td></tr>
    <tr class="total-row"><td>Total Tile Area</td><td>${b(e,1)} sq ft</td></tr>
  </table>

  <div class="two-col">
    <div>
      <h2><span class="icon">\u{1F9F1}</span> Tile Selection</h2>
      <table class="spec-table mt-0">
        <tr><td>Tile Size</td><td>${h(o.name)}</td></tr>
        <tr><td>Layout Pattern</td><td>${h(t.name)}</td></tr>
        <tr><td>Grout Joint</td><td>${h(n.name)}</td></tr>
        <tr><td>Waste Factor</td><td>${i.defaults.wasteFactor}%</td></tr>
        ${i.defaults.extraAtticStock?"<tr><td>Attic Stock</td><td>\u2713 Included</td></tr>":""}
      </table>
    </div>
    <div>
      <h2><span class="icon">\u{1F527}</span> Systems</h2>
      <table class="spec-table mt-0">
        <tr>
          <td>Underlayment</td>
          <td>${i.systems.underlayment==="none"?"\u2014":i.systems.underlayment==="cement-board"?"Cement Board":i.systems.underlayment==="uncoupling"?"Uncoupling Membrane":i.systems.underlayment==="mud-bed"?"Mud Bed":i.systems.underlayment==="self-leveler"?"Self-Leveler":h(i.systems.underlayment)}</td>
        </tr>
        <tr>
          <td>Waterproofing</td>
          <td>${i.systems.waterproofing==="none"?"\u2014":i.systems.waterproofing==="liquid"?"Liquid Membrane":i.systems.waterproofing==="sheet"?"Sheet Membrane":h(i.systems.waterproofing)}</td>
        </tr>
        <tr><td>Edge Trim</td><td>${i.systems.edgeTrim==="none"?"\u2014":h(i.systems.edgeTrim)}</td></tr>
        <tr><td>Movement Joints</td><td>${i.systems.movementJoints?"\u2713 Required":"TBD"}</td></tr>
      </table>
    </div>
  </div>

  ${o.isLargeFormat?`
  <div class="card card-warning no-break">
    <h4>\u26A0\uFE0F Large Format Tile</h4>
    <p>Tiles larger than 15" require substrate flatness within 1/8" in 10 feet per ANSI A108.02. 
    Floor leveling may be needed. Minimum 95% mortar coverage with back-buttering.</p>
  </div>
  `:""}

  ${t.lippageRisk?`
  <div class="card card-warning no-break">
    <h4>\u26A0\uFE0F Lippage Risk</h4>
    <p>A 50% offset pattern with rectangular tiles increases lippage risk. Consider 1/3 offset 
    or verify tiles are within ANSI warpage tolerances.</p>
  </div>
  `:""}

  ${i.systems.waterproofing!=="none"?`
  <div class="card card-info no-break">
    <h4>\u2713 Waterproofing Included</h4>
    <p>Your project includes waterproofing per TCNA Handbook and ANSI A118.10 standards. 
    Continuity maintained at corners, penetrations, and transitions.</p>
  </div>
  `:""}

  <div class="footer">
    <span class="footer-brand">Tillerstead LLC</span>
    <span>Page 2 \u2022 tillerstead.com</span>
  </div>
</div>

<!-- ==================== MEASUREMENTS & MATERIALS ==================== -->
<div class="page">
  <div class="header">
    <div class="header-brand">
      <div class="header-logo">T</div>
      <div class="header-text">
        <div class="header-title">Tillerstead</div>
        <div class="header-subtitle">Professional Tile Installation</div>
      </div>
    </div>
    <div class="header-info">
      <strong>Licensed & Insured</strong><br>
      NJ HIC #13VH10808800
    </div>
  </div>

  <h2><span class="icon">\u{1F4D0}</span> Room Measurements</h2>
  
  <table>
    <thead>
      <tr>
        <th>Room / Surface</th>
        <th style="text-align: right; width: 100px;">Area</th>
      </tr>
    </thead>
    <tbody>
      ${Pt()}
      <tr class="total-row">
        <td><strong>TOTAL TILE AREA</strong></td>
        <td class="num"><strong>${b(e,1)} sf</strong></td>
      </tr>
    </tbody>
  </table>

  <h2><span class="icon">\u{1F4E6}</span> Estimated Materials</h2>
  
  <table class="materials-table">
    <thead>
      <tr>
        <th>Material</th>
        <th>Quantity</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody>
      ${Pe()}
    </tbody>
  </table>

  <div class="card card-gold no-break">
    <h4>\u{1F4DD} Material Notes</h4>
    <p>Quantities are estimates. Final amounts depend on actual site conditions, tile lot size, 
    and manufacturer packaging. Always order 10-15% extra for cuts, waste, and future repairs. 
    Confirm with your supplier before purchasing.</p>
  </div>

  ${i.systems.demoTile||i.systems.demoUnderlayment||i.systems.subfloorRepair||i.systems.disposal?`
  <h2><span class="icon">\u{1F528}</span> Preparation Scope</h2>
  <ul style="padding-left: 20px; margin: 8px 0;">
    ${i.systems.demoTile?"<li>Remove existing tile and thin-set</li>":""}
    ${i.systems.demoUnderlayment?"<li>Remove existing underlayment/backer board</li>":""}
    ${i.systems.subfloorRepair?"<li>Subfloor repair and preparation</li>":""}
    ${i.systems.disposal?"<li>Debris removal and disposal</li>":""}
  </ul>
  `:""}

  ${i.project.notes?`
  <h2><span class="icon">\u{1F4DD}</span> Project Notes</h2>
  <div class="card card-info">
    <p>${h(i.project.notes)}</p>
  </div>
  `:""}

  <div class="footer">
    <span class="footer-brand">Tillerstead LLC</span>
    <span>Page 3 \u2022 tillerstead.com</span>
  </div>
</div>

<!-- ==================== BUILD GUIDES & CHECKLIST ==================== -->
<div class="page">
  <div class="header">
    <div class="header-brand">
      <div class="header-logo">T</div>
      <div class="header-text">
        <div class="header-title">Tillerstead</div>
        <div class="header-subtitle">Professional Tile Installation</div>
      </div>
    </div>
    <div class="header-info">
      <strong>Licensed & Insured</strong><br>
      NJ HIC #13VH10808800
    </div>
  </div>

  <h2><span class="icon">\u{1F4DA}</span> Build Guide References</h2>
  <p class="text-muted" style="font-size: 9pt; margin-bottom: 12px;">These guides explain the standards relevant to your project. Visit tillerstead.com to read more.</p>
  
  <div class="guide-grid">
    ${s.map(u=>`
    <div class="guide-card">
      <h4>${h(u.title)}</h4>
      <p>${h(u.summary)}</p>
      <div class="url">tillerstead.com${u.url}</div>
    </div>
    `).join("")}
  </div>

  <h2><span class="icon">\u2705</span> Homeowner Checklist</h2>
  
  <ul class="checklist">
    <li>Review specifications with installer before work begins</li>
    <li>Confirm tile selection and quantities with supplier</li>
    <li>Discuss movement joint locations (perimeter & field)</li>
    <li>Verify waterproofing system and compatibility</li>
    <li>Request mortar coverage test during installation</li>
    <li>Obtain written warranty documentation</li>
    <li>Schedule flood test for shower/wet areas</li>
    <li>Review cleaning and maintenance instructions</li>
  </ul>

  <div class="two-col" style="margin-top: 20px;">
    <div class="card card-info">
      <h4>TCNA & ANSI Standards</h4>
      <p>We follow TCNA Handbook methods and ANSI A108/A118 standards on every project\u2014even when not required by code. 
      These industry best practices ensure your installation performs properly for years to come.</p>
    </div>
    <div class="card card-gold">
      <h4>NJ HIC Requirements</h4>
      <p>As a licensed NJ Home Improvement Contractor (#13VH10808800), we provide written contracts, 
      detailed scopes, and honor all warranty commitments per N.J.A.C. 13:45A-16.</p>
    </div>
  </div>

  <div class="footer">
    <span class="footer-brand">Tillerstead LLC</span>
    <span>Page 4 \u2022 tillerstead.com</span>
  </div>
</div>

<!-- ==================== DISCLAIMERS & CONTACT ==================== -->
<div class="page">
  <div class="header">
    <div class="header-brand">
      <div class="header-logo">T</div>
      <div class="header-text">
        <div class="header-title">Tillerstead</div>
        <div class="header-subtitle">Professional Tile Installation</div>
      </div>
    </div>
    <div class="header-info">
      <strong>Licensed & Insured</strong><br>
      NJ HIC #13VH10808800
    </div>
  </div>

  <h2><span class="icon">\u26A0\uFE0F</span> Important Notices</h2>
  
  <ul style="padding-left: 20px; font-size: 9.5pt; line-height: 1.7;">
    <li><strong>Material Quantities:</strong> All quantities are estimates based on measurements provided. 
    Verify with your supplier and account for manufacturer-recommended overage.</li>
    <li><strong>Trowel Selection:</strong> Notch recommendations are starting points. Coverage must be 
    verified by periodically lifting tiles during installation.</li>
    <li><strong>Grout Joints:</strong> Final joint width depends on tile variation, warpage, and 
    manufacturer recommendations.</li>
    <li><strong>Site Conditions:</strong> Final scope may be adjusted based on actual conditions. 
    Any changes will be documented in writing.</li>
    <li><strong>Not a Contract:</strong> This specification is for planning purposes only. A formal 
    contract with complete terms will be provided before work begins.</li>
  </ul>

  <h2><span class="icon">\u{1F4DE}</span> Contact Information</h2>
  
  <table class="spec-table" style="max-width: 400px;">
    <tr><td>Company</td><td>Tillerstead LLC</td></tr>
    <tr><td>Phone</td><td>(609) 862-8808</td></tr>
    <tr><td>Email</td><td>info@tillerstead.com</td></tr>
    <tr><td>Website</td><td>tillerstead.com</td></tr>
    <tr><td>NJ HIC License</td><td>13VH10808800</td></tr>
    <tr><td>Service Area</td><td>Atlantic, Ocean & Cape May Counties, NJ</td></tr>
  </table>

  <div class="card card-info" style="margin-top: 24px;">
    <h4>Ready to Get Started?</h4>
    <p>Contact us to schedule a site visit and receive a detailed written proposal. We'll review your project 
    in person, discuss your goals, and provide transparent pricing with no hidden fees.</p>
  </div>

  <div class="footer" style="margin-top: auto; flex-direction: column; text-align: center; gap: 4px;">
    <span>Generated ${a} by Tillerstead Tools</span>
    <span>\xA9 ${new Date().getFullYear()} Tillerstead LLC \u2022 All Rights Reserved</span>
    <span style="color: var(--ts-gold);">tillerstead.com/tools/</span>
  </div>
</div>

</body>
</html>`,c=new Blob([l],{type:"text/html"}),d=URL.createObjectURL(c),r=window.open(d,"_blank");if(r)r.onload=function(){setTimeout(()=>{r.print()},500)},B('Build Guide ready! Select "Save as PDF" in Print dialog');else{const u=document.createElement("a"),m=(i.project.name||"tile-project").replace(/[^a-z0-9]/gi,"-")+"-build-guide.html";u.href=d,u.download=m,document.body.appendChild(u),u.click(),document.body.removeChild(u),B("Build Guide downloaded! Open and Print \u2192 Save as PDF")}setTimeout(()=>URL.revokeObjectURL(d),6e4)}function B(a,e="success"){const o=document.querySelector(".toast");o&&o.remove();const t=document.createElement("div");t.className=`toast toast--${e}`,t.textContent=a,t.setAttribute("role",e==="error"?"alert":"status"),t.setAttribute("aria-live",e==="error"?"assertive":"polite"),document.body.appendChild(t),requestAnimationFrame(()=>{t.classList.add("toast--visible"),t.classList.add("visible")}),setTimeout(()=>{t.classList.remove("toast--visible"),t.classList.remove("visible"),setTimeout(()=>t.remove(),300)},e==="error"?5e3:3e3)}const w=fe(function(){try{localStorage.setItem(ve,JSON.stringify(i))}catch(a){console.warn("Could not save to localStorage:",a)}},500);function _t(){try{const a=localStorage.getItem(ve);if(a){const e=JSON.parse(a);return i={...i,...e,project:{...i.project,...e.project},defaults:{...i.defaults,...e.defaults},systems:{...i.systems,...e.systems}},!0}}catch(a){console.warn("Could not load from localStorage:",a)}return!1}function Ne(){confirm("Reset all data? This cannot be undone.")&&(localStorage.removeItem(ve),location.reload())}function Wt(){document.getElementById("rooms-list").innerHTML="",document.getElementById("project-name").value=i.project.name||"",document.getElementById("client-name").value=i.project.clientName||"",document.getElementById("project-address").value=i.project.address||"",document.getElementById("project-county").value=i.project.county||"",document.getElementById("client-phone").value=i.project.phone||"",document.getElementById("client-email").value=i.project.email||"",document.getElementById("project-notes").value=i.project.notes||"",document.getElementById("default-tile-size").value=i.defaults.tilePreset||"",document.getElementById("custom-tile-width").value=i.defaults.customTileWidth||"",document.getElementById("custom-tile-height").value=i.defaults.customTileHeight||"",document.getElementById("default-tile-thickness").value=i.defaults.tileThickness||8,document.getElementById("default-layout").value=i.defaults.layout||"",document.getElementById("default-waste").value=i.defaults.wasteFactor||12,document.getElementById("default-joint").value=i.defaults.jointSize||"",document.getElementById("extra-attic-stock").checked=i.defaults.extraAtticStock||!1,document.getElementById("custom-tile-fields").hidden=i.defaults.tilePreset!=="custom",document.getElementById("underlayment").value=i.systems.underlayment||"none",document.getElementById("waterproofing").value=i.systems.waterproofing||"none",document.getElementById("edge-trim").value=i.systems.edgeTrim||"none",document.getElementById("movement-joints").checked=i.systems.movementJoints||!1,document.getElementById("demo-tile").checked=i.systems.demoTile||!1,document.getElementById("demo-underlayment").checked=i.systems.demoUnderlayment||!1,document.getElementById("subfloor-repair").checked=i.systems.subfloorRepair||!1,document.getElementById("disposal").checked=i.systems.disposal||!1,i.rooms.forEach(a=>{Te(a)}),z(),K(),xe()}function Ot(){const a=parseFloat(document.getElementById("calc-area").value)||0,e=document.getElementById("calc-tile-size").value,o=parseFloat(document.getElementById("calc-custom-width").value)||0,t=parseFloat(document.getElementById("calc-custom-height").value)||0,n=document.getElementById("calc-layout").value,s=parseFloat(document.getElementById("calc-waste").value)||12,l=document.getElementById("calc-box-mode").value,c=parseFloat(document.getElementById("calc-tiles-per-box").value)||0,d=parseFloat(document.getElementById("calc-sqft-per-box").value)||0,r=document.getElementById("calc-attic-stock").checked;if(a<=0){B("Enter a valid area");return}const u=R(e,o,t),m=ue(a,u,s),f=dt(m.tiles,c,d,u,m.areaWithWaste,r);document.getElementById("result-area-waste").textContent=`${b(m.areaWithWaste,1)} sq ft`,document.getElementById("result-tiles").textContent=b(m.tiles),document.getElementById("result-boxes").textContent=f.boxes>0?`${b(f.boxes)} boxes`:f.note;const g=document.getElementById("tile-calc-note");let p="";r&&(p="Includes attic stock for future repairs. "),u.isMosaic&&(p+="Mosaic sheets calculated at ~1 sq ft per 12\xD712 sheet."),g.textContent=p,document.getElementById("tile-calc-results").hidden=!1}function Dt(){var _,U;const a=parseFloat(document.getElementById("mortar-area").value)||0,e=document.getElementById("mortar-tile-size").value,o=parseFloat(document.getElementById("mortar-custom-width").value)||0,t=parseFloat(document.getElementById("mortar-custom-height").value)||0,n=document.getElementById("mortar-substrate").value,s=document.getElementById("mortar-trowel").value,l=document.getElementById("mortar-backbutter").checked,c=((_=document.getElementById("mortar-coverage-goal"))==null?void 0:_.value)||"standard";if(a<=0){B("Enter a valid area");return}const d=R(e,o,t),r=ee(d,n),u=r.trowelId,m=H(u);let f=u,g=!1;s&&s!=="auto"&&(f=s,g=s!==u);const p=document.getElementById("trowel-comparison"),v=document.getElementById("trowel-recommended-display"),y=document.getElementById("trowel-selected-display"),x=document.getElementById("mortar-trowel-override-reason-field");if(p&&v&&y){if(v.innerHTML=`
        <span class="trowel-label">Recommended:</span>
        <span class="trowel-value">${h(m.name)}</span>
        <span class="trowel-note">${h(r.note||"Starting point; verify coverage")}</span>
        ${r.warning?`<span class="trowel-warning">\u26A0\uFE0F ${h(r.warning)}</span>`:""}
      `,g){const P=H(f),V=P.notForLFT&&d.isLargeFormat;y.innerHTML=`
          <span class="trowel-label">Selected:</span>
          <span class="trowel-value trowel-value--override">${h(P.name)}</span>
          <span class="trowel-note trowel-note--override">\u2191 Override</span>
          ${V?`<span class="trowel-warning">\u26A0\uFE0F CBP does NOT recommend ${h(P.name)} for large format tile</span>`:""}
        `,y.hidden=!1,x&&(x.hidden=!1)}else y.hidden=!0,x&&(x.hidden=!0);p.hidden=!1}i.trowelOverride={selected:g?f:null,reason:g&&((U=document.getElementById("mortar-trowel-override-reason"))==null?void 0:U.value)||""};const S=document.getElementById("trowel-recommendation"),$=document.getElementById("trowel-recommendation-text");if(S&&$&&($.textContent=`${m.name}. ${r.note}`,S.hidden=!1),(d.isLargeFormat||Math.max(d.width,d.height)>=15)&&!l){const P=document.getElementById("mortar-backbutter");P&&(P.checked=!0,B("Back-buttering auto-enabled for large format tile (TCNA requirement: 95% coverage)"))}let L=1;c==="wet-area"?L=.95:c==="large-format"&&(L=.9);const C=te(a/L,f,l),A=H(f);document.getElementById("result-trowel").textContent=A.name,document.getElementById("result-coverage").textContent=C.coverage,document.getElementById("result-bags").textContent=C.min===C.max?`${C.min} bags`:`${C.min}\u2013${C.max} bags`;const q=document.getElementById("substrate-nudge"),M=document.getElementById("substrate-nudge-text");n==="needs-flattening"?(M.textContent="Substrate needs flattening. Consider self-leveler or patching before tile installation. Factor in additional material and labor.",q.hidden=!1):q.hidden=!0;const F=document.getElementById("backbutter-nudge");d.isLargeFormat&&!document.getElementById("mortar-backbutter").checked?F.hidden=!1:F.hidden=!0,document.getElementById("mortar-calc-results").hidden=!1}function Ht(){const a=parseFloat(document.getElementById("grout-area").value)||0,e=parseFloat(document.getElementById("grout-tile-length").value)||0,o=parseFloat(document.getElementById("grout-tile-width").value)||0,t=parseFloat(document.getElementById("grout-tile-thickness").value)||8,n=document.getElementById("grout-joint-width").value,s=parseFloat(document.getElementById("grout-custom-joint").value)||0,l=document.getElementById("grout-type").value,c=document.getElementById("grout-mosaic").checked;if(a<=0||e<=0||o<=0){B("Enter all required values");return}let d;if(n==="custom"?d=s:d=G(n).size,d<=0){B("Select or enter a joint width");return}const r=ae(a,e,o,t,d,l,c);document.getElementById("result-joint-volume").textContent=`${r.volume} cu ft`,document.getElementById("result-grout").textContent=`~${r.quantity} lbs`,document.getElementById("grout-calc-results").hidden=!1}function zt(){const a=parseFloat(document.getElementById("level-area").value)||0,e=parseFloat(document.getElementById("level-depth-avg").value)||0,o=parseFloat(document.getElementById("level-depth-max").value)||0;if(a<=0||e<=0){B("Enter area and average depth");return}const t=Me(a,e,o);document.getElementById("result-level-volume").textContent=`${t.volume} cu ft`,document.getElementById("result-level-bags").textContent=t.bagsMax>t.bags?`${t.bags}\u2013${t.bagsMax}`:`~${t.bags}`,document.getElementById("level-calc-results").hidden=!1}function Ut(){document.addEventListener("click",Vt),document.addEventListener("change",Yt),document.addEventListener("input",Kt);const a=document.getElementById("estimate-form");a&&a.addEventListener("submit",v=>v.preventDefault());const e=document.getElementById("calc-tile-btn");e&&e.addEventListener("click",Ot);const o=document.getElementById("calc-mortar-btn");o&&o.addEventListener("click",Dt);const t=document.getElementById("calc-grout-btn");t&&t.addEventListener("click",Ht);const n=document.getElementById("calc-level-btn");n&&n.addEventListener("click",zt);const s=document.getElementById("generate-scope-btn");s&&s.addEventListener("click",()=>{const v=me();Ie(v),v.length===0&&Re()});const l=document.getElementById("generate-output-btn");l&&l.addEventListener("click",Re);const c=document.getElementById("copy-output-btn");c&&c.addEventListener("click",$t);const d=document.getElementById("print-output-btn");d&&d.addEventListener("click",Rt);const r=document.getElementById("download-doc-btn");r&&r.addEventListener("click",kt);const u=document.getElementById("download-pdf-btn");u&&u.addEventListener("click",Nt);const m=document.getElementById("save-project-btn");m&&m.addEventListener("click",()=>{w(),B("Project saved!")});const f=document.getElementById("reset-project-btn");f&&f.addEventListener("click",Ne);const g=document.getElementById("add-room-btn");g&&g.addEventListener("click",()=>{Te()});const p=document.querySelector(".tools-nav__list");p&&p.addEventListener("keydown",v=>{if(v.key==="ArrowRight"||v.key==="ArrowLeft"){const y=Array.from(document.querySelectorAll(".tools-nav__link")),x=document.activeElement,S=y.indexOf(x);S>-1&&(v.preventDefault(),(v.key==="ArrowRight"?y[(S+1)%y.length]:y[(S-1+y.length)%y.length]).focus())}})}function Vt(a){const e=a.target;if(e.closest("#download-txt-btn")){Mt();return}if(e.closest(".room-remove-btn")){const o=e.closest(".room-card");if(o){const t=o.dataset.roomId;(i.rooms.length>1||confirm("Remove this room?"))&&ht(t)}}if(e.closest(".add-deduction-btn")){const o=e.closest(".add-deduction-btn"),t=o.dataset.surface,n=o.closest(".room-card");n&&t&&Gt(n.dataset.roomId,t)}if(e.closest(".remove-deduction-btn")){const o=e.closest(".remove-deduction-btn"),t=o.dataset.surface,n=parseInt(o.dataset.index),s=o.closest(".room-card");s&&t&&!isNaN(n)&&Jt(s.dataset.roomId,t,n)}e.closest(".back-to-top")&&window.scrollTo({top:0,behavior:"smooth"})}function Gt(a,e){const o=i.rooms.find(n=>n.id===a);if(!o||!o.surfaces||!o.surfaces[e])return;o.surfaces[e].deductions||(o.surfaces[e].deductions=[]),o.surfaces[e].deductions.push({label:"",width:0,height:0,area:0});const t=document.querySelector(`[data-room-id="${a}"]`);t&&Se(t,o),w()}function Jt(a,e,o){const t=i.rooms.find(s=>s.id===a);if(!t||!t.surfaces||!t.surfaces[e])return;t.surfaces[e].deductions&&t.surfaces[e].deductions[o]&&t.surfaces[e].deductions.splice(o,1);const n=document.querySelector(`[data-room-id="${a}"]`);n&&(Se(n,t),oe(t)),z(),w()}function $e(a,e,o,t,n){var d;const s=i.rooms.find(r=>r.id===a);if(!s||!s.surfaces||!s.surfaces[e])return;const l=(d=s.surfaces[e].deductions)==null?void 0:d[o];if(!l)return;l[t]=n,l.width>0&&l.height>0&&(l.area=l.width*l.height/144),oe(s),z(),w();const c=document.querySelector(`[data-room-id="${a}"]`);if(c){const r=c.querySelector(`[data-deductions="${e}"] [data-index="${o}"] .deduction-area`);r&&(r.textContent=l.area>0?b(l.area,1)+" sf":"\u2014");const u=c.querySelector(`[data-surface-id="${e}"] .surface-net-value`);u&&(u.textContent=b(s.surfaces[e].netArea||0,1)+" sf")}}function Yt(a){const e=a.target;if(e.id==="project-name"&&(i.project.name=e.value,w()),e.id==="client-name"&&(i.project.clientName=e.value,w()),e.id==="project-address"&&(i.project.address=e.value,w()),e.id==="project-county"&&(i.project.county=e.value,w()),e.id==="client-phone"&&(i.project.phone=e.value,w()),e.id==="client-email"&&(i.project.email=e.value,w()),e.id==="project-notes"&&(i.project.notes=e.value,w()),e.id==="default-tile-size"&&(i.defaults.tilePreset=e.value,document.getElementById("custom-tile-fields").hidden=e.value!=="custom",K(),xe(),w()),e.id==="custom-tile-width"&&(i.defaults.customTileWidth=parseFloat(e.value)||0,K(),w()),e.id==="custom-tile-height"&&(i.defaults.customTileHeight=parseFloat(e.value)||0,K(),w()),e.id==="default-tile-thickness"&&(i.defaults.tileThickness=parseInt(e.value)||8,w()),e.id==="default-layout"){i.defaults.layout=e.value;const t=O(e.value);t&&(document.getElementById("default-waste").value=Math.round(t.wasteFactor*100),i.defaults.wasteFactor=Math.round(t.wasteFactor*100),document.getElementById("waste-hint").textContent=`Suggested: ${t.wasteRange} for ${t.name}`),K(),w()}e.id==="default-waste"&&(i.defaults.wasteFactor=parseInt(e.value)||12,w()),e.id==="default-joint"&&(i.defaults.jointSize=e.value,w()),e.id==="extra-attic-stock"&&(i.defaults.extraAtticStock=e.checked,w()),e.id==="underlayment"&&(i.systems.underlayment=e.value,w()),e.id==="waterproofing"&&(i.systems.waterproofing=e.value,w()),e.id==="edge-trim"&&(i.systems.edgeTrim=e.value,w()),e.id==="movement-joints"&&(i.systems.movementJoints=e.checked,w()),e.id==="demo-tile"&&(i.systems.demoTile=e.checked,w()),e.id==="demo-underlayment"&&(i.systems.demoUnderlayment=e.checked,w()),e.id==="subfloor-repair"&&(i.systems.subfloorRepair=e.checked,w()),e.id==="disposal"&&(i.systems.disposal=e.checked,w());const o=e.closest(".room-card");if(o){const t=o.dataset.roomId;if(e.classList.contains("room-name-input")&&J(t,"name",e.value),e.classList.contains("surface-checkbox")&&bt(t,e.dataset.surface,e.checked),e.classList.contains("room-lock-checkbox")){const n=i.rooms.find(s=>s.id===t);if(n){const s=n.locked;n.locked=e.checked,n.auditTrail||(n.auditTrail=[]),o.querySelectorAll(".room-length-ft, .room-length-in, .room-width-ft, .room-width-in, .room-height-ft, .room-height-in").forEach(d=>{d.disabled=e.checked}),o.classList.toggle("room-card--locked",e.checked);const c={timestamp:new Date().toISOString(),action:e.checked?"locked":"unlocked",reason:"",dimensions:{length:W(n.lengthFt,n.lengthIn),width:W(n.widthFt,n.widthIn),height:W(n.heightFt,n.heightIn)}};if(s&&!e.checked){const d=prompt("Optional: Enter reason for unlocking measurements:");d!==null&&(c.reason=d)}n.auditTrail.push(c),ft(o,n),o.querySelector(".room-lock-reason").hidden=!0,w()}}if(e.classList.contains("surface-area-mode")){const n=e.dataset.surface,s=i.rooms.find(l=>l.id===t);if(s&&s.surfaces&&s.surfaces[n]){s.surfaces[n].areaMode=e.value;const l=o.querySelector(`[data-surface-id="${n}"] .surface-manual-area-field`);l&&(l.hidden=e.value!=="manual"),oe(s),z(),w()}}if(e.classList.contains("surface-manual-area")){const n=e.dataset.surface,s=i.rooms.find(l=>l.id===t);if(s&&s.surfaces&&s.surfaces[n]){s.surfaces[n].manualArea=parseFloat(e.value)||0,oe(s),z(),w();const l=o.querySelector(`[data-surface-id="${n}"] .surface-net-value`);l&&(l.textContent=b(s.surfaces[n].netArea||0,1)+" sf")}}if(e.classList.contains("surface-use-defaults")){const n=e.dataset.surface,s=i.rooms.find(l=>l.id===t);if(s&&s.surfaces&&s.surfaces[n]){s.surfaces[n].useGlobalDefaults=e.checked;const l=o.querySelector(`[data-surface-id="${n}"] .surface-overrides`);l&&(l.hidden=e.checked),w()}}if(e.classList.contains("surface-tile-override")){const n=e.dataset.surface,s=i.rooms.find(l=>l.id===t);s&&s.surfaces&&s.surfaces[n]&&(s.surfaces[n].overrides||(s.surfaces[n].overrides={}),s.surfaces[n].overrides.tilePreset=e.value,w())}if(e.classList.contains("surface-waste-override")){const n=e.dataset.surface,s=i.rooms.find(l=>l.id===t);s&&s.surfaces&&s.surfaces[n]&&(s.surfaces[n].overrides||(s.surfaces[n].overrides={}),s.surfaces[n].overrides.waste=parseFloat(e.value)||null,w())}}if(e.id==="calc-tile-size"&&(document.getElementById("calc-custom-tile-fields").hidden=e.value!=="custom"),e.id==="mortar-tile-size"&&(document.getElementById("mortar-custom-tile-fields").hidden=e.value!=="custom"),e.id==="calc-box-mode"&&(document.getElementById("calc-tiles-per-box-field").hidden=e.value!=="tiles-per-box",document.getElementById("calc-sqft-per-box-field").hidden=e.value!=="sqft-per-box"),e.id==="grout-joint-width"&&(document.getElementById("grout-custom-joint-field").hidden=e.value!=="custom"),e.id==="mortar-tile-size"||e.id==="mortar-substrate"){const t=document.getElementById("mortar-tile-size").value,n=parseFloat(document.getElementById("mortar-custom-width").value)||0,s=parseFloat(document.getElementById("mortar-custom-height").value)||0,l=document.getElementById("mortar-substrate").value,c=R(t,n,s),d=ee(c,l);document.getElementById("trowel-hint").textContent=`Recommended: ${H(d.trowelId).name}`}if(e.id==="calc-layout"){const t=O(e.value);t&&(document.getElementById("calc-waste").value=Math.round(t.wasteFactor*100))}}function Kt(a){const e=a.target,o=e.closest(".room-card");if(["calc-area","mortar-area","grout-area","level-area","labor-area","wp-area","wp-floor-area","wp-wall-area"].includes(e.id)&&(e.dataset.synced="false"),o){const n=o.dataset.roomId;if(e.classList.contains("room-length-ft")&&J(n,"lengthFt",parseFloat(e.value)||0),e.classList.contains("room-length-in")&&J(n,"lengthIn",parseFloat(e.value)||0),e.classList.contains("room-width-ft")&&J(n,"widthFt",parseFloat(e.value)||0),e.classList.contains("room-width-in")&&J(n,"widthIn",parseFloat(e.value)||0),e.classList.contains("room-height-ft")&&J(n,"heightFt",parseFloat(e.value)||0),e.classList.contains("room-height-in")&&J(n,"heightIn",parseFloat(e.value)||0),e.classList.contains("room-lock-reason-input")){const l=i.rooms.find(c=>c.id===n);l&&(l.lockReason=e.value,w())}const s=e.closest(".deduction-row");if(s){const l=parseInt(s.dataset.index),c=e.closest(".surface-detail-card");if(c&&!isNaN(l)){const d=c.dataset.surfaceId;e.classList.contains("deduction-label")&&$e(n,d,l,"label",e.value),e.classList.contains("deduction-width")&&$e(n,d,l,"width",parseFloat(e.value)||0),e.classList.contains("deduction-height")&&$e(n,d,l,"height",parseFloat(e.value)||0)}}}}function Qt(){const a=document.querySelector(".back-to-top");if(!a)return;let e=!1;function o(){window.scrollY>400?a.classList.add("visible"):a.classList.remove("visible"),e=!1}window.addEventListener("scroll",()=>{e||(requestAnimationFrame(o),e=!0)},{passive:!0})}function Zt(){document.querySelectorAll(".tools-nav__link").forEach(a=>{a.addEventListener("click",e=>{e.preventDefault();const o=document.querySelector(a.getAttribute("href"));if(o){const t=document.querySelector(".tools-nav").offsetHeight,n=o.getBoundingClientRect().top+window.pageYOffset-t-20;window.scrollTo({top:n,behavior:"smooth"}),o.setAttribute("tabindex","-1"),o.focus({preventScroll:!0})}})})}const Q={projectBase:{"shower-only":{budget:3500,mid:6500,premium:12e3,luxury:2e4},"tub-shower":{budget:4e3,mid:7500,premium:14e3,luxury:25e3},"half-bath":{budget:2500,mid:5e3,premium:9e3,luxury:15e3},"full-bath":{budget:6e3,mid:12e3,premium:22e3,luxury:4e4},"master-bath":{budget:1e4,mid:2e4,premium:4e4,luxury:75e3},"floor-only":{budget:1500,mid:3e3,premium:5500,luxury:9e3},backsplash:{budget:800,mid:1500,premium:3e3,luxury:5500}},perSqFt:{budget:8,mid:15,premium:28,luxury:50},addons:{demo:{budget:300,mid:500,premium:800,luxury:1200},waterproof:{budget:200,mid:400,premium:700,luxury:1e3},plumbing:{budget:400,mid:800,premium:1500,luxury:3e3},electrical:{budget:300,mid:600,premium:1200,luxury:2e3},fixtures:{budget:200,mid:500,premium:1200,luxury:3e3},vanity:{budget:400,mid:1e3,premium:2500,luxury:5e3},glass:{budget:500,mid:1200,premium:2500,luxury:4500},niche:{budget:150,mid:300,premium:600,luxury:1e3}},zipAdjustments:{"08":1.05,"08401":1.1,"08204":1.08,"08742":1.12,default:1}};function Xt(){var $,j,L,C,A,q;const a=($=document.getElementById("cost-project-type"))==null?void 0:$.value,e=((j=document.getElementById("cost-quality"))==null?void 0:j.value)||"mid-range",o=parseFloat((L=document.getElementById("cost-sqft"))==null?void 0:L.value)||50,t=parseFloat((C=document.getElementById("cost-tile-area"))==null?void 0:C.value)||100,n=((A=document.getElementById("cost-zip"))==null?void 0:A.value)||"";if(!a){B("Please select a project type","warning");return}const s=e==="mid-range"?"mid":e,l=((q=Q.projectBase[a])==null?void 0:q[s])||5e3,c=t*Q.perSqFt[s];let d=0;["demo","waterproof","plumbing","electrical","fixtures","vanity","glass","niche"].forEach(M=>{var _;const F=document.getElementById(`cost-${M}`);F!=null&&F.checked&&(d+=((_=Q.addons[M])==null?void 0:_[s])||0)});let u=1;if(n.length>=2){const M=n.substring(0,2);u=Q.zipAdjustments[n]||Q.zipAdjustments[M]||Q.zipAdjustments.default}const m=(l+c+d)*u,f=m*.1,g=.45,p=Math.round(m*.85),v=Math.round((m+f)*1.15),y=Math.round(m*g),x=Math.round(m*.35),S=Math.round(m*.1);document.getElementById("cost-result-low").textContent="$"+b(p),document.getElementById("cost-result-high").textContent="$"+b(v),document.getElementById("cost-labor").textContent="$"+b(y),document.getElementById("cost-materials").textContent="$"+b(x),document.getElementById("cost-fixtures").textContent="$"+b(S),document.getElementById("cost-contingency").textContent="$"+b(Math.round(f)),document.getElementById("cost-calc-results").hidden=!1}function ea(){var u,m,f;const a=parseFloat((u=document.getElementById("slope-length"))==null?void 0:u.value)||3,e=((m=document.getElementById("slope-drain-type"))==null?void 0:m.value)||"center",o=((f=document.getElementById("slope-method"))==null?void 0:f.value)||"mud-bed",t=.25,n=.3125;let s=a;e==="linear"?s=a*.75:e==="offset"&&(s=a*1.15);const l=s*t,c=s*n,d=g=>{const p=Math.floor(g),v=g-p;return v<.0625?p+'"':v<.1875?p+' 1/8"':v<.3125?p+' 1/4"':v<.4375?p+' 3/8"':v<.5625?p+' 1/2"':v<.6875?p+' 5/8"':v<.8125?p+' 3/4"':v<.9375?p+' 7/8"':p+1+'"'};document.getElementById("result-slope-min").textContent='\xBC" per ft ('+d(l)+" at "+a+" ft)",document.getElementById("result-slope-rec").textContent='5/16" per ft ('+d(c)+" at "+a+" ft)",document.getElementById("result-slope-height").textContent=d(c)+" above drain";const r={"mud-bed":"Traditional mud bed allows precise slope control. Use dry-pack mortar (4:1 sand:cement ratio) reinforced with metal lath.","foam-pan":"Pre-sloped foam pans are factory-made to code. Verify slope before waterproofing. Faster install, consistent results.",bonded:"Bonded waterproofing systems (Kerdi, Wedi) require substrate slope. Build slope into substrate before membrane."};document.getElementById("slope-method-note").textContent=r[o]||"",document.getElementById("slope-calc-results").hidden=!1}const ta={"schluter-kerdi":{name:"Schluter KERDI",unit:"roll (54.5 sf)",coverage:54.5,tapePerCorner:2,accessories:["KERDI-BAND","KERDI-SEAL","KERDI-DRAIN"],thinsetNote:"MUST use unmodified thinset (ANSI A118.1)"},laticrete:{name:"LATICRETE Hydro Ban",unit:"gallon (covers 50 sf @ 2 coats)",coverage:50,liquidCoats:2,accessories:["Hydro Ban Board","Seam Tape"]},"custom-redgard":{name:"Custom RedGard",unit:"gallon (covers 55 sf @ 2 coats)",coverage:55,liquidCoats:2,accessories:["Mesh Tape","Corners"]},"mapei-aquadefense":{name:"Mapei AquaDefense",unit:"gallon (covers 50 sf @ 2 coats)",coverage:50,liquidCoats:2,accessories:["Reinforcing Fabric","Mapeband"]},"go-board":{name:"GoBoard",unit:"panel (3x5 ft = 15 sf)",coverage:15,accessories:["GoBoard Sealant","Seam Tape"]},"noble-deck":{name:"Noble Deck",unit:"roll (varies)",coverage:32.5,accessories:["Noble Seal TS","Corners"]}};function aa(){var x,S,$,j,L,C,A,q,M,F;const a=((x=document.getElementById("wp-system"))==null?void 0:x.value)||"custom-redgard",e=((S=document.getElementById("wp-location"))==null?void 0:S.value)||"shower",o=parseFloat(($=document.getElementById("wp-area"))==null?void 0:$.value)||0,t=parseFloat((j=document.getElementById("wp-floor-area"))==null?void 0:j.value)||0,n=parseFloat((L=document.getElementById("wp-wall-area"))==null?void 0:L.value)||0;let s=0;document.getElementById("wp-floor-area")||document.getElementById("wp-wall-area")?(e==="shower"?s=t+n:e==="shower-walls"||e==="tub-surround"?s=n:e==="shower-floor"||e==="bathroom-floor"?s=t:s=t+n,s<=0&&(s=o)):s=o,s<=0&&(s=72);const c=parseInt((C=document.getElementById("wp-corners"))==null?void 0:C.value)||4,d=parseInt((A=document.getElementById("wp-niches"))==null?void 0:A.value)||1,r=ta[a];if(!r)return;const u=s*1.15,m=Math.ceil(u/r.coverage),f=r.tapePerCorner||2,g=c*f+d*8;document.getElementById("wp-membrane-label").textContent=r.liquidCoats?"Membrane (liquid)":"Membrane",document.getElementById("result-wp-membrane").textContent=m+" "+r.unit,document.getElementById("result-wp-tape").textContent=g+" linear ft",document.getElementById("result-wp-corners").textContent=c+" pre-formed corners";const p=r.accessories.map(_=>`<span class="wp-accessory">${_}</span>`).join(", ");document.getElementById("wp-accessories").innerHTML="<strong>Also need:</strong> "+p;const v={"schluter-kerdi":"KERDI must be set in unmodified thinset. Use KERDI-BAND for all seams and corners.",laticrete:"Apply 2 coats with drying time between. Use with Hydro Ban Board for shower niches.","custom-redgard":"Apply 2 coats at 15 mils wet each. Allow to dry pink to red between coats.","mapei-aquadefense":"Apply 2 coats. Embed fabric tape in first coat at corners and seams.","go-board":"Waterproof at joints only. Seal all fastener holes with sealant.","noble-deck":"Can be used with modified thinset. Great for drains and seats."};document.getElementById("wp-system-note").textContent=v[a]||"";const y=[];(q=document.getElementById("wp-valve"))!=null&&q.checked&&y.push("Mixing valve seal"),(M=document.getElementById("wp-drain"))!=null&&M.checked&&y.push("Drain assembly"),(F=document.getElementById("wp-curb"))!=null&&F.checked&&y.push("Curb membrane"),y.length>0&&(document.getElementById("wp-accessories").innerHTML+="<br><strong>Penetrations:</strong> "+y.join(", ")),document.getElementById("waterproof-calc-results").hidden=!1}const ne={tileInstall:{mosaic:6,subway:15,small:18,standard:25,medium:20,large:15,plank:18},patternMultiplier:{straight:1,offset:1.15,diagonal:1.35,herringbone:1.6,versailles:1.4},surfaceMultiplier:{floor:1,wall:1.2,shower:1.5,backsplash:1.3},complexityMultiplier:{simple:.9,moderate:1,complex:1.3},prepHours:{demo:4,levelprep:3,waterproof:2,backerboard:3,schluter:1.5,niche:2.5}};function oa(){var S,$,j,L,C;const a=(S=document.getElementById("labor-tile-type"))==null?void 0:S.value,e=(($=document.getElementById("labor-pattern"))==null?void 0:$.value)||"straight",o=parseFloat((j=document.getElementById("labor-area"))==null?void 0:j.value)||100,t=((L=document.getElementById("labor-surface"))==null?void 0:L.value)||"floor",n=((C=document.getElementById("labor-complexity"))==null?void 0:C.value)||"moderate";if(!a){B("Please select a tile type","warning");return}const s=ne.tileInstall[a]||20,l=ne.patternMultiplier[e]||1,c=ne.surfaceMultiplier[t]||1,d=ne.complexityMultiplier[n]||1,r=s/(l*c*d),u=o/r,m=u*.3;let f=0;const g=[];["demo","levelprep","waterproof","backerboard","schluter","niche"].forEach(A=>{const q=document.getElementById(`labor-${A}`);if(q!=null&&q.checked){const M=ne.prepHours[A]||0;f+=M;const F={demo:"Demolition",levelprep:"Floor leveling",waterproof:"Waterproofing",backerboard:"Backer board",schluter:"Edge trim",niche:"Niche install"};g.push({task:F[A],hours:M})}}),g.push({task:"Tile installation",hours:u}),g.push({task:"Grouting & cleanup",hours:m});const v=f+u+m,y=Math.ceil(v/8);document.getElementById("result-labor-days").textContent=y,document.getElementById("result-labor-detail").textContent=`${b(v,1)} total hours at ${b(r,1)} sq ft/hour`;const x=g.map(A=>`<div class="labor-breakdown__item">
        <span class="labor-breakdown__task">${A.task}</span>
        <span class="labor-breakdown__hours">${b(A.hours,1)} hrs</span>
      </div>`).join("");document.getElementById("labor-breakdown-list").innerHTML=x,document.getElementById("labor-calc-results").hidden=!1}function na(){var a,e,o,t;(a=document.getElementById("calc-cost-btn"))==null||a.addEventListener("click",Xt),(e=document.getElementById("calc-slope-btn"))==null||e.addEventListener("click",ea),(o=document.getElementById("calc-waterproof-btn"))==null||o.addEventListener("click",aa),(t=document.getElementById("calc-labor-btn"))==null||t.addEventListener("click",oa)}function sa(a=document){const e=a.querySelectorAll("[data-sqft-helper]");e.length&&e.forEach(o=>{if(o.dataset.sqftHelperInit==="true")return;o.dataset.sqftHelperInit="true";const t=o.querySelector('[data-sqft="width"]'),n=o.querySelector('[data-sqft="length"]'),s=o.querySelector('[data-sqft="height"]'),l=o.querySelector('[data-sqft-output="floor"]'),c=o.querySelector('[data-sqft-output="walls"]'),d=o.querySelector('[data-sqft-action="use-floor"]'),r=o.querySelector('[data-sqft-action="use-walls"]');function u(p){if(!p)return 0;const v=parseFloat(p.value);return Number.isFinite(v)?v:0}function m(){const p=u(t),v=u(n),y=u(s),x=p>0&&v>0?p*v:0,S=p>0&&v>0&&y>0?2*y*(p+v):0;return{floorSqFt:x,wallSqFt:S}}function f(){const{floorSqFt:p,wallSqFt:v}=m(),y=p>0?b(p,1):"\u2014",x=v>0?b(v,1):"\u2014";l&&(l.value=y),c&&(c.value=x),o.dataset.floorSqFt=String(p),o.dataset.wallSqFt=String(v),d&&(d.disabled=!(p>0&&o.dataset.targetFloor)),r&&(r.disabled=!(v>0&&o.dataset.targetWall))}function g(p,v){if(!p)return;const y=document.querySelector(p);y&&(y.value=String(I(v,1)),y.dispatchEvent(new Event("input",{bubbles:!0})),y.dispatchEvent(new Event("change",{bubbles:!0})))}t==null||t.addEventListener("input",f),n==null||n.addEventListener("input",f),s==null||s.addEventListener("input",f),d==null||d.addEventListener("click",()=>{const p=parseFloat(o.dataset.floorSqFt);!Number.isFinite(p)||p<=0||g(o.dataset.targetFloor,p)}),r==null||r.addEventListener("click",()=>{const p=parseFloat(o.dataset.wallSqFt);!Number.isFinite(p)||p<=0||g(o.dataset.targetWall,p)}),f()})}function ra(){const a=document.querySelectorAll(".tools-section[id]"),e=document.querySelectorAll(".tools-nav__link"),o=new IntersectionObserver(t=>{t.forEach(n=>{n.isIntersecting&&e.forEach(s=>{s.classList.toggle("is-active",s.getAttribute("href")===`#${n.target.id}`)})})},{rootMargin:"-20% 0px -70% 0px"});a.forEach(t=>o.observe(t))}function ia(){const a=document.querySelectorAll(".calc-app-card"),e=document.getElementById("expand-all-btn"),o=document.getElementById("collapse-all-btn");if(a.length)if(a.forEach(t=>{const n=t.querySelector(".calc-app-card__header");n&&(n.addEventListener("click",()=>_e(t)),n.addEventListener("keydown",s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),_e(t))}))}),e&&e.addEventListener("click",()=>{a.forEach(t=>se(t)),Oe(!0)}),o&&o.addEventListener("click",()=>{a.forEach(t=>We(t)),Oe(!1)}),document.querySelectorAll(".tools-nav__link").forEach(t=>{t.addEventListener("click",n=>{const s=t.getAttribute("href");if(s&&s.startsWith("#")){const l=s.substring(1),c=document.getElementById(l);c&&c.classList.contains("calc-app-card")&&setTimeout(()=>{c.classList.contains("calc-app-card--expanded")||se(c)},300)}})}),window.location.hash){const t=window.location.hash.substring(1),n=document.getElementById(t);n&&n.classList.contains("calc-app-card")&&setTimeout(()=>{se(n),n.scrollIntoView({behavior:"smooth",block:"start"})},500)}else window.innerWidth>=900&&a.length>0&&se(a[0])}function _e(a){a.classList.contains("calc-app-card--expanded")?We(a):se(a)}function se(a){a.classList.add("calc-app-card--expanded");const e=a.querySelector(".calc-app-card__header");e&&e.setAttribute("aria-expanded","true");const o=a.querySelector(".calc-app-card__body");o&&(o.style.display="block",window.dispatchEvent(new Event("resize")))}function We(a){a.classList.remove("calc-app-card--expanded");const e=a.querySelector(".calc-app-card__header");e&&e.setAttribute("aria-expanded","false");const o=a.querySelector(".calc-app-card__body");o&&(o.style.display="none")}function Oe(a){const e=document.getElementById("expand-all-btn"),o=document.getElementById("collapse-all-btn");e&&e.classList.toggle("calc-controls__btn--active",!a),o&&o.classList.toggle("calc-controls__btn--active",a)}function la(){document.querySelectorAll(".calc-app-card").forEach(e=>{const o=e.querySelectorAll("input, select"),t=e.dataset.calculator;o.forEach(n=>{n.addEventListener("change",fe(()=>{De(t,e)},300)),n.type==="number"&&n.addEventListener("input",fe(()=>{De(t,e)},500))})})}function De(a,e){const o=e.querySelector(".calc-app-card__preview");let t=null;try{switch(a){case"tile":const n=document.getElementById("calc-tile-btn");n&&n.click();const s=document.getElementById("result-boxes");s&&s.textContent!=="\u2014"&&(t=s.textContent+" boxes");break;case"mortar":const l=document.getElementById("calc-mortar-btn");l&&l.click();const c=document.getElementById("result-mortar-bags");c&&c.textContent!=="\u2014"&&(t=c.textContent+" bags");break;case"grout":const d=document.getElementById("calc-grout-btn");d&&d.click();const r=document.getElementById("result-grout-bags");r&&r.textContent!=="\u2014"&&(t=r.textContent+" bags");break;case"leveling":const u=document.getElementById("calc-leveler-btn");u&&u.click();const m=document.getElementById("result-leveler-bags");m&&m.textContent!=="\u2014"&&(t=m.textContent+" bags");break;case"slope":const f=document.getElementById("calc-slope-btn");f&&f.click();break;case"waterproof":const g=document.getElementById("calc-waterproof-btn");g&&g.click();break;case"labor":const p=document.getElementById("calc-labor-btn");p&&p.click();break}}catch(n){console.warn("Auto-calculate error:",n)}if(o&&t){const n=o.querySelector(".calc-app-card__preview-value"),s=o.querySelector(".calc-app-card__preview-empty");if(n)n.textContent=t,n.style.display="block";else{const l=document.createElement("span");l.className="calc-app-card__preview-value",l.textContent=t,s?s.replaceWith(l):o.appendChild(l)}s&&(s.style.display="none")}}function fe(a,e){let o;return function(...n){const s=()=>{clearTimeout(o),a(...n)};clearTimeout(o),o=setTimeout(s,e)}}function He(){gt(),_t()&&i.rooms.length>0?Wt():Te(),Ut(),Zt(),ra(),Qt(),na(),sa(),ia(),la(),z(),K(),xe(),setTimeout(()=>{mt()},500),typeof window!="undefined"&&(window.TillersteadTools={state:i,validateProject:me,calculateTileQuantity:ue,calculateMortarBags:te,calculateGrout:ae,calculateLeveler:Me,getRecommendedTrowel:ee,getRecommendedJoint:je,exportJson:Ft,resetProject:Ne},console.log("Tillerstead Tools loaded. Access via window.TillersteadTools"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",He):He()})();})();
