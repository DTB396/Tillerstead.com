(()=>{class o{constructor(){this.isTransitioning=!1,this.init()}init(){this.initRouteTransitions(),this.initCriticalPathOptimization(),this.initResourceHints(),this.initPerformanceMonitoring()}initRouteTransitions(){window.matchMedia("(prefers-reduced-motion: reduce)").matches||(document.addEventListener("click",e=>{const t=e.target.closest("a[href]");this.shouldTransition(t)&&(e.preventDefault(),this.navigateWithTransition(t.href))}),window.addEventListener("popstate",()=>{this.loadPageContent(window.location.href,!1)}))}shouldTransition(e){return!(!e||!e.href||e.hostname!==window.location.hostname||e.target||e.download||e.rel==="external"||e.pathname===window.location.pathname&&e.hash||this.isTransitioning)}async navigateWithTransition(e){this.isTransitioning=!0,this.showTransition("exit"),window.haptics&&window.haptics.trigger("light");try{const n=await(await fetch(e)).text(),r=new DOMParser().parseFromString(n,"text/html");await new Promise(a=>setTimeout(a,300)),this.updatePageContent(r),window.history.pushState({},"",e),this.showTransition("enter"),typeof gtag!="undefined"&&gtag("config","G-XXXXXXXX",{page_path:e})}catch(t){console.error("[AppShell] Navigation failed:",t),window.location.href=e}finally{setTimeout(()=>{this.isTransitioning=!1,this.hideTransition()},600)}}updatePageContent(e){document.title=e.title;const t=e.querySelector("#main-content"),n=document.querySelector("#main-content");t&&n&&(n.innerHTML=t.innerHTML);const i=e.querySelector(".ts-breadcrumbs"),r=document.querySelector(".ts-breadcrumbs");i&&r?r.innerHTML=i.innerHTML:r&&r.remove(),this.updateMetaTags(e),this.reinitializeComponents(),window.scrollTo({top:0,behavior:"smooth"})}updateMetaTags(e){const t=e.querySelector('meta[name="description"]'),n=document.querySelector('meta[name="description"]');t&&n&&(n.content=t.content);const i=e.querySelector('link[rel="canonical"]'),r=document.querySelector('link[rel="canonical"]');i&&r&&(r.href=i.href),["og:title","og:description","og:url","og:image"].forEach(s=>{const c=e.querySelector(`meta[property="${s}"]`),l=document.querySelector(`meta[property="${s}"]`);c&&l&&(l.content=c.content)})}reinitializeComponents(){window.lazyLoad&&window.lazyLoad.update(),window.animationEngine&&window.animationEngine.init(),document.querySelectorAll("form").forEach(t=>{t.dispatchEvent(new Event("reinitialize"))})}showTransition(e){let t=document.querySelector(".app-shell-transition");t||(t=document.createElement("div"),t.className="app-shell-transition",document.body.appendChild(t)),t.className=`app-shell-transition ${e}`}hideTransition(){const e=document.querySelector(".app-shell-transition");e&&(e.classList.add("hidden"),setTimeout(()=>e.remove(),300))}initCriticalPathOptimization(){document.querySelectorAll('link[rel="stylesheet"][data-defer]').forEach(t=>{t.media="print",t.onload=function(){this.media="all"}}),"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img[data-src]").forEach(n=>{n.src=n.dataset.src,n.removeAttribute("data-src")})}initResourceHints(){let e;document.addEventListener("mouseover",n=>{const i=n.target.closest("a[href]");i&&i.hostname===window.location.hostname&&(e=setTimeout(()=>{this.prefetchPage(i.href)},200))}),document.addEventListener("mouseout",()=>{clearTimeout(e)}),document.querySelectorAll(".cta-button, .btn-primary").forEach(n=>{n.href&&n.hostname===window.location.hostname&&this.prefetchPage(n.href)})}prefetchPage(e){if(document.querySelector(`link[rel="prefetch"][href="${e}"]`))return;const t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="document",document.head.appendChild(t)}initPerformanceMonitoring(){if("PerformanceObserver"in window){try{new PerformanceObserver(t=>{const n=t.getEntries(),i=n[n.length-1];console.log("[Performance] LCP:",i.renderTime||i.loadTime),typeof gtag!="undefined"&&gtag("event","web_vitals",{event_category:"Web Vitals",event_label:"LCP",value:Math.round(i.renderTime||i.loadTime),non_interaction:!0})}).observe({entryTypes:["largest-contentful-paint"]})}catch(e){}try{new PerformanceObserver(t=>{t.getEntries().forEach(i=>{console.log("[Performance] INP:",i.processingStart-i.startTime)})}).observe({entryTypes:["first-input"]})}catch(e){}try{let e=0;new PerformanceObserver(n=>{for(const i of n.getEntries())i.hadRecentInput||(e+=i.value);console.log("[Performance] CLS:",e)}).observe({entryTypes:["layout-shift"]})}catch(e){}}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.appShell=new o}):window.appShell=new o;var h=o;})();
